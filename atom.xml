<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wangba&#39;s blogs</title>
  
  
  <link href="http://wangba.me/atom.xml" rel="self"/>
  
  <link href="http://wangba.me/"/>
  <updated>2020-10-09T10:36:07.175Z</updated>
  <id>http://wangba.me/</id>
  
  <author>
    <name>wangba</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SpringBoot整合Spring Security (四)</title>
    <link href="http://wangba.me/2020/10/09/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%9B%9B/"/>
    <id>http://wangba.me/2020/10/09/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%9B%9B/</id>
    <published>2020-10-09T10:33:41.000Z</published>
    <updated>2020-10-09T10:36:07.175Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>在本节中主要实现一下授权功能，即需求时：</p><blockquote><p>admin: 能访问所有的页面，不仅仅是 /admin/ 下的页面，也可以访问 /user/ 下的页面</p><p>user: 只能访问 /user/ 下所有页面</p><p>hello: /hello 所有用户都可以访问</p></blockquote><p>可以理解为：admin 权限比 user 高</p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p>环境参考<a href="http://wangba.me/tags/Spring-Security/">前面几节</a>，由于目前并没有连接数据库，所以就基于内存进行测试</p><p><code>SecurityConfig</code></p><p>在重写的 configure 方法中增加一个 user 用户：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">            .withUser(<span class="string">&quot;wangba&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;guigui&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .withUser(<span class="string">&quot;wangyi&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在重写的 configure 方法中增加拦截规则：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 省略</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：规则是有顺序的，即链式操作</p><p>如果把 anyRequest() 放在前面，首先就会让所有请求通过，然后再进行拦截，这样拦截规则就没有什么用了</p></blockquote><p><code>SecurityController</code> </p><p>在视图层增加一些请求方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/admin/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><p>/hello 请求：允许登录后的任何人访问</p><p>/user/hello 请求：允许拥有 user 角色的用户登录；允许拥有 admin 角色的用户登录</p><p>/admin/hello 请求：只允许拥有 admin 角色的用户登录</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 省略</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><p><code>Postman</code></p><p>首先登录 user 用户：wangyi</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150448.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150448.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150447961"></p><p>按照上面的理论来说：user 可以访问 <code>/hello</code> 和 <code>/user/hello</code> ，不能访问 <code>/admin/hello</code></p><p> <code>/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150703.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150703.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150702237"></p><p> <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150746.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150746.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150745738"></p><p> <code>/admin/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150851.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150851.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150850902"></p><p>可以看见，访问该接口被静止了</p><p>同样，登录 admin 用户：wangba</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151043.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151043.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151042154"></p><p> <code>/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151239.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151239.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151238430"></p><p> <code>/admin/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151145.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151145.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151144433"></p><p> <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151212.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151210955"></p><p>但是，我们前面要求实现的是 admin 可以访问所有页面，所以进行改进，即进行<code>角色继承</code></p><p><code>SecurityConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">RoleHierarchy <span class="title">roleHierarchy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RoleHierarchyImpl roleHierarchy = <span class="keyword">new</span> RoleHierarchyImpl();</span><br><span class="line">    roleHierarchy.setHierarchy(<span class="string">&quot;ROLE_admin &gt; ROLE_user&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> roleHierarchy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：上述配置表达<code>ROLE_admin</code> 自动具备 <code>ROLE_user</code> 的权限。</p></blockquote><p>此时重启项目，再次登录 wangba，并访问 <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009152023.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009152023.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009152022118"></p><p>可以看见此时 admin 角色可以访问任何页面了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>0206. Reverse Linked List</title>
    <link href="http://wangba.me/2020/10/09/0206-Reverse-Linked-List/"/>
    <id>http://wangba.me/2020/10/09/0206-Reverse-Linked-List/</id>
    <published>2020-10-09T01:58:41.000Z</published>
    <updated>2020-10-09T02:00:28.470Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="206-反转链表-Easy"><a href="#206-反转链表-Easy" class="headerlink" title="206. 反转链表 Easy"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list/">206. 反转链表</a> <font color="#49b666" size=5>Easy</font></h2><p>反转一个单链表。</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">输出: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>进阶:</strong><br>你可以迭代或递归地反转链表。你能否用两种方法解决这道题？</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>写链表的代码题，一定要考虑周全，可以从以下几个方面考虑：</p><ul><li><p>是否为空链表</p></li><li><p>是否只剩一个结点</p></li><li><p>剩余两个结点怎么样</p></li><li><p>在处理头结点和尾结点时，逻辑上是否可以通过</p></li></ul><h3 id="迭代解法："><a href="#迭代解法：" class="headerlink" title="迭代解法："></a>迭代解法：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 迭代法</span></span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="keyword">null</span>) &#123;</span><br><span class="line">        ListNode next = head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre = head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这就是在<a href="http://wangba.me/2020/10/03/LinkedList/">链表</a>中说到的哨兵，这样最大的目的就是为了让对整个链表的操作进行统一化</p><h3 id="递归解法："><a href="#递归解法：" class="headerlink" title="递归解法："></a>递归解法：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 递归法</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode listNode = reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> listNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在进行递归操作中，一定要注意的点：<code>出口</code> </p><p>也就是说一定要有最小条件，而这个条件是可以跳出最后一个递归调用的，然后将结果放到倒数第二个递归调用中</p><p>在这里面出口就是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一旦满足这个条件，就可以触发所有递归调用的结束</p>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Array" scheme="http://wangba.me/tags/Array/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>LinkedList</title>
    <link href="http://wangba.me/2020/10/03/LinkedList/"/>
    <id>http://wangba.me/2020/10/03/LinkedList/</id>
    <published>2020-10-03T14:04:52.000Z</published>
    <updated>2020-10-04T04:55:31.370Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003182532.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003182532.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003182530832"></p><p>快速预览：</p><ul><li>首先要和<a href="http://wangba.me/2020/10/02/Array/">上一节</a>的数组进行横向对比，来看一下链表独有的特性</li><li>第二小节会介绍一下常见的几种链表，以及为什么要衍生出这些链表</li><li>第三小节主要关注于链表的基操，<del>(勿6)</del> 以及在链表中的一些注意事项，如何保持链表不断链，为什么要引入哨兵</li><li>最后一个小节主要结合 Java 中的链表 LinkedList 来加深对链表的理解</li></ul><h2 id="二、特性"><a href="#二、特性" class="headerlink" title="二、特性"></a>二、特性</h2><p>在<a href="http://wangba.me/2020/10/02/Array/">上一节</a>中已经介绍过数组了，可以将数组和链表在结构上进行对比：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003201159.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003201159.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003201157816"></p><ul><li>在数组中，是需要一块<code>连续且足够存储所有数据</code>的内存空间。如果你的数据大小是 1MB，但是你的内存空间中可能只有两个大内存块，且大小分别为 512 KB，还有若干小内存块，那么这块数据是不能存储在内存中的</li><li>在链表中，是通过 next 指针将<code>离散的内存空间</code>全部利用起来，例如上面的情况中，就可以将这 1MB 大小的数据全部装入内存中</li></ul><blockquote><p>注：在实际的应用层开发中，是不用在乎那一点的空间换时间；但是在底层开发中，这种对空间要求非常高的开发中，就要考虑到多方面了</p></blockquote><p><code>对比：</code></p><table><thead><tr><th>时间复杂度</th><th>数组</th><th>链表</th></tr></thead><tbody><tr><td>查询</td><td>O(1)</td><td>O(n)</td></tr><tr><td>插入、删除</td><td>O(n)</td><td>O(1)</td></tr></tbody></table><h2 id="三、几种常规链表"><a href="#三、几种常规链表" class="headerlink" title="三、几种常规链表"></a>三、几种常规链表</h2><h3 id="3-1-单链表"><a href="#3-1-单链表" class="headerlink" title="3.1 单链表"></a>3.1 单链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214902.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214902.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214901489"></p><ul><li>指向 w 的结点的结点称为<code>头结点</code></li><li>指向 NULL 的结点 g 称为<code>尾结点</code></li><li>每一个结点需要额外的空间存储下一个结点的地址</li></ul><h3 id="3-2-循环链表"><a href="#3-2-循环链表" class="headerlink" title="3.2 循环链表"></a>3.2 循环链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214214.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214214.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214213008"></p><ul><li>不仅具有单链表的特点，且加上它的尾结点指向的不是 NULL，而是指向了头结点</li><li>相比单链表的优点：可以通过尾结点找到头结点</li></ul><h3 id="3-3-双向链表"><a href="#3-3-双向链表" class="headerlink" title="3.3 双向链表"></a>3.3 双向链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214232.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214232.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214231020"></p><ul><li>每一个结点除了需要额外的空间存储下一个结点的地址，还需要额外的空间指向前一个结点的地址</li><li>相比单链表的优点：可以通过任一结点可以找到上一个结点和下一个结点</li></ul><h3 id="3-4-双向循环链表"><a href="#3-4-双向循环链表" class="headerlink" title="3.4 双向循环链表"></a>3.4 双向循环链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214248.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214248.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214247489"></p><ul><li>不仅具有双向链表的特点，且加上头结点的 pre 指针指向尾结点，尾结点的 next 指针指向头结点</li><li>相比双向链表的优点：可以通过头结点找到尾结点，也可以通过尾结点找到头结点</li></ul><h2 id="四、链表的基操和注意事项"><a href="#四、链表的基操和注意事项" class="headerlink" title="四、链表的基操和注意事项"></a>四、链表的基操和注意事项</h2><p>这里对于链表的操作只在单链表中进行，其余的链表同理：</p><p><code>增</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003221952.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003221952.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003221950242"></p><p>前提：在 a 结点后面增加一个 x 结点，p 指向 a 结点</p><ul><li>第一步：x –&gt; next = p –&gt; next</li><li>第二步：p –&gt; next = x</li></ul><blockquote><p>注：</p><p>此时就要注意 “链不断” 理论：在上面的例子中就是，第一步和第二步的顺序不能颠倒，不然就会出现下面这种情况：</p><ul><li>第一步：p –&gt; next = x</li><li>第二步：x –&gt; next = p –&gt; next</li></ul><p>如果 p –&gt; next 指向了 x，那么在第二步中，x –&gt; next 指向了自己</p></blockquote><p><code>删</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003223435.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003223435.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003223434117"></p><p>删除操作的话，就只需要：p –&gt; next = p –&gt; next –&gt; next 即可</p><blockquote><p>注：删除结点要记得释放内存，除了一些自带垃圾回收的语言外，例如 Java、python、Go等</p></blockquote><p><code>哨兵模式</code></p><p>既然在链表中出现了这个模式，那必然是有运用的场景的，看个例子：</p><p>在上面单链表中增加一个结点时</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004085305.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004085305.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004085304248"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x --&gt; next = p --&gt; next</span><br><span class="line">p --&gt; next = x</span><br></pre></td></tr></table></figure><p>如果出现下面几种情况：</p><ul><li>空链表，插入第一个结点</li><li>删除最后一个结点</li><li>又或是 p 指针指向的是两个结点的前一个结点 (在上面的例子中是 a)，但是如果出现要插入的是头结点前面 (也就是说没有前面那个结点了) 呢？</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004090747.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004090747.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004090746697"></p><p>此时就可以发现，p 指针无处可指，这时候就可以引入”哨兵”了。(虽然在双向链表中可以轻易解决这个问题)</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004113804.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004113804.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004100823076"></p><p>也就是说不管在什么情况下，都有一个哨兵的存在，其主要目的就是简化代码，不需要考虑带很多情况，可以看一下下面的例子：</p><p>首先需要的前提就是：head 指针是永远指向哨兵的</p><ul><li>空链表中插入第一个结点，就可以：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head -&gt; next == null) &#123;</span><br><span class="line">  p = head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只需要判断哨兵指针的 next 是否为空，如果为空的的话，只需要将 p = head，就可以进行和上面一样的插入代码了</p><h2 id="四、Java中的链表"><a href="#四、Java中的链表" class="headerlink" title="四、Java中的链表"></a>四、Java中的链表</h2><p>​        首先来回忆一下在 Java 中对数组的操作，直接分配一块连续的内存给数组，这种情况的不好之处就是需要连续且内存足够的空间；随后又提出了 Java 中动态数组 ArrayList ，这个类的确可以进行动态的自动扩容，但是它不能进行自动缩容 (注：ArrayList 是支持手动扩容、缩容)，而且它的扩容是将原来所有的数据复制一份到已经进行扩容到原来 1.5 倍的新数组中，当数据量过大时，这种操作可能就需要大量时间来进行了</p><p>​        而在这一小节中，可以看一下，在 Java 中链表类：<code>LinkedList</code>，它的底层是基于双向链表的，日常开发很少使用</p><p>首先看一下，继承关系：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004123939.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004123939.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004123937678"></p><p>可以和<a href="http://wangba.me/2020/10/02/Array/">上一节</a> ArrayList 类的继承图进行对比，可以发现：</p><ul><li>少了：LinkedList 少实现了 RandomAccess 接口，具体看参考<a href="https://juejin.im/post/6844903519066193927">RandomAccess 这个空架子有何用？</a></li><li>改了：ArrayList 是继承了 AbstractList，而 LinkedList 继承了 AbstractSequentialList (它是 AbstractList 的子类)</li><li>多了：LinkedList 还实现了 Deque 接口  ====&gt;  因为实现 Deque 即可以作为队列使用，也可以作为栈使用。当然，作为双端队列，也是可以的。</li></ul><p>由于源码过多，此内容将放在 JDK 源码分析系列中。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Array</title>
    <link href="http://wangba.me/2020/10/02/Array/"/>
    <id>http://wangba.me/2020/10/02/Array/</id>
    <published>2020-10-02T14:35:15.000Z</published>
    <updated>2020-10-02T14:29:22.797Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>思维导图：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002093205.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002093205.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002093203544">        </p><h2 id="二、特性"><a href="#二、特性" class="headerlink" title="二、特性"></a>二、特性</h2><p>数组应该是所有程序员中最熟悉的数据结构了，如果你简单的回忆一下数组的具体含义，你可以得到已经几个重要的结论：</p><ul><li>🐷 线性结构</li><li>🐢 连续内存</li><li>🐭 存储相同类型</li></ul><h3 id="2-1-线性结构"><a href="#2-1-线性结构" class="headerlink" title="2.1 线性结构"></a>2.1 线性结构</h3><p>顾名思义，线性结构就是这个结构像线性一样，而非是其它结构，这样说的确有点抽象，可以从下面几个例子来看一下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002101432.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002101432.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002101430898"></p><blockquote><p>注：</p><ul><li>这里的 <strong>Array</strong> 是使用 <strong>Java</strong> 中的内存模型，即 <strong>char</strong> 为 2 个字节</li><li>链表没有使用哨兵模式 (后面会提到)</li></ul></blockquote><h3 id="2-2-连续内存和相同数据类型"><a href="#2-2-连续内存和相同数据类型" class="headerlink" title="2.2 连续内存和相同数据类型"></a>2.2 连续内存和相同数据类型</h3><p>正如上面例子中的数组一样，在这个数组中，它们的地址是连续的，且数组中每一个元素都是 char 类型，正是由于这两个特性，让数组实现了这一生中最重要的操作：快速查询，它可以达到 <strong>O(1)</strong> 的速度，当然要对这里进行限制条件，即准确的表达应该是按照<code>下标</code>进行查询，它的时间复杂度可以达到 <strong>O(1)</strong> ，而不是我们经常说的根据某个值来确定它的位置等，这样的查询方式 (已经排好序) 最快也是 <strong>O(logn)</strong> </p><p>先来看一下是如何实现根据下标来进行时间复杂度为 <strong>O(1)</strong> 的操作：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002112308.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002112308.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002112307187"></p><p>我们很容易就发现这样的规律：</p><p>前提：char[] charList = new char[6]</p><p>结论：<code>address = baseAddress + i * charSize</code></p><p>也就是说，我们只需要知道以下条件就行：</p><ul><li>该数组的起始地址 baseAddress，也就是图中的 1000</li><li>该数组是什么类型，这里是 Java 的 char 类型，字节数为 2</li></ul><p>就这样，可以通过上面条件求出这里任意一个元素的地址。</p><h4 id="假知识："><a href="#假知识：" class="headerlink" title="假知识："></a>假知识：</h4><p>如果，起始地址从 1 开始的话，来计算一下会发生什么情况？</p><p>计算公式是不是要变为：<code>address = baseAddress + (i - 1) * charSize</code> </p><p>你想，你细想，是不是每次都要多进行一次<strong>减法</strong>操作，这样 <code>加法器</code> (在计组中是没有减法器存在的，通过转换为加法来计算)是不是就要多进行一次计算</p><p>这会不会就是当年定义数组从 0 开始的那位程序员的 idea 呢？(<del>强者如斯</del>) 当然不是，这仅仅是一种规定而已，上面的一系列猜测，仅仅是为了猜而猜</p><h3 id="2-3-插入和删除"><a href="#2-3-插入和删除" class="headerlink" title="2.3 插入和删除"></a>2.3 插入和删除</h3><p><strong>One coin has two sides</strong>，有利自然有弊。在上面已经说过了数组的查询，也是数组的最大优点；当然数组在插入和删除的时间复杂度比较高，但是也有一些优化的小 tips。</p><p><code>插入</code></p><p>为什么说数组中插入，会是时间复杂度变高呢？主要是数组是连续存储的，如果只是在最后一个元素插入一个新的元素，那么没什么大不了；但是你要是在第一个元素后面插入一个新的元素，那就要把原本的第二个元素到最后一个元素全部向后移动一个 typeSize，如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002153520.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002153520.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002153518082"></p><p>由上面的图，可以轻易看出插入新的元素在最后：前面元素的位置都未变；插入在第二个位置：第二个元素到最后一个元素的位置都 <strong>+ 1</strong> 了</p><p>平均的时间复杂度就为：<strong>O(n)</strong></p><p>当然这样做是有前提的：就是是要有序的。如果对排序没有要求的，可以如下操作：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002155752.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002155752.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002155750878"></p><p>此时只需要把原本在 1 位置的元素<strong>复制</strong>到新扩展的位置，把 1 中的元素换成新的元素，在上述的例子中对应的就是：将 n 复制到位置 5 上，然后将位置 1 的元素覆盖为新元素 a</p><p><code>删除</code></p><p>删除数组中的元素与插入操作类似：主要是为了保证内存的连续性，如果删除最后一个元素，那没什么问题；如果是删除第一个元素，那么第一个元素后面的所有元素都要向前移动一个位置。</p><p>则平均的时间复杂度就为：<strong>O(n)</strong></p><p>一些特殊情况下的删除：如果对没有立马对删除元素进行垃圾回收的操作，有什么比较好的方式？</p><p>在 JVM 进行垃圾回收时，有以下几种算法：</p><ul><li>标记 - 清除算法</li><li>复制算法</li><li>标记 - 整理算法</li><li>分代收集算法</li></ul><p>在这里主要介绍一下 <strong>标记 - 清除算法</strong>，简单来说：</p><p>在 JVM 进行垃圾回收时，不立马进行回收，只是对要进行回收的元素进行标记，等到积累到一定量再进行一次批处理，例子如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163730.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163730.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002163729145"></p><p>可以看见，只需要对要删除的元素进行标记，随后到最后一次性进行回收</p><p>但是这样也会带来很多问题，如效率问题和空间问题，如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163919.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163919.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002163917519"></p><p>如果是删除的元素是一段一段的，那么就会产生大量的空间碎片，所以 JVM 后面还有很多其余的回收算法</p><h3 id="2-4-关于数组越界的问题"><a href="#2-4-关于数组越界的问题" class="headerlink" title="2.4 关于数组越界的问题"></a>2.4 关于数组越界的问题</h3><p>我们尝试在 Ubuntu 18.04 64bit 中运行下面这段 C 代码：</p><p><code>OverFlow.c</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(; i&lt;=<span class="number">3</span>; i++)&#123;</span><br><span class="line">        arr[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照正常想法走下去：会打印三行 hello world，就会运行完毕</p><p>让我们进行测试吧：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002172344.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002172344.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002172343083"></p><p>你就会看到控制台开始无限打印 hello world 了：</p><p>![image-20201002172557103](/Users/wangdechao/Library/Application Support/typora-user-images/image-20201002172557103.png)</p><p>只要在内存足够的情况下，这个程序就会一直运行下去，这就是典型的 StackOverFlow 问题</p><p>简单的就可以理解成如下结构：</p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002184829.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002184829.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002184827040" style="zoom:50%;" /><p>这个栈的结构具体可以参考《深入理解计算机系统》，这里出现上述情况的主要原因：</p><ul><li>C 语言中是所有的内存都是可以访问 (除了受限内存以外)</li><li>在上述代码中 i &lt;=3，说明 a[3] = 0 在内存的某个地址上</li><li>而这个地址本身是 <code>原来的 i 的地址</code> ，所以就相当于 i = 3 又被赋值为 i = 0，然后继续不断循环</li></ul><p>如果想知道这个栈溢出是如何具体实现的话，可以是用 objdump 命令进行反编译，再进行分析，其中主要的汇编代码如下：其中关键行应该为 65f、67e、682、661</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">000000000000063a &lt;main&gt;:</span><br><span class="line"> 63a:    55                       push   %rbp</span><br><span class="line"> 63b:    48 89 e5                 mov    %rsp,%rbp</span><br><span class="line"> 63e:    48 83 ec 20              sub    $0x20,%rsp</span><br><span class="line"> 642:    89 7d ec                 mov    %edi,-0x14(%rbp)</span><br><span class="line"> 645:    48 89 75 e0              mov    %rsi,-0x20(%rbp)</span><br><span class="line"> 649:    c7 45 fc 00 00 00 00     movl   $0x0,-0x4(%rbp)</span><br><span class="line"> 650:    48 c7 45 f0 00 00 00     movq   $0x0,-0x10(%rbp)</span><br><span class="line"> 657:    00 </span><br><span class="line"> 658:    c7 45 f8 00 00 00 00     movl   $0x0,-0x8(%rbp)</span><br><span class="line"> 65f:    eb 1d                    jmp    67e &lt;main+0x44&gt;</span><br><span class="line"> 661:    8b 45 fc                 mov    -0x4(%rbp),%eax</span><br><span class="line"> 664:    48 98                    cltq   </span><br><span class="line"> 666:    c7 44 85 f0 00 00 00     movl   $0x0,-0x10(%rbp,%rax,4)</span><br><span class="line"> 66d:    00 </span><br><span class="line"> 66e:    48 8d 3d 9f 00 00 00     lea    0x9f(%rip),%rdi        # 714 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line"> 675:    e8 96 fe ff ff           callq  510 &lt;puts@plt&gt;</span><br><span class="line"> 67a:    83 45 fc 01              addl   $0x1,-0x4(%rbp)</span><br><span class="line"> 67e:    83 7d fc 03              cmpl   $0x3,-0x4(%rbp)</span><br><span class="line"> 682:    7e dd                    jle    661 &lt;main+0x27&gt;</span><br><span class="line"> 684:    b8 00 00 00 00           mov    $0x0,%eax</span><br><span class="line"> 689:    c9                       leaveq </span><br><span class="line"> 68a:    c3                       retq   </span><br><span class="line"> 68b:    0f 1f 44 00 00           nopl   0x0(%rax,%rax,1)</span><br></pre></td></tr></table></figure><p>其实，在这个巨大漏洞出来后，现在的内存已经加了金丝雀保护 (canary) 了，为了让这个漏洞复现，在上面编译的过程中，已经使用 <strong>-fno-stack-protector</strong> 将保护关闭了</p><p>而如果该程序在 Java 中复现，在编译时就会抛出 <strong>ArrayIndexOutOfBoundsException</strong> 的异常了</p><h2 id="三、Java-中的数组"><a href="#三、Java-中的数组" class="headerlink" title="三、Java 中的数组"></a>三、Java 中的数组</h2><p>在 Java 中，对于数组没有什么好了解的，顶多就一个基本语法；但是在 Java 中有一个集合类，是每个 Java 程序员应该每天都会用到的，它就是 <code>ArrayList</code> </p><p>先看一下它的继承和实现关系</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002213613.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002213613.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002213610816"></p><ul><li>它继承了 <strong>AbstractList</strong> ，实现了 <strong>List</strong>    ====&gt;    它是一个数组队列，提供了相关的添加、删除、修改、遍历等功能</li><li>它实现了<strong>RandomAccess 接口</strong>    ====&gt;    实现这个这个接口的 List 集合是支持<strong>快速随机访问</strong></li><li>它实现 <strong>java.io.Serializable 接口</strong>    ====&gt;    ArrayList <strong>支持序列化</strong>，<strong>能通过序列化去传输</strong></li><li>并且要注意，在单线程中使用它，在多线程使用 <strong>Vector(少)</strong> 或者 <strong>CopyOnWriteArrayList(多)**，尽量还是使用后者较多，前者主要是基于 **synchronized</strong> 关键字，后者是基于 <strong>ReentrantLock</strong> 操作的</li></ul><p>它与 Java 自带的普通数组最大的区别就是：它是<code>动态</code>的</p><p>这里主要基于源码分析一下动态扩容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; <span class="keyword">this</span>.elementData.length &amp;&amp; (<span class="keyword">this</span>.elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA || minCapacity &gt; <span class="number">10</span>)) &#123;</span><br><span class="line">        ++<span class="keyword">this</span>.modCount;</span><br><span class="line">        <span class="keyword">this</span>.grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object[] grow(<span class="keyword">int</span> minCapacity) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.elementData = Arrays.copyOf(<span class="keyword">this</span>.elementData, <span class="keyword">this</span>.newCapacity(minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object[] grow() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.grow(<span class="keyword">this</span>.size + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">newCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = <span class="keyword">this</span>.elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(<span class="number">10</span>, minCapacity);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> minCapacity;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> newCapacity - <span class="number">2147483639</span> &lt;= <span class="number">0</span> ? newCapacity : hugeCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li>对于变长数据结构，当结构中没有空余空间可供使用时，就需要进行扩容。在 ArrayList 中，当空间用完，其会按照原数组空间的1.5倍进行扩容。</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Algorithm</title>
    <link href="http://wangba.me/2020/10/01/Algorithm/"/>
    <id>http://wangba.me/2020/10/01/Algorithm/</id>
    <published>2020-10-01T14:42:29.000Z</published>
    <updated>2020-10-01T14:52:58.430Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​            最近实习后发现自己的算法能力急剧下降，<del>CRUD 只是下限，算法才是上限</del>，决定重新开一个系列，将数据结构与算法重新学一遍。这次主要参考的课程是《数据结构与算法之美》和《算法面试通关40讲》。这里就不像《算法导论》那样比较理论化，应该会更偏向于《算法》这本书的类型。</p><p>可以看到下面这些有趣的点：</p><ul><li>🐷 尽量利用图 + 文字，清晰的表达意思</li><li>🐢 一定要结合 Leetcode 上的题目</li><li>🐭 尽量介绍一些<del>没用</del>有趣的小 Tips</li><li>🐦 使用 Java 来实现所有的算法</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (三)</title>
    <link href="http://wangba.me/2020/09/30/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%89/"/>
    <id>http://wangba.me/2020/09/30/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%89/</id>
    <published>2020-09-30T06:47:27.000Z</published>
    <updated>2020-09-30T08:49:43.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在前后端不分离时代，可能使用的就是<a href="http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/">上一节</a>中这种方法；在现在这种前后端分离遍地走的情况下，已经不再推荐使用传统的 session ，而是使用现在比较流行的 JWT 这种 token 的方式解决</p><p>​        对比分析一下：</p><table><thead><tr><th></th><th>有状态登录</th><th>无状态登录</th></tr></thead><tbody><tr><td>定义</td><td>服务端需要记录每次会话的客户端信息，从而识别客户端身份，根据用户身份进行请求的处理</td><td>服务端不保存任何客户端请求者信息；客户端的每次请求必须具备自描述信息，通过这些信息识别客户端身份</td></tr><tr><td>优点</td><td>比较方便，不需要做多余的处理</td><td>使用 token 很灵活；服务端不需要存数据；客户端也可以发送给多个服务器</td></tr><tr><td>缺点</td><td>只能是网页端，在 IOS、Android不行；服务端保存大量数据；集群化不太行</td><td>配置稍微复杂(其实在框架的加成下，不复杂)</td></tr></tbody></table><p><code>有状态登录</code></p><ul><li>🌰：在 Tomcat 中，用户登录后，需要把用户的信息保存在服务器的 session 中，然后发送给用户一个 Cookie 值，记录对应的 session 值，等用户下一次再次访问该服务器时，浏览器会自动带上这个 Cookie 值，服务端再识别其中的 session 值，进行判断</li></ul><p><code>无状态登录</code></p><ul><li>🌰：客户端发送账户密码到服务端进行验证；认证后服务端发送一个 token 给客户端；以后客户端每次发送请求都将 token 携带上进行认证，进行判断</li></ul><h2 id="二、Test"><a href="#二、Test" class="headerlink" title="二、Test"></a>二、Test</h2><p>​        在前后端分离的基础上，现在前端和后端只是通过 JSON 进行交互，所以现在的页面跳转全部由前端进行控制，后端只是返回不同的 JSON 罢了</p><p>重写<code>SecurityConfig</code>中的 configure 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 登出页面 + 登出成功后页面</span></span><br><span class="line">            .logout()</span><br><span class="line">            .logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .logoutSuccessHandler((httpServletRequest, httpServletResponse, authentication) -&gt; &#123;</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 登录页面 + 登录接口</span></span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/securityLogin&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            <span class="comment">// 登录失败处理器</span></span><br><span class="line">            .failureHandler((httpServletRequest, httpServletResponse, e) -&gt; &#123;</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(e.getMessage());</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 登录成功处理器</span></span><br><span class="line">            .successHandler((httpServletRequest, httpServletResponse, authentication) -&gt; &#123;</span><br><span class="line">                Object principal = authentication.getPrincipal();</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(<span class="keyword">new</span> ObjectMapper().writeValueAsString(principal));</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>登录接口</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200929172425.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200929172425.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200929172423472"></p><blockquote><p>注：</p><ul><li>可以看到使用前后端分离，就不需要后端来控制跳转页面等，只需要将 JSON 发给前端就行</li><li>这里面的 password 为空，是框架做的，具体可以看这里</li></ul></blockquote><p><code>登录失败</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930092635.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930092635.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930092629637"></p><blockquote><p>注：</p><ul><li>无论是用户名和密码其中一个错误，就会返回 Bad credentials 提示，主要也是为了安全着想，具体流程可以看下面的 3.1 小节</li></ul></blockquote><p><code>注销登录</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930093600.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930093600.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930093559635"></p><h2 id="三、Deep-Learning"><a href="#三、Deep-Learning" class="headerlink" title="三、Deep Learning"></a>三、Deep Learning</h2><h3 id="3-1-深入了解登录失败"><a href="#3-1-深入了解登录失败" class="headerlink" title="3.1 深入了解登录失败"></a>3.1 深入了解登录失败</h3><p>​        在上面我们提到了无论是用户名和密码其中一个错误，就会返回 Bad credentials，实则在其中还有很多种错误，而且用户名是有用户名错误，只是最终被 Bad credentials 覆盖了，稍微分析一下：</p><p><code>AbstractUserDetailsAuthenticationProvider</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    Assert.isInstanceOf(UsernamePasswordAuthenticationToken.class, authentication, () -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.messages.getMessage(<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.onlySupports&quot;</span>, <span class="string">&quot;Only UsernamePasswordAuthenticationToken is supported&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    String username = authentication.getPrincipal() == <span class="keyword">null</span> ? <span class="string">&quot;NONE_PROVIDED&quot;</span> : authentication.getName();</span><br><span class="line">    <span class="keyword">boolean</span> cacheWasUsed = <span class="keyword">true</span>;</span><br><span class="line">    UserDetails user = <span class="keyword">this</span>.userCache.getUserFromCache(username);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cacheWasUsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = <span class="keyword">this</span>.retrieveUser(username, (UsernamePasswordAuthenticationToken)authentication);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UsernameNotFoundException var6) &#123;</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.hideUserNotFoundExceptions) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="keyword">this</span>.messages.getMessage(<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>, <span class="string">&quot;Bad credentials&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面这段代码中，进行调试可以看见：</p><ul><li>会先在缓存中查询一下是否有过</li><li>再调用 retrieveUser 来进行判断</li><li>一旦抛出 UsernameNotFoundException ，就看 hideUserNotFoundExceptions 的值了，如果为 true，就会抛出 Bad credentials</li></ul><p>进行断点调试：输错用户名，并打上断点：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930135354.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930135354.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930135352906"></p><p>通过上图就能看出，hideUserNotFoundExceptions 默认值是 true 的</p><h3 id="3-2-未认证处理"><a href="#3-2-未认证处理" class="headerlink" title="3.2 未认证处理"></a>3.2 未认证处理</h3><p>在前后端分离，如果出现未认证的状态，不可能控制前端来跳转页面等，只能给前端返回相应的信息即可：</p><p>在 <code>AuthenticationEntryPoint</code> 接口中有一个方法：<code>commence</code></p><p>在 <code>LoginUrlAuthenticationEntryPoint</code> 中实现方式为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">    String redirectUrl = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.useForward) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.forceHttps &amp;&amp; <span class="string">&quot;http&quot;</span>.equals(request.getScheme())) &#123;</span><br><span class="line">            redirectUrl = <span class="keyword">this</span>.buildHttpsRedirectUrlForRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redirectUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">            String loginForm = <span class="keyword">this</span>.determineUrlToUseForThisRequest(request, response, authException);</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Server side forward to: &quot;</span> + loginForm);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            RequestDispatcher dispatcher = request.getRequestDispatcher(loginForm);</span><br><span class="line">            dispatcher.forward(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        redirectUrl = <span class="keyword">this</span>.buildRedirectUrlToLoginPage(request, response, authException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.redirectStrategy.sendRedirect(request, response, redirectUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码中最主要的是看一下 <strong>useForward</strong> 的默认值，如果是 <strong>true</strong>，那么默认就是走转发；如果是 <strong>false</strong>，那么默认走的就是重定向</p><p>使出断点调试大法：</p><ul><li>在 <strong>Postman</strong> 中直接使用 <strong>GET</strong> 方式请求：localhost:8080/security</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141616.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141616.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930141614962"></p><p>此方法在第一节中已经写过了，就是输出一个 <strong>Spring Security</strong></p><ul><li>在方法内打上断点</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141514.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141514.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930141512452"></p><p>从上面的图就可以看见，<strong>useForward</strong> 的默认值是 <strong>false</strong>，那么就可以确定是走的重定向</p><p>只需要重写该方法覆盖它就行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.exceptionHandling()</span><br><span class="line">.authenticationEntryPoint((req, resp, authException) -&gt; &#123;</span><br><span class="line">    resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    PrintWriter out = resp.getWriter();</span><br><span class="line">    out.write(<span class="string">&quot;尚未登录，请先登录&quot;</span>);</span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930164934.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930164934.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930143626120"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (二)</title>
    <link href="http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/"/>
    <id>http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/</id>
    <published>2020-09-28T10:13:07.000Z</published>
    <updated>2020-09-30T07:09:26.232Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、Test"><a href="#一、Test" class="headerlink" title="一、Test"></a>一、Test</h2><p>环境与<a href="http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/">上一节</a>的环境一致，这一节主要来进行自定义操作</p><p>在 <code>SecurityConfig</code>  中重写这两个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    web.ignoring().antMatchers(<span class="string">&quot;/js/**&quot;</span>, <span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自行写一个登录页面：</p><p><code>login.html</code> 中的核心代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;pass&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pass&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button login&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-check&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>主要注意以下几个方面：</p><p>form 的请求地址是 /login.html，方法是 post</p><p>用户名和密码的属性值分别是 username 和 password</p></blockquote><h2 id="二、Deep-Learning"><a href="#二、Deep-Learning" class="headerlink" title="二、Deep Learning"></a>二、Deep Learning</h2><p> 🐢之疑问一：为啥默认的登录页面和登录接口是一样的？自定义页面又是如何覆盖默认页面的呢？</p><p><code>默认登录页面</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928133405.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928133405.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200928133357601"></p><p>关于页面的登录的配置都在：<code>FormLoginConfigurer</code> </p><p>其中这个类又是继承 <code>AbstractAuthenticationFilterConfigurer</code> 类的</p><p>则在 <code>FormLoginConfigurer</code> 初始化的时候，<code>AbstractAuthenticationFilterConfigurer</code> 的构造方法中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractAuthenticationFilterConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   setLoginPage(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时如果没有自定义登录页面，就会是 <code>项目地址/login</code> 这个地址</p><p>再看一下 <code>FormLoginConfigurer</code> 中的 init 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(H http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.init(http);</span><br><span class="line">   initDefaultLoginFilter(http);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法是调用了父类的 init 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(B http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   updateAuthenticationDefaults();</span><br><span class="line">   updateAccessDefaults(http);</span><br><span class="line">   registerDefaultAuthenticationEntryPoint(http);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在父类的 init 方法中调用了 <code>updateAuthenticationDefaults()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">updateAuthenticationDefaults</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 未自定义页面，就会和 loginPage 地址一样</span></span><br><span class="line">   <span class="keyword">if</span> (loginProcessingUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">      loginProcessingUrl(loginPage);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (failureHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">      failureUrl(loginPage + <span class="string">&quot;?error&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">final</span> LogoutConfigurer&lt;B&gt; logoutConfigurer = getBuilder().getConfigurer(</span><br><span class="line">         LogoutConfigurer.class);</span><br><span class="line">   <span class="keyword">if</span> (logoutConfigurer != <span class="keyword">null</span> &amp;&amp; !logoutConfigurer.isCustomLogoutSuccess()) &#123;</span><br><span class="line">      logoutConfigurer.logoutSuccessUrl(loginPage + <span class="string">&quot;?logout&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时就能看到：如果我们没有自定义登录接口，那么登录接口的地址就会被设置为和登录页面一致</p><p><code>自定义登录页面</code></p><p>如果自定义了页面地址，首先会到 <code>FormLoginConfigurer</code> 中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">loginPage</span><span class="params">(String loginPage)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">super</span>.loginPage(loginPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里面调用了父类的 <code>loginPage</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">loginPage</span><span class="params">(String loginPage)</span> </span>&#123;</span><br><span class="line">   setLoginPage(loginPage);</span><br><span class="line">   updateAuthenticationDefaults();</span><br><span class="line">   <span class="keyword">this</span>.customLoginPage = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">return</span> getSelf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，在这里面 set 完 <code>loginPage</code> 后，又双调用了 <code>updateAuthenticationDefaults()</code> 方法，这个方法在 ☝️ 有</p><p>如果自定义了登录接口 <code>loginProcessingUrl</code> ，那么就会进入这个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">loginProcessingUrl</span><span class="params">(String loginProcessingUrl)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.loginProcessingUrl = loginProcessingUrl;</span><br><span class="line">   authFilter</span><br><span class="line">         .setRequiresAuthenticationRequestMatcher(createLoginProcessingUrlMatcher(loginProcessingUrl));</span><br><span class="line">   <span class="keyword">return</span> getSelf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>🐢之疑问二：在提交的表单中，参数分别为 username 和 password，可不可以自定义呢？</p><p>首先还是去 <code>FormLoginConfigurer</code> 类中看看构造方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FormLoginConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>(<span class="keyword">new</span> UsernamePasswordAuthenticationFilter(), <span class="keyword">null</span>);</span><br><span class="line">   usernameParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">   passwordParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的 super 根据 👆 的继承关系，就可以知道是 <code>AbstractAuthenticationFilterConfigurer</code> 中的构造：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractAuthenticationFilterConfigurer</span><span class="params">(F authenticationFilter,</span></span></span><br><span class="line"><span class="function"><span class="params">      String defaultLoginProcessingUrl)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>();</span><br><span class="line">   <span class="comment">// 将传进来的参数赋值给这个类的 authFilter</span></span><br><span class="line">   <span class="keyword">this</span>.authFilter = authenticationFilter;</span><br><span class="line">   <span class="keyword">if</span> (defaultLoginProcessingUrl != <span class="keyword">null</span>) &#123;</span><br><span class="line">      loginProcessingUrl(defaultLoginProcessingUrl);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：这里为什么能传参，是由于 </p><p>UsernamePasswordAuthenticationFilter 继承 AbstractAuthenticationProcessingFilter</p><p>且 F extends AbstractAuthenticationProcessingFilter</p></blockquote><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928160656.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928160656.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200928160655402"></p><p>此时已经有了 <code>UsernamePasswordAuthenticationFilter</code> 的实例了，接着执行 <code>usernameParameter</code> 和 <code>passwordParameter</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">usernameParameter</span><span class="params">(String usernameParameter)</span> </span>&#123;</span><br><span class="line">   getAuthenticationFilter().setUsernameParameter(usernameParameter);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">passwordParameter</span><span class="params">(String passwordParameter)</span> </span>&#123;</span><br><span class="line">   getAuthenticationFilter().setPasswordParameter(passwordParameter);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的 <code>getAuthenticationFilter</code> 是父类的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> F <span class="title">getAuthenticationFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> authFilter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里就很明确了，就是将刚才的 new UsernamePasswordAuthenticationFilter() 放到这里面分别调用 <code>setUsernameParameter</code> 和 <code>setPasswordParameter</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsernameParameter</span><span class="params">(String usernameParameter)</span> </span>&#123;</span><br><span class="line">    Assert.hasText(usernameParameter, <span class="string">&quot;Username parameter must not be empty or null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.usernameParameter = usernameParameter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPasswordParameter</span><span class="params">(String passwordParameter)</span> </span>&#123;</span><br><span class="line">    Assert.hasText(passwordParameter, <span class="string">&quot;Password parameter must not be empty or null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.passwordParameter = passwordParameter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里，usernameParameter 和 passwordParameter 就已经被赋好值了</p><p>再通过这个类 (<code>UsernamePasswordAuthenticationFilter</code>) 中的这两个方法从登录请求中拿到这两个值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">obtainPassword</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.passwordParameter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">obtainUsername</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.usernameParameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么自定义就很简单了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">                  <span class="comment">// 只需要设置以下两项就行</span></span><br><span class="line">            .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>🐢之疑问三：登录成功 or 失败后的重定向的地址，注销登录的地址如何自定义？</p><table><thead><tr><th>登录成功</th><th>登录失败</th></tr></thead><tbody><tr><td>defaultSuccessUrl</td><td>failureForwardUrl</td></tr><tr><td>successForwardUrl</td><td>failureUrl</td></tr></tbody></table><p>区别简单来说就是：</p><p><code>defaultSuccessUrl </code> 可能你访问的地址是 <a href="http://localhost:8080/security">http://localhost:8080/security</a> 但是你没登录，所以你就跳转到 <a href="http://localhost:8080/login">http://localhost:8080/login</a> 页面下，如果你登录成功，那么就会回到 /security 页面</p><p><code>successForwardUrl</code> 不管是什么页面，登录成功一律是你设置的页面</p><p>登录失败同理</p><p><code>注销登录</code> </p><p>看下面的代码</p><p>logoutUrl：用来注销的地址，默认为 “/logout”</p><p>logoutRequestMatcher：改变注销地址，还有请求方式</p><p>logoutSuccessUrl：注销登录成功后，要跳转的地址</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 注销登录设置</span></span><br><span class="line">            .logout()</span><br><span class="line">            .logoutUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .logoutRequestMatcher(<span class="keyword">new</span> AntPathRequestMatcher(<span class="string">&quot;/logout&quot;</span>,<span class="string">&quot;POST&quot;</span>))</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                 <span class="comment">// 登录设置</span></span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 下面两个只需要一个</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .successForwardUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 下面两个只需要一个</span></span><br><span class="line">            .failureForwardUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .failureUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (一)</title>
    <link href="http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/"/>
    <id>http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/</id>
    <published>2020-09-27T10:52:23.000Z</published>
    <updated>2020-09-30T07:09:23.777Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>Java 中权限管理最常用的技术应该就是：Spring Security 和 Shiro。</p><p>虽然 Shiro 用它轻量、简单、易于集成占据一席之地，但随着 SpringBoot 的流行，Spring Security 也跟着鸡犬升天，就目前的趋势来看，Spring Security 结合 Oauth2、JWT 等更加方便。</p><p>这次先小试牛刀一下，快速入门……</p><h2 id="二、Environment"><a href="#二、Environment" class="headerlink" title="二、Environment"></a>二、Environment</h2><p><code>不想 error ，先看依赖</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927100536.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927100536.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927100528688"></p><blockquote><p>没看错，就只需要这两个依赖就行</p></blockquote><p><code>pom.xml</code> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--security--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>SecurityController</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/security&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;spring security&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、Test"><a href="#三、Test" class="headerlink" title="三、Test"></a>三、Test</h2><p>启动项目可以看见，在控制台多了一行：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101458.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101458.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101455744"></p><p><code>Postman</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101707.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101707.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101705136"></p><blockquote><p>可以看见报错：401，没有进行认证</p></blockquote><p><code>加上认证</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101924.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101922872"></p><blockquote><p>可以看见，加上 Basic Auth：</p><p>其中用户名为 user，密码为刚才控制台显示的即可</p></blockquote><h2 id="四、Deep-Learning"><a href="#四、Deep-Learning" class="headerlink" title="四、Deep Learning"></a>四、Deep Learning</h2><p>🐢之疑问：为啥用户名是 user，密码就是控制台显示的那个？</p><p>分析思路：</p><p>用户名和密码肯定在一起，这个密码又是 UUID 形式，某个地方肯定用了 UUID.randomUUID().toString()</p><p>按照我们对 SpringBoot 的特性，肯定在 XXXAutoConfiguration 和 XXXProperties 中存在，果然在 SecurityProperties 中看到了：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104212.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927104210784"></p><p>接下来，我们要去找一找，在哪里有调用 getPassword 的这个方法的类：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104415.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104415.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927104411301"></p><p>看名字应该就是：<code>UserDetailsServiceAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getOrDeducePassword</span><span class="params">(SecurityProperties.User user, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">   String password = user.getPassword();</span><br><span class="line">   <span class="keyword">if</span> (user.isPasswordGenerated()) &#123;</span><br><span class="line">      logger.info(String.format(<span class="string">&quot;%n%nUsing generated security password: %s%n&quot;</span>, user.getPassword()));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (encoder != <span class="keyword">null</span> || PASSWORD_ALGORITHM_PATTERN.matcher(password).matches()) &#123;</span><br><span class="line">      <span class="keyword">return</span> password;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> NOOP_PASSWORD_PREFIX + password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><p>user.isPasswordGenerated() 如果为 true，则打印该信息</p></blockquote><p>再去 ==user.isPasswordGenerated()== 方法中探究一下，回到了==SecurityProperties== 类中了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> passwordGenerated = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">      .......</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPasswordGenerated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.passwordGenerated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>默认情况下：passwordGenerated 就是为 true</p></blockquote><p>🐢之疑问：每次启动都要输入新的的密码，太麻烦了，我需要自定义</p><p><code>第一种方法：</code></p><p>按照 SpringBoot 的特性，必然已经给你安排好了，肯定有一种方法是在 properties 文件中直接进行：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927110312.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927110312.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927110311399"></p><p><code>idea</code> 已经通过提示显示出来了, <strong>idea yyds !</strong></p><p>直接点进去看一下，回跳到哪个类中，不出🐢🐢的所料，应该就是 ==SecurityProperties== 类中：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112809.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112809.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927112805908"></p><p>果不其然，分别跳到了</p><p><code>setName</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>setPassword</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!StringUtils.hasLength(password)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">this</span>.passwordGenerated = <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：如果在这里自定义了密码，就会将 ==passwordGenerated== 设置为 false，那么在 ==isPasswordGenerated== 就是 false 了，在 ==UserDetailsServiceAutoConfiguration== 中就不会自动生成密码了</p></blockquote><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.user.name</span>=<span class="string">wangba</span></span><br><span class="line"><span class="meta">spring.security.user.password</span>=<span class="string">8888</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112305.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112305.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927112303555"></p><p><code>第二种方法：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 不对密码进行任何编码方式</span></span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">&quot;wangba&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;guigui&quot;</span>)</span><br><span class="line">                .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927160833.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927160833.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927160832690"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Session</title>
    <link href="http://wangba.me/2020/09/22/SpringBoot%E6%95%B4%E5%90%88Session/"/>
    <id>http://wangba.me/2020/09/22/SpringBoot%E6%95%B4%E5%90%88Session/</id>
    <published>2020-09-22T13:43:13.000Z</published>
    <updated>2020-09-30T07:09:20.959Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><blockquote><p>Spring Session has the simple goal of free up session management from the limitations of the HTTP session stored in the server.</p><p>The solution makes it easy to share session data between services in the cloud without being tied to a single container (i.e. Tomcat). Additionally, it supports multiple sessions in the same browser and sending sessions in a header.</p></blockquote><p>简单地来说：由架构导致了这种情况的发生</p><p><code>present</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922201419.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922201419.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922201418003"></p><p>最早的架构就是很简单的单服务器状态，如果我们要保存用户状态，那么只需要一个 session 就行了</p><p><code>now</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922200615.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922200615.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922200614157"></p><p>现在的架构都是集群式了：可以假设这样的情景，如果我在已经登录的状态，我首先要看视频 (这个服务假如在 A 服务器上)，然后我又浏览图片 (这个服务假如在 B 服务器上)，如果不共享 session 的话，那么我选择的服务不在一个服务器上就要重新登录了，这对用户也太不友好了。</p><p><code>解决方案 </code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922200856.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922200856.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922200847137"></p><p>主流的解决方案：将 seesion 存到 redis 中，每次 server 要向 session 中写数据，或者要读 session 的数据时，都是对 redis 中的 session 进行操作。</p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p><code>不想 error ，先看依赖</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922202750.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922202750.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922202748557"></p><p><code>pom.xml</code> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring session--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.properties</code> </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis 基本配置</span></span><br><span class="line"><span class="comment"># 地址</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">10.2.10.115</span></span><br><span class="line"><span class="comment"># 端口号  默认就是 6379</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line"><span class="meta">spring.redis.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"># 第几个数据库  默认就是第0号数据库</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure><p><code>SessionController</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    Integer port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/set&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;wangba&quot;</span>, <span class="string">&quot;8888&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;user&quot;</span>) + <span class="string">&quot;:&quot;</span> + port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><p>访问：<a href="http://localhost:8080/set">http://localhost:8080/set</a></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922210637.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922210637.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922210635181"></p><p>此时打开 redis 看一下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922212207.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922212207.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922212205673"></p><p>再访问：<a href="http://localhost:8081/get">http://localhost:8081/get</a></p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922212407.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200922212407.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200922212405236" style="zoom:150%;" /><p>可以看到此时，在不同的服务上可以通过共享 session </p><blockquote><p>注：这边可以通过 nginx 进行负载均衡</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Session" scheme="http://wangba.me/tags/Session/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Redis</title>
    <link href="http://wangba.me/2020/09/16/SpringBoot%E6%95%B4%E5%90%88Redis/"/>
    <id>http://wangba.me/2020/09/16/SpringBoot%E6%95%B4%E5%90%88Redis/</id>
    <published>2020-09-16T13:34:57.000Z</published>
    <updated>2020-09-30T07:09:18.512Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>面试官：redis 知道吗</p><p>🐢：不知道</p><p>面试官：你回去等通知吧</p><blockquote><p><strong>Redis</strong>是一个使用<a href="https://zh.wikipedia.org/wiki/ANSI_C">ANSI C</a>编写的<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%BA%90">开源</a>、支持<a href="https://zh.wikipedia.org/wiki/%E7%94%B5%E8%84%91%E7%BD%91%E7%BB%9C">网络</a>、基于<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AD%98">内存</a>、可选<a href="https://zh.wikipedia.org/w/index.php?title=%E6%8C%81%E4%B9%85%E6%80%A7_(%E6%95%B0%E6%8D%AE%E5%BA%93)&action=edit&redlink=1">持久性</a>的<a href="https://zh.wikipedia.org/wiki/%E9%94%AE%E5%80%BC-%E5%80%BC%E6%95%B0%E6%8D%AE%E5%BA%93">键值对存储数据库</a>。从2015年6月开始，Redis的开发由<a href="https://zh.wikipedia.org/w/index.php?title=Redis_Labs&action=edit&redlink=1">Redis Labs</a>赞助，而2013年5月至2015年6月期间，其开发由<a href="https://zh.wikipedia.org/wiki/Pivotal">Pivotal</a>赞助。在2013年5月之前，其开发由<a href="https://zh.wikipedia.org/wiki/VMware">VMware</a>赞助。<a href="https://zh.wikipedia.org/wiki/Redis#cite_note-5)%E6%A0%B9%E6%8D%AE%E6%9C%88%E5%BA%A6%E6%8E%92%E8%A1%8C%E7%BD%91%E7%AB%99DB-Engines.com%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8CRedis%E6%98%AF%E6%9C%80%E6%B5%81%E8%A1%8C%E7%9A%84%E9%94%AE%E5%80%BC%E5%AF%B9%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82">https://zh.wikipedia.org/wiki/Redis#cite_note-5)根据月度排行网站DB-Engines.com的数据，Redis是最流行的键值对存储数据库。</a>                                                           ——–维基百科</p></blockquote><p>我记得我看过一篇讲的非常好的 NoSQL 的文章，下次找到加进来。</p><p>增加：<a href="https://www.cnblogs.com/xrq730/p/11039384.html">关系型数据库与非关系型数据库</a></p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p><code>Redis</code></p><p>首先准备好 redis 的环境，此次 redis 是安装在 Ubuntu 18.04 上的，主要配置如下：</p><p>可以使用 <code>sudo vi /etc/redis/redis.conf</code> 命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  该指令允许您声明一个init系统来管理Redis作为服务，从而为您提供对其操作的更多控制</span></span><br><span class="line">supervised systemd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了局域网能连接上</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1 ::1</span><br><span class="line">    改为</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了局域网能连接上</span></span><br><span class="line">protected-mode yes</span><br><span class="line">    改为</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改密码，非必须</span></span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure><p>常用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 redis 配置</span></span><br><span class="line">sudo vi /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 redis 服务</span></span><br><span class="line">sudo service redis restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 redis 服务</span></span><br><span class="line">sudo service redis start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭 redis 服务</span></span><br><span class="line">sudo service redis stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 redis 客户端，其中 -p 指定端口，-a 表示认证即密码</span></span><br><span class="line">redis-cli -p 6379 -a 123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 redis 里面的一些命令</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">127.0.0.1:6379&gt; get key的名字</span><br></pre></td></tr></table></figure><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis 基本配置</span></span><br><span class="line"><span class="comment"># 地址</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">10.2.10.108</span></span><br><span class="line"><span class="comment"># 端口号  默认就是 6379</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line"><span class="meta">spring.redis.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"># 第几个数据库  默认就是第0号数据库</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure><h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><p><code>RedisController</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStringRedisTemplate</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/put&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.opsForValue();</span><br><span class="line">        ops.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.opsForValue();</span><br><span class="line">        <span class="keyword">return</span> ops.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Postman</code></p><p>首先将 redis 清空：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213048.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213048.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200916213040993"></p><p><strong>插入：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213139.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213139.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200916213138474"></p><p>看下 redis 中：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213216.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213216.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200916213213677"></p><p><strong>查询：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213252.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200916213252.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200916213251374"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="NoSQL" scheme="http://wangba.me/tags/NoSQL/"/>
    
  </entry>
  
  <entry>
    <title>铁氏王朝满汉全席 919</title>
    <link href="http://wangba.me/2020/09/15/%E9%93%81%E6%B0%8F%E7%8E%8B%E6%9C%9D%E6%BB%A1%E6%B1%89%E5%85%A8%E5%B8%AD-919/"/>
    <id>http://wangba.me/2020/09/15/%E9%93%81%E6%B0%8F%E7%8E%8B%E6%9C%9D%E6%BB%A1%E6%B1%89%E5%85%A8%E5%B8%AD-919/</id>
    <published>2020-09-15T13:23:00.000Z</published>
    <updated>2020-09-30T07:09:13.230Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 align=center>919 铁氏王朝满汉全席 v1.3</h1><h2 id="清蒸大闸蟹-5只"><a href="#清蒸大闸蟹-5只" class="headerlink" title="清蒸大闸蟹  5只"></a>清蒸大闸蟹  5只</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>阳澄湖大闸蟹</td><td><a href="https://www.douguo.com/caipu/%E7%94%9F%E5%A7%9C">生姜</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E8%92%9C%E7%93%A3">蒜瓣</a></td><td><a href="https://www.douguo.com/caipu/%E9%A6%99%E8%91%B1">香葱</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%B4%AB%E8%8B%8F">紫苏</a></td><td><a href="https://www.douguo.com/caipu/%E7%94%9F%E6%8A%BD">生抽</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E9%A6%99%E9%86%8B">香醋</a></td><td><a href="https://www.douguo.com/caipu/%E6%96%99%E9%85%92">料酒</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E9%A6%99%E6%B2%B9">香油</a></td><td><a href="https://www.douguo.com/caipu/%E9%B8%A1%E7%B2%BE">鸡精</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%B3%96">糖</a></td><td></td></tr></tbody></table><h2 id="可乐鸡翅"><a href="#可乐鸡翅" class="headerlink" title="可乐鸡翅"></a>可乐鸡翅</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th><a href="https://www.douguo.com/caipu/%E9%B8%A1%E7%BF%85">鸡翅</a>10个</th><th><a href="https://www.douguo.com/caipu/%E5%8F%AF%E4%B9%90">可乐</a>300毫升</th></tr></thead><tbody><tr><td><a href="https://www.douguo.com/caipu/%E8%80%81%E6%8A%BD">老抽</a>1勺</td><td>盐，鸡精适量</td></tr><tr><td>葱姜，八角适量</td><td></td></tr></tbody></table><h2 id="糖醋排骨"><a href="#糖醋排骨" class="headerlink" title="糖醋排骨"></a>糖醋排骨</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th><a href="https://www.douguo.com/caipu/%E7%8C%AA%E8%82%8B%E6%8E%92">猪肋排</a>500克</th><th><a href="https://www.douguo.com/caipu/%E8%91%B1">葱</a>适量</th></tr></thead><tbody><tr><td><a href="https://www.douguo.com/caipu/%E5%A7%9C">姜</a>适量</td><td><a href="https://www.douguo.com/caipu/%E5%85%AB%E8%A7%92">八角</a>2个</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E8%80%81%E6%8A%BD">老抽</a>2勺</td><td><a href="https://www.douguo.com/caipu/%E7%94%9F%E6%8A%BD">生抽</a>2勺</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%99%BD%E7%B3%96">白糖</a>3勺</td><td><a href="https://www.douguo.com/caipu/%E9%A6%99%E9%86%8B">香醋</a>4勺</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E6%96%99%E9%85%92">料酒</a>5勺</td><td><a href="https://www.douguo.com/caipu/%E7%86%9F%E7%99%BD%E8%8A%9D%E9%BA%BB">熟白芝麻</a>适量</td></tr></tbody></table><h2 id="麻辣小龙虾"><a href="#麻辣小龙虾" class="headerlink" title="麻辣小龙虾"></a>麻辣小龙虾</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th><a href="https://www.douguo.com/caipu/%E5%B0%8F%E9%BE%99%E8%99%BE">小龙虾</a>30斤</th><th><a href="https://www.douguo.com/caipu/%E9%A6%99%E8%91%B1">香葱</a>适量</th></tr></thead><tbody><tr><td><a href="https://www.douguo.com/caipu/%E5%A7%9C">姜</a>适量</td><td><a href="https://www.douguo.com/caipu/%E8%92%9C">蒜</a>适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E5%A4%A7%E8%91%B1">大葱</a>适量</td><td><a href="https://www.douguo.com/caipu/%E6%A1%82%E7%9A%AE">桂皮</a>适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E5%85%AB%E8%A7%92">八角</a>适量</td><td><a href="https://www.douguo.com/caipu/%E9%A6%99%E5%8F%B6">香叶</a>适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%B4%AB%E8%8B%8F">紫苏</a>适量</td><td><a href="https://www.douguo.com/caipu/%E5%B0%8F%E7%B1%B3%E6%A4%92">小米椒</a>适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E5%86%B0%E7%B3%96">冰糖</a>适量</td><td>藕条适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E9%9D%92%E6%A4%92">青椒</a>适量</td><td>红油火锅底料适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E8%B1%86%E7%93%A3%E9%85%B1">豆瓣酱</a>适量</td><td><a href="https://www.douguo.com/caipu/%E6%B7%80%E7%B2%89">淀粉</a>适量</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%99%BD%E8%8A%9D%E9%BA%BB">白芝麻</a>适量</td><td></td></tr></tbody></table><h2 id="芝士培根泡菜卷"><a href="#芝士培根泡菜卷" class="headerlink" title="芝士培根泡菜卷"></a>芝士培根泡菜卷</h2><blockquote><p>材料：</p></blockquote><h2 id="蒜蓉金针菇"><a href="#蒜蓉金针菇" class="headerlink" title="蒜蓉金针菇"></a>蒜蓉金针菇</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th><a href="https://www.douguo.com/caipu/%E9%87%91%E9%92%88%E8%8F%87">金针菇</a>1把</th><th><a href="https://www.douguo.com/caipu/%E8%92%9C">蒜</a>一头</th></tr></thead><tbody><tr><td><a href="https://www.douguo.com/caipu/%E9%A3%9F%E7%94%A8%E6%B2%B9">食用油</a>适量</td><td><a href="https://www.douguo.com/caipu/%E9%85%B1%E6%B2%B9">酱油</a>4勺</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E8%9A%9D%E6%B2%B9">蚝油</a>2勺</td><td><a href="https://www.douguo.com/caipu/%E5%B0%8F%E8%91%B1">小葱</a>4根</td></tr><tr><td><a href="https://www.douguo.com/caipu/%E9%B8%A1%E7%B2%BE">鸡精</a>适量</td><td><a href="https://www.douguo.com/caipu/%E7%B3%96">糖</a></td></tr><tr><td><a href="https://www.douguo.com/caipu/%E7%9B%90">盐</a></td><td></td></tr></tbody></table><h2 id="酒酿小汤圆冲鸡蛋"><a href="#酒酿小汤圆冲鸡蛋" class="headerlink" title="酒酿小汤圆冲鸡蛋"></a>酒酿小汤圆冲鸡蛋</h2><blockquote><p>材料：</p></blockquote><h2 id="姜撞奶"><a href="#姜撞奶" class="headerlink" title="姜撞奶"></a>姜撞奶</h2><blockquote><p>材料：</p></blockquote><table><thead><tr><th><a href="https://www.douguo.com/caipu/%E8%80%81%E5%A7%9C">老姜</a>1大块</th><th><a href="https://www.douguo.com/caipu/%E7%BA%AF%E7%89%9B%E5%A5%B6">纯牛奶</a>200毫升</th></tr></thead><tbody><tr><td><a href="https://www.douguo.com/caipu/%E7%BB%86%E7%A0%82%E7%B3%96">细砂糖</a>适量</td><td><a href="https://www.douguo.com/caipu/%E8%94%93%E8%B6%8A%E8%8E%93%E5%B9%B2">蔓越莓干</a>少许</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="WangBa&#39;s CookBook" scheme="http://wangba.me/categories/WangBa-s-CookBook/"/>
    
    
    <category term="CookBook" scheme="http://wangba.me/tags/CookBook/"/>
    
    <category term="Life" scheme="http://wangba.me/tags/Life/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Data JPA 之多条件搜索工具类</title>
    <link href="http://wangba.me/2020/09/14/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B9%8B%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <id>http://wangba.me/2020/09/14/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B9%8B%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2%E5%B7%A5%E5%85%B7%E7%B1%BB/</id>
    <published>2020-09-14T12:21:20.000Z</published>
    <updated>2020-09-30T07:08:37.925Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在前面已经介绍过了 <a href="http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%BA%8C/">SpringBoot 整合 JPA </a>了，但是一般在公司业务中，如果出现很多次多条件搜索查询的情况，那么就会用大量冗余代码了；再结合注解的思想。本次将公共部分提取出来，并用注解的方式进行操作，可以参考前面使用<a href="http://wangba.me/2020/09/03/SpringBoot%E6%95%B4%E5%90%88AOP/">注解进行 AOP 处理日志</a>，也符合了 SpringBoot 的思想。</p><h2 id="二、BaseQuery"><a href="#二、BaseQuery" class="headerlink" title="二、BaseQuery"></a>二、BaseQuery</h2><p><code>QueryWord</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> QueryWord &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库中字段名,默认为空字符串,则Query类中的字段要与数据库中字段一致</span></span><br><span class="line">    <span class="function">String <span class="title">column</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// equal, like, gt, lt...</span></span><br><span class="line">    <span class="function">MatchType <span class="title">func</span><span class="params">()</span> <span class="keyword">default</span> MatchType.equal</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// object是否可以为null</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">nullable</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串是否可为空</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// between...and... 查询语句标识， 0时间  1数字类型</span></span><br><span class="line">    <span class="function">BetweenType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> BetweenType.datetime</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：注解类，只要在要查询的属性上加上相应的注解即可</p></blockquote><p><code>MatchType</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MatchType &#123;</span><br><span class="line"></span><br><span class="line">    equal,                 <span class="comment">// filed = value</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面四个用于Number类型的比较</span></span><br><span class="line">    gt,                     <span class="comment">// filed &gt; value</span></span><br><span class="line">    ge,                     <span class="comment">// field &gt;= value</span></span><br><span class="line">    lt,                     <span class="comment">// field &lt; value</span></span><br><span class="line">    le,                     <span class="comment">// field &lt;= value</span></span><br><span class="line"></span><br><span class="line">    notEqual,               <span class="comment">// field != value</span></span><br><span class="line">    like,                   <span class="comment">// field like value</span></span><br><span class="line">    notLike,                <span class="comment">// field not like value</span></span><br><span class="line">    between,                <span class="comment">// between value1 and value2 ,Type is Date</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面四个用于可比较类型(Comparable)的比较</span></span><br><span class="line">    greaterThan,            <span class="comment">// field &gt; value</span></span><br><span class="line">    greaterThanOrEqualTo,   <span class="comment">// field &gt;= value</span></span><br><span class="line">    lessThan,               <span class="comment">// field &lt; value</span></span><br><span class="line">    lessThanOrEqualTo       <span class="comment">// field &lt;= value</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：枚举类，可以对比注释进行理解</p></blockquote><p><code>BetweenType</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span>  BetweenType &#123;</span><br><span class="line"></span><br><span class="line">    datetime,</span><br><span class="line">    number_long,</span><br><span class="line">    number_integer</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：对应上面 <code>QueryWord</code>中的 BetweenType ，可以对时间或数字之间的属性进行注解</p></blockquote><p><code>BaseQuery</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseQuery</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第多少页 + 页大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageNum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Class, List&lt;Field&gt;&gt; fieldCache = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Specification&lt;T&gt; <span class="title">toSpec</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pageable <span class="title">toPageable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PageRequest.of(pageNum, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 分页 + 排序</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pageable <span class="title">toPageable</span><span class="params">(Sort sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PageRequest.of(pageNum, pageSize, sort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态查询 and 连接</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Specification&lt;T&gt; <span class="title">toSpecWithAnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.toSpecWithLogicType(<span class="string">&quot;and&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态查询 or 连接</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Specification&lt;T&gt; <span class="title">toSpecWithOr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.toSpecWithLogicType(<span class="string">&quot;or&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// logicType = or ｜ and</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Specification&lt;T&gt; <span class="title">toSpecWithLogicType</span><span class="params">(<span class="keyword">final</span> String logicType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BaseQuery outerThis = <span class="keyword">this</span>;</span><br><span class="line">        <span class="comment">// 封装条件查询对象 Specification</span></span><br><span class="line">        Specification&lt;T&gt; specification = <span class="keyword">new</span> Specification&lt;T&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// Root 用于获取属性字段，CriteriaQuery可以用于简单条件查询，CriteriaBuilder 用于构造复杂条件查询</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">                Class clazz = outerThis.getClass();</span><br><span class="line">                <span class="comment">// 判断缓存中是否已经存在，存在不需要再次生成，不存在需要重新生成</span></span><br><span class="line">                List&lt;Field&gt; fields = fieldCache.get(clazz);</span><br><span class="line">                <span class="keyword">if</span> (fields == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 获取查询类Query的所有字段,包括父类字段</span></span><br><span class="line">                    fields = getAllFieldsWithRoot(clazz);</span><br><span class="line">                    fieldCache.put(clazz, fields);</span><br><span class="line">                &#125;</span><br><span class="line">                List&lt;Predicate&gt; predicates = <span class="keyword">new</span> ArrayList&lt;&gt;(fields.size());</span><br><span class="line">                <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                    <span class="comment">// 获取字段上的 @QueryWord 注解</span></span><br><span class="line">                    QueryWord qw = field.getAnnotation(QueryWord.class);</span><br><span class="line">                    <span class="keyword">if</span> (qw == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 获取字段名</span></span><br><span class="line">                    String column = qw.column();</span><br><span class="line">                    <span class="comment">//如果主注解上 column 为默认值&quot;&quot;,则以 field 为准</span></span><br><span class="line">                    <span class="keyword">if</span> (column.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                        column = field.getName();</span><br><span class="line">                    &#125;</span><br><span class="line">                    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// nullable</span></span><br><span class="line">                        Object value = field.get(outerThis);</span><br><span class="line">                        <span class="comment">// 如果值为 null,注解未标注 nullable,跳过</span></span><br><span class="line">                        <span class="keyword">if</span> (value == <span class="keyword">null</span> &amp;&amp; !qw.nullable()) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// can be empty</span></span><br><span class="line">                        <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; String.class.isAssignableFrom(value.getClass())) &#123;</span><br><span class="line">                            String s = (String) value;</span><br><span class="line">                            <span class="comment">//如果值为&quot;&quot;,且注解未标注 empty ,跳过</span></span><br><span class="line">                            <span class="keyword">if</span> (s.equals(<span class="string">&quot;&quot;</span>) &amp;&amp; !qw.empty()) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//通过注解上 func 属性,构建路径表达式</span></span><br><span class="line">                        Path path = root.get(column);</span><br><span class="line">                        <span class="keyword">switch</span> (qw.func()) &#123;</span><br><span class="line">                            <span class="keyword">case</span> equal:</span><br><span class="line">                                predicates.add(cb.equal(path, value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> like:</span><br><span class="line">                                predicates.add(cb.like(path, <span class="string">&quot;%&quot;</span> + value + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> gt:</span><br><span class="line">                                predicates.add(cb.gt(path, (Number) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> lt:</span><br><span class="line">                                predicates.add(cb.lt(path, (Number) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> ge:</span><br><span class="line">                                predicates.add(cb.ge(path, (Number) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> le:</span><br><span class="line">                                predicates.add(cb.le(path, (Number) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> notEqual:</span><br><span class="line">                                predicates.add(cb.notEqual(path, value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> notLike:</span><br><span class="line">                                predicates.add(cb.notLike(path, <span class="string">&quot;%&quot;</span> + value + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> greaterThan:</span><br><span class="line">                                predicates.add(cb.greaterThan(path, (Comparable) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> greaterThanOrEqualTo:</span><br><span class="line">                                predicates.add(cb.greaterThanOrEqualTo(path, (Comparable) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> lessThan:</span><br><span class="line">                                predicates.add(cb.lessThan(path, (Comparable) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> lessThanOrEqualTo:</span><br><span class="line">                                predicates.add(cb.lessThanOrEqualTo(path, (Comparable) value));</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">case</span> between:</span><br><span class="line">                                <span class="keyword">switch</span> (qw.type()) &#123;</span><br><span class="line">                                    <span class="keyword">case</span> datetime:</span><br><span class="line">                                        List&lt;Date&gt; dateList = (List&lt;Date&gt;) value;</span><br><span class="line">                                        predicates.add(cb.between(path, dateList.get(<span class="number">0</span>), dateList.get(<span class="number">1</span>)));</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">case</span> number_long:</span><br><span class="line">                                        List&lt;Long&gt; longList = (List&lt;Long&gt;) value;</span><br><span class="line">                                        predicates.add(cb.between(path, longList.get(<span class="number">0</span>), longList.get(<span class="number">1</span>)));</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">case</span> number_integer:</span><br><span class="line">                                        List&lt;Integer&gt; integerList = (List&lt;Integer&gt;) value;</span><br><span class="line">                                        predicates.add(cb.between(path, integerList.get(<span class="number">0</span>), integerList.get(<span class="number">1</span>)));</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Predicate p = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (logicType == <span class="keyword">null</span> || logicType.equals(<span class="string">&quot;&quot;</span>) || logicType.equals(<span class="string">&quot;and&quot;</span>)) &#123;</span><br><span class="line">                    p = cb.and(predicates.toArray(<span class="keyword">new</span> Predicate[predicates.size()])); <span class="comment">// and 连接</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (logicType.equals(<span class="string">&quot;or&quot;</span>)) &#123;</span><br><span class="line">                    p = cb.or(predicates.toArray(<span class="keyword">new</span> Predicate[predicates.size()]));  <span class="comment">// or 连接</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> specification;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取类 clazz 的所有 Field，包括其父类的 Field</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Field&gt; <span class="title">getAllFieldsWithRoot</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        List&lt;Field&gt; fieldList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Field[] dFields = clazz.getDeclaredFields(); <span class="comment">//获取本类所有字段</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != dFields &amp;&amp; dFields.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            fieldList.addAll(Arrays.asList(dFields));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 若父类是 Object，则直接返回当前 Field 列表</span></span><br><span class="line">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span><br><span class="line">        <span class="keyword">if</span> (superClass == Object.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.asList(dFields);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 递归查询父类的 Field 列表</span></span><br><span class="line">        List&lt;Field&gt; superFields = getAllFieldsWithRoot(superClass);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != superFields &amp;&amp; !superFields.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Field field : superFields) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!fieldList.contains(field)) &#123;</span><br><span class="line">                    fieldList.add(field);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fieldList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageIndex</span><span class="params">(<span class="keyword">int</span> pageIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageNum = pageIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(<span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：最关键的类</p><ul><li>所有后面要查询的类都要继承它</li><li>简单的理解：通过反射获取注解上的字段信息，构造相应的搜索条件</li></ul></blockquote><h2 id="三、Test"><a href="#三、Test" class="headerlink" title="三、Test"></a>三、Test</h2><p><code>StudentQuery</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentQuery</span> <span class="keyword">extends</span> <span class="title">BaseQuery</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@QueryWord(column = &quot;id&quot;, func = MatchType.equal)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@QueryWord(func = MatchType.like)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 省略 set / get</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specification <span class="title">toSpec</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toSpecWithOr();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个查询中，使用的是 or 查询，测试类如下：</p><p><code>Test</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    StudentQuery studentQuery = <span class="keyword">new</span> StudentQuery();</span><br><span class="line">    studentQuery.setId(<span class="number">1L</span>);</span><br><span class="line">    studentQuery.setName(<span class="string">&quot;er&quot;</span>);</span><br><span class="line">    studentQuery.setPageIndex(<span class="number">0</span>);</span><br><span class="line">    studentQuery.setPageSize(<span class="number">10</span>);</span><br><span class="line">    Page page = studentRepository.findAll(studentQuery.toSpec(), studentQuery.toPageable());</span><br><span class="line">    <span class="keyword">for</span> (Object o : page.getContent()) &#123;</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：构造的条件是 id = 1的，或者 name = ? er ? 的 student</p></blockquote><p><code>结果</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200914200804.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200914200804.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200914200754861"></p><p>通过这个例子简单捋一下整个过程：</p><ol><li>通过 studentQuery.toSpec() 调用父类 BaseQuery；</li><li>在 BaseQuery 中，通过反射获得打了相应注解上的字段信息；</li><li>将字段信息加到搜索条件中，进行 or 或者 and 连接</li></ol><blockquote><p>注：如果你的业务中只用了很少的条件或者只用极个别的多条件查询，可以不用这个工具类</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="MySQL" scheme="http://wangba.me/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Data JPA(二)</title>
    <link href="http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%BA%8C/"/>
    <id>http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%BA%8C/</id>
    <published>2020-09-10T10:38:46.000Z</published>
    <updated>2020-09-30T07:08:31.365Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在上一篇文章中介绍了一下 Spring Data JPA 的一下简单的 CRUD，但是在公司业务中，不可能这么简单；且在业务中大部分都是查询业务，具体点就是动态查询，什么单表多条件查询、多表多条件查询等等……    </p><blockquote><p>注：使用环境还是和上一篇一样</p></blockquote><h2 id="二、自定义SQL查询"><a href="#二、自定义SQL查询" class="headerlink" title="二、自定义SQL查询"></a>二、自定义SQL查询</h2><p>如果想和这里面写原生的 SQL 语句，只要在 <strong>repository</strong> 中这样写就行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(nativeQuery = true,</span></span><br><span class="line"><span class="meta">        value = &quot;select * from Student where id = ?1&quot;)</span></span><br><span class="line"><span class="function">Student <span class="title">catchAllById</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li>如果要写原生 SQL，@Query 注解中的 nativeQuery 要设置为 true，默认为 false</li><li>函数名设置的不能与自带的冲突，例如：findById，如果设置了一样，就会导致使用的自带的 API 进行查询，而不是自定义的，如果真的想使用自定义覆盖自带的，可以在实体类上使用 @NamedQueries 注解</li></ul></blockquote><p>在这里我们就使用 @Test 进行测试：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911110259.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911110259.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911110257151"></p><p>还有一种使用 JPQL 语法的查询方式：</p><p><code>repository:</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(value = &quot;select s from Student s where s.name = ?1&quot;)</span></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">catchByName</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure><p><code>Test:</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911111044.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911111044.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911111044489"></p><p>关于 JPQL：和在 SQL 中一样，JPQL 中的 select 语句用于执行查询。其语法可表示为：<br><code>select_clause form_clause [where_clause] [groupby_clause] [having_clause] [orderby_clause]</code></p><p>其中：</p><ol><li>from 子句是查询语句的必选子句。</li><li>select 用来指定查询返回的结果实体或实体的某些属性。</li><li>from 子句声明查询源实体类，并指定标识符变量（相当于SQL表的别名）。</li><li>如果不希望返回重复实体，可使用关键字 distinct 修饰。select、from 都是 JPQL 的关键字，通常全大写或全小写，建议不要大小写混用。</li></ol><p>在 JPQL 中，查询所有实体的 JPQL 查询语句很简单，如下：<br><code>select o from Order o 或 select o from Order as o</code><br>这里关键字 as 可以省去，标识符变量的命名规范与 Java 标识符相同，且区分大小写</p><p>更多参考：<a href="https://docs.oracle.com/html/E13946_04/ejb3_langref.html">官网文档</a></p><h2 id="三、自定义简单查询"><a href="#三、自定义简单查询" class="headerlink" title="三、自定义简单查询"></a>三、自定义简单查询</h2><p>在 Spring Data JPA 的<a href="https://docs.spring.io/spring-data/jpa/docs/2.3.3.RELEASE/reference/html/#jpa.named-parameters">官网</a>也介绍了这种方式，一般这种方式在一些小项目中也经常使用：</p><table><thead><tr><th align="center">Keyword</th><th align="center">Sample</th><th align="center">JPQL snippet</th></tr></thead><tbody><tr><td align="center"><code>And</code></td><td align="center"><code>findByLastnameAndFirstname</code></td><td align="center"><code>… where x.lastname = ?1 and x.firstname = ?2</code></td></tr><tr><td align="center"><code>Or</code></td><td align="center"><code>findByLastnameOrFirstname</code></td><td align="center"><code>… where x.lastname = ?1 or x.firstname = ?2</code></td></tr><tr><td align="center"><code>Is</code>, <code>Equals</code></td><td align="center"><code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code></td><td align="center"><code>… where x.firstname = ?1</code></td></tr><tr><td align="center"><code>Between</code></td><td align="center"><code>findByStartDateBetween</code></td><td align="center"><code>… where x.startDate between ?1 and ?2</code></td></tr><tr><td align="center"><code>LessThan</code></td><td align="center"><code>findByAgeLessThan</code></td><td align="center"><code>… where x.age &lt; ?1</code></td></tr><tr><td align="center"><code>LessThanEqual</code></td><td align="center"><code>findByAgeLessThanEqual</code></td><td align="center"><code>… where x.age &lt;= ?1</code></td></tr><tr><td align="center"><code>GreaterThan</code></td><td align="center"><code>findByAgeGreaterThan</code></td><td align="center"><code>… where x.age &gt; ?1</code></td></tr><tr><td align="center"><code>GreaterThanEqual</code></td><td align="center"><code>findByAgeGreaterThanEqual</code></td><td align="center"><code>… where x.age &gt;= ?1</code></td></tr><tr><td align="center"><code>After</code></td><td align="center"><code>findByStartDateAfter</code></td><td align="center"><code>… where x.startDate &gt; ?1</code></td></tr><tr><td align="center"><code>Before</code></td><td align="center"><code>findByStartDateBefore</code></td><td align="center"><code>… where x.startDate &lt; ?1</code></td></tr><tr><td align="center"><code>IsNull</code>, <code>Null</code></td><td align="center"><code>findByAge(Is)Null</code></td><td align="center"><code>… where x.age is null</code></td></tr><tr><td align="center"><code>IsNotNull</code>, <code>NotNull</code></td><td align="center"><code>findByAge(Is)NotNull</code></td><td align="center"><code>… where x.age not null</code></td></tr><tr><td align="center"><code>Like</code></td><td align="center"><code>findByFirstnameLike</code></td><td align="center"><code>… where x.firstname like ?1</code></td></tr><tr><td align="center"><code>NotLike</code></td><td align="center"><code>findByFirstnameNotLike</code></td><td align="center"><code>… where x.firstname not like ?1</code></td></tr><tr><td align="center"><code>StartingWith</code></td><td align="center"><code>findByFirstnameStartingWith</code></td><td align="center"><code>… where x.firstname like ?1</code> (parameter bound with appended <code>%</code>)</td></tr><tr><td align="center"><code>EndingWith</code></td><td align="center"><code>findByFirstnameEndingWith</code></td><td align="center"><code>… where x.firstname like ?1</code> (parameter bound with prepended <code>%</code>)</td></tr><tr><td align="center"><code>Containing</code></td><td align="center"><code>findByFirstnameContaining</code></td><td align="center"><code>… where x.firstname like ?1</code> (parameter bound wrapped in <code>%</code>)</td></tr><tr><td align="center"><code>OrderBy</code></td><td align="center"><code>findByAgeOrderByLastnameDesc</code></td><td align="center"><code>… where x.age = ?1 order by x.lastname desc</code></td></tr><tr><td align="center"><code>Not</code></td><td align="center"><code>findByLastnameNot</code></td><td align="center"><code>… where x.lastname &lt;&gt; ?1</code></td></tr><tr><td align="center"><code>In</code></td><td align="center"><code>findByAgeIn(Collection&lt;Age&gt; ages)</code></td><td align="center"><code>… where x.age in ?1</code></td></tr><tr><td align="center"><code>NotIn</code></td><td align="center"><code>findByAgeNotIn(Collection&lt;Age&gt; ages)</code></td><td align="center"><code>… where x.age not in ?1</code></td></tr><tr><td align="center"><code>True</code></td><td align="center"><code>findByActiveTrue()</code></td><td align="center"><code>… where x.active = true</code></td></tr><tr><td align="center"><code>False</code></td><td align="center"><code>findByActiveFalse()</code></td><td align="center"><code>… where x.active = false</code></td></tr><tr><td align="center"><code>IgnoreCase</code></td><td align="center"><code>findByFirstnameIgnoreCase</code></td><td align="center"><code>… where UPPER(x.firstame) = UPPER(?1)</code></td></tr></tbody></table><p>原理大概如下：</p><p><strong>假如创建如下的查询：<code>findByUserDepUuid()</code>，框架在解析该方法时，首先剔除 findBy，然后对剩下的属性进行解析</strong></p><ol><li>先判断 userDepUuid （根据 POJO 规范，首字母变为小写）是否为查询实体的一个属性，如果是，则表示根据该属性进行查询；如果没有该属性，继续第二步；</li><li>从右往左截取第一个大写字母开头的字符串此处为Uuid），然后检查剩下的字符串是否为查询实体的一个属性，如果是，则表示根据该属性进行查询；如果没有该属性，则重复第二步，继续从右往左截取；最后假设user为查询实体的一个属性；</li><li>接着处理剩下部分（DepUuid），先判断 user 所对应的类型是否有depUuid属性，如果有，则表示该方法最终是根据 <code>Doc.user.depUuid</code> 的取值进行查询；否则继续按照步骤 2 的规则从右往左截取，最终表示根据 <code>Doc.user.dep.uuid</code> 的值进行查询。</li><li>可能会存在一种特殊情况，比如 Doc包含一个 user 的属性，也有一个 userDep 属性，此时会存在混淆。可以明确在属性之间加上 “_” 以显式表达意图，比如 <code>findByUser_DepUuid()</code> 或者 <code>findByUserDep_uuid()</code></li></ol><p><code>repository:</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByNameAndPwd</span><span class="params">(String name, String pwd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByNameStartingWith</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByNameEndingWith</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByNameContaining</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findByNameContainingOrderByIdDesc</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure><p><code>test:</code></p><p><strong>findByName</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112401.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112401.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911112401002"></p><p><strong>findByNameAndPwd</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112633.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112633.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911112633532"></p><p><strong>findByNameStartingWith</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112706.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112706.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911112706325"></p><p><strong>findByNameEndingWith</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112749.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112749.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911112749472"></p><p><strong>findByNameContaining</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112818.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911112818.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911112818300"></p><p><strong>findByNameContainingOrderByIdDesc</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911120538.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911120538.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911120538084"></p><h2 id="四、分页查询"><a href="#四、分页查询" class="headerlink" title="四、分页查询"></a>四、分页查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页 + 排序</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Sort sort = Sort.by(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">    PageRequest pageRequest = PageRequest.of(<span class="number">0</span>, <span class="number">2</span>, sort);</span><br><span class="line">    Page&lt;Student&gt; studentPage = studentRepository.findAll(pageRequest);</span><br><span class="line">    <span class="keyword">for</span> (Student student : studentPage.getContent()) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li>Sort.by(排序方式, 排序字段)</li><li>PageRequest.of(第多少页，页大小)    ——–&gt;     一般是写一个 PageUtils</li></ul></blockquote><p><code>Test</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911142717.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911142717.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911142717361"></p><h2 id="五、动态查询"><a href="#五、动态查询" class="headerlink" title="五、动态查询"></a>五、动态查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页 + 排序 + 搜索</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PageRequest pageRequest = PageRequest.of(<span class="number">0</span>, <span class="number">2</span>, Sort.by(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>));</span><br><span class="line">    Specification&lt;Student&gt; specification = <span class="keyword">new</span> Specification&lt;Student&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Student&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 增加搜索条件: id &lt;= 5</span></span><br><span class="line">            Predicate predicate = criteriaBuilder.lessThanOrEqualTo(root.get(<span class="string">&quot;id&quot;</span>), <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Page&lt;Student&gt; studentPage = studentRepository.findAll(specification, pageRequest);</span><br><span class="line">    <span class="keyword">for</span> (Student student : studentPage.getContent()) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li><p>root: 代表查询的实体类</p></li><li><p>query: 可以从中得到 Root 对象</p></li><li><p>criteriaBuilder: 用于创建 Criteria 相关对象的工厂</p></li><li><p>Predicate: 代表一个查询条件</p></li></ul></blockquote><p><code>Test:</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911143430.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911143430.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911143430602"></p><p><code>多条件：</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页 + 排序 + 搜索</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PageRequest pageRequest = PageRequest.of(<span class="number">0</span>, <span class="number">10</span>, Sort.by(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>));</span><br><span class="line">    List&lt;Predicate&gt; predicateList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Specification&lt;Student&gt; specification = <span class="keyword">new</span> Specification&lt;Student&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Student&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line">            predicateList.add(criteriaBuilder.lessThanOrEqualTo(root.get(<span class="string">&quot;id&quot;</span>), <span class="number">5</span>));</span><br><span class="line">            predicateList.add(criteriaBuilder.like(root.get(<span class="string">&quot;name&quot;</span>), <span class="string">&quot;%&quot;</span> + <span class="string">&quot;er&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> criteriaBuilder.and(predicateList.toArray(<span class="keyword">new</span> Predicate[predicateList.size()]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Page&lt;Student&gt; studentPage = studentRepository.findAll(specification, pageRequest);</span><br><span class="line">    <span class="keyword">for</span> (Student student : studentPage.getContent()) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Test:</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911150134.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200911150134.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200911150134356"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="MySQL" scheme="http://wangba.me/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Data JPA(一)</title>
    <link href="http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B8%80/"/>
    <id>http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B8%80/</id>
    <published>2020-09-10T10:38:30.000Z</published>
    <updated>2020-09-30T07:08:34.596Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><blockquote><p>JPA(Java Persistence API)是Sun官方提出的Java持久化规范。它为Java开发人员提供了一种对象/关联映射工具来管理Java应用中的关系数据。</p></blockquote><p>Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据的访问和操作。它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！</p><blockquote><p>spring data jpa让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现</p></blockquote><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/jpa</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string"></span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.jpa.database</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment"># 是否在控制台打印 sql 语句</span></span><br><span class="line"><span class="meta">spring.jpa.show-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 使用 InnoDB 作为引擎 </span></span><br><span class="line"><span class="meta">spring.jpa.database-platform</span>=<span class="string">org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line"><span class="comment"># 每次启动都会更新数据库，如：增加字段等，但是对某个字段进行改造是识别不出来</span></span><br><span class="line"><span class="meta">spring.jpa.hibernate.ddl-auto</span>=<span class="string">update</span></span><br></pre></td></tr></table></figure><p><code>entiy</code></p><p><strong>Student</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, columnDefinition = &quot;INT UNSIGNED COMMENT &#x27;自增主键&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;name&quot;, columnDefinition = &quot;VARCHAR(50) NOT NULL COMMENT &#x27;用户名&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;pwd&quot;, columnDefinition = &quot;VARCHAR(100) DEFAULT NULL COMMENT &#x27;密码&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 省略 set get</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Grade</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;grade&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Grade</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, columnDefinition = &quot;INT UNSIGNED COMMENT &#x27;自增主键&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;subject&quot;, columnDefinition = &quot;VARCHAR(50) NOT NULL COMMENT &#x27;学科&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;score&quot;, columnDefinition = &quot;TINYINT UNSIGNED NOT NULL COMMENT &#x27;成绩&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略 set get</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：这次使用两个表，为了后面进行复杂查询准备，这里的将两个表的自增 id 关联在一起，就不考虑多对多了</p></blockquote><p><code>repository</code></p><p><strong>StudentRepository</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Student</span>, <span class="title">Long</span>&gt;, <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>GradeRepository</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GradeRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Grade</span>, <span class="title">Long</span>&gt;, <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Grade</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在上次 aop 那里面就提过，由于继承的有 CRUD 的 repository 和一些其他的，这也是上面提到的解放 DAO 层的操作，具体的可以看下图</p></blockquote><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910145019.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910145019.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910145019869" style="zoom:150%;" /><h2 id="三、CRUD"><a href="#三、CRUD" class="headerlink" title="三、CRUD"></a>三、CRUD</h2><p><code>controller</code></p><p><strong>GradeController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/grade&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GradeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GradeRepository gradeRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGradeRepository</span><span class="params">(GradeRepository gradeRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gradeRepository = gradeRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Grade <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> Grade grade)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gradeRepository.save(grade);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Grade&gt; <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gradeRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Grade <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> Grade grade)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gradeRepository.save(grade);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> </span>&#123;</span><br><span class="line">        gradeRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>StudentController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentRepository studentRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentRepository</span><span class="params">(StudentRepository studentRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentRepository = studentRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentRepository.save(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentRepository.save(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> </span>&#123;</span><br><span class="line">        studentRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li><p>Spring 建议在这里的注入方式是 set 或者 构造注入，不要直接注解注入</p></li><li><p>为了方便，在这里还是省略了 Service 层的操作</p></li></ul></blockquote><p><code>Postman测试</code></p><p><code>增</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150238.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150238.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150238245"></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150312.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150312.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150312117"></p><p><code>查</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150428.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150428.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150428435"></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150520.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150520.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150520147"></p><p><code>改</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150633.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150633.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150633346"></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150752.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150752.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150751979"></p><p><code>删</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150920.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910150920.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910150920385"></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910151023.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200910151023.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200910151023629"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="MySQL" scheme="http://wangba.me/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合MyBatis</title>
    <link href="http://wangba.me/2020/09/09/SpringBoot%E6%95%B4%E5%90%88MyBatis/"/>
    <id>http://wangba.me/2020/09/09/SpringBoot%E6%95%B4%E5%90%88MyBatis/</id>
    <published>2020-09-09T07:52:44.000Z</published>
    <updated>2020-09-30T07:08:29.310Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​    在上篇文章中已经简单的写过 SpringBoot 整合 JDBCTemplate 了，但是现在的公司应该很少有用 JDBCTemplate，国内一般都是 MyBatis 或者是 Spring Data JPA，在本篇文章中就来整合一下 MyBatis。</p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p>新建 SpringBoot 项目，选上 Web、MySQL，在 pom.xml  中配置一下数据库连接池：</p><p><code>pom.xml:</code>  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.properties:</code> </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/test</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string"></span></span><br></pre></td></tr></table></figure><h2 id="三、CRUD"><a href="#三、CRUD" class="headerlink" title="三、CRUD"></a>三、CRUD</h2><p><code>UserMapper:</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// 增</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into mybatis(name, password) values(#&#123;name&#125;, #&#123;password&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@SelectKey(statement = &quot;select last_insert_id()&quot;, keyProperty = &quot;id&quot;, before = false, resultType = Long.class)</span></span><br><span class="line">    <span class="function">Integer <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 查</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from mybatis&quot;)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">queryAllUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            @Result(property = &quot;id&quot;, column = &quot;i&quot;),</span></span><br><span class="line"><span class="meta">            @Result(property = &quot;name&quot;, column = &quot;n&quot;),</span></span><br><span class="line"><span class="meta">            @Result(property = &quot;password&quot;, column = &quot;p&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@Select(&quot;select id as i, name as n, password as p from mybatis where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">User <span class="title">queryById</span><span class="params">(Long id)</span></span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 改</span></span><br><span class="line">    <span class="meta">@Update(&quot;update mybatis set name = #&#123;name&#125;, password = #&#123;password&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Integer <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 删</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from mybatis where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Integer <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li><p>如果不使用注解的方式，就要使用 xml 的方式，注意其中的资源解析问题：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><code>增加</code> </p><ul><li>statement是要运行的SQL语句，它的返回值通过resultType来指定</li><li>before表示查询语句statement运行的时机</li><li>keyProperty表示查询结果赋值给代码中的哪个对象，keyColumn表示将查询结果赋值给数据库表中哪一列</li><li>keyProperty和keyColumn都不是必需的，有没有都可以</li><li>before=true，插入之前进行查询，可以将查询结果赋给keyProperty和keyColumn，赋给keyColumn相当于更改数据库</li><li>befaore=false，先插入，再查询，这时只能将结果赋给keyProperty</li><li>赋值给keyProperty用来“读”数据库，赋值给keyColumn用来写数据库</li><li>selectKey的两大作用：1、生成主键；2、获取刚刚插入数据的主键。</li><li>使用selectKey，并且使用MySQL的last_insert_id()函数时，before必为false，也就是说必须先插入然后执行last_insert_id()才能获得刚刚插入数据的ID。</li><li>参考链接：<a href="https://www.cnblogs.com/weiyinfu/p/6835301.html#3">@SelectKey注解</a></li></ul><p><code>查</code></p><ul><li>@Results注解类似于XML中的ResultMap映射文件</li></ul></blockquote><p><code>UserController:</code> 为了方便就不再写 Service 层了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserMapper</span><span class="params">(UserMapper userMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryAllUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.update(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.delete(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Postman 测试：</code> </p><p>增加：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152447.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152447.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909152436340"></p><p>查询所有：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152617.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152617.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909152617644"></p><p>通过 id 查询：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152702.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152702.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909152702160"></p><p>更新：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152910.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152910.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909152910165"></p><p>查看一下数据库：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152940.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909152940.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909152940948"></p><p>删除：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909153038.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909153038.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909153032470"></p><p>查看一下数据库：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909153131.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200909153131.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200909153131838"></p><blockquote><p>使用注解进行动态查询具体可以参考：<a href="https://mybatis.org/mybatis-3/zh/java-api.html">注解版动态查询</a></p><p>使用 xml 方式进行动态查询可以参考：<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html">xml 版动态查询</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="SQL" scheme="http://wangba.me/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合JDBCTemplate</title>
    <link href="http://wangba.me/2020/09/08/SpringBoot%E6%95%B4%E5%90%88JDBCTemplate/"/>
    <id>http://wangba.me/2020/09/08/SpringBoot%E6%95%B4%E5%90%88JDBCTemplate/</id>
    <published>2020-09-08T11:33:14.000Z</published>
    <updated>2020-09-30T07:08:27.205Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h2><h3 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// WEB</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//  JDBC </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 使用 Swagger 进行接口测试</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// mysql</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line">// druid</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-数据库脚本"><a href="#2-数据库脚本" class="headerlink" title="2.数据库脚本"></a>2.数据库脚本</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`sys_user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  <span class="string">`nick_name`</span> <span class="built_in">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">  <span class="string">`avatar`</span> <span class="built_in">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;头像&#x27;</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  <span class="string">`salt`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;加密盐&#x27;</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">  <span class="string">`mobile`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">  <span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;状态  0：禁用   1：正常&#x27;</span>,</span><br><span class="line">  <span class="string">`dept_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;机构ID&#x27;</span>,</span><br><span class="line">  <span class="string">`create_by`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  <span class="string">`last_update_by`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;更新人&#x27;</span>,</span><br><span class="line">  <span class="string">`last_update_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="string">`del_flag`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;是否删除  -1：已删除  0：正常&#x27;</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`name`</span> (<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">34</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">&#x27;用户管理&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>application.properties:</code> </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/test</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">******</span></span><br></pre></td></tr></table></figure><h2 id="二、CRUD"><a href="#二、CRUD" class="headerlink" title="二、CRUD"></a>二、CRUD</h2><h3 id="1-编写对应的实体类"><a href="#1-编写对应的实体类" class="headerlink" title="1.编写对应的实体类"></a>1.编写对应的实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Byte status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long deptId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastUpdateBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Byte delFlag;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// set 和 get 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-编写对应的-CRUD-Repository"><a href="#2-编写对应的-CRUD-Repository" class="headerlink" title="2.编写对应的 CRUD Repository"></a>2.编写对应的 CRUD Repository</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert</span><span class="params">(SysUser user)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into sys_user(id, name, password) values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.update(sql, user.getId(), user.getName(), user.getPassword());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert1</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into sys_user(id, name, password) values(:id, :name, :password)&quot;</span>;</span><br><span class="line">        NamedParameterJdbcTemplate namedParameterJdbcTemplate = <span class="keyword">new</span> NamedParameterJdbcTemplate(<span class="keyword">this</span>.jdbcTemplate.getDataSource());</span><br><span class="line">        <span class="keyword">return</span> namedParameterJdbcTemplate.update(sql, <span class="keyword">new</span> BeanPropertySqlParameterSource(sysUser));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 推荐使用这种方式，可以不用传所有的参数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert2</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into sys_user(id, name, password) values(:id, :name, :password)&quot;</span>;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, sysUser.getId());</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, sysUser.getName());</span><br><span class="line">        map.put(<span class="string">&quot;password&quot;</span>, sysUser.getPassword());</span><br><span class="line">        NamedParameterJdbcTemplate namedParameterJdbcTemplate = <span class="keyword">new</span> NamedParameterJdbcTemplate(<span class="keyword">this</span>.jdbcTemplate.getDataSource());</span><br><span class="line">        <span class="keyword">return</span> namedParameterJdbcTemplate.update(sql, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">update</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;update sys_user set name = ?, password = ? where id = ?&quot;</span>;</span><br><span class="line">        Object[] args = &#123;sysUser.getName(), sysUser.getPassword(), sysUser.getId()&#125;;</span><br><span class="line">        <span class="keyword">int</span>[] argTypes = &#123;Types.VARCHAR, Types.VARCHAR, Types.BIGINT&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.jdbcTemplate.update(sql, args, argTypes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; queryAllListMap() &#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from sys_user&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.jdbcTemplate.queryForList(sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 这里要写一个 SysUserMapper 实现 RowMapper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SysUser <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from sys_user where id = ?&quot;</span>;</span><br><span class="line">        Object[] args = &#123;id&#125;;</span><br><span class="line">        <span class="keyword">int</span>[] argTypes = &#123;Types.BIGINT&#125;;</span><br><span class="line">        List&lt;SysUser&gt; list = <span class="keyword">this</span>.jdbcTemplate.query(sql, args, argTypes, <span class="keyword">new</span> SysUserMapper());</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(list)) &#123;</span><br><span class="line">            <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;delete from sys_user where id = ?&quot;</span>;</span><br><span class="line">        Object[] args = &#123; id &#125;;</span><br><span class="line">        <span class="keyword">int</span>[] argTypes = &#123; Types.BIGINT &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.jdbcTemplate.update(sql, args, argTypes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-对应的-Controller-层"><a href="#3-对应的-Controller-层" class="headerlink" title="3.对应的 Controller 层"></a>3.对应的 Controller 层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysUserRepository sysUserRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = sysUserRepository.insert(sysUser);</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/insert1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert1</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = sysUserRepository.insert1(sysUser);</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/insert2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insert2</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = sysUserRepository.insert2(sysUser);</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = sysUserRepository.update(sysUser);</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; queryAllListMap() &#123;</span><br><span class="line">        <span class="keyword">return</span> sysUserRepository.queryAllListMap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/id1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SysUser <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sysUserRepository.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/id3&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sysUserRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：为了图方便，就不再此写 Service 层了</p></blockquote><h3 id="4-使用-Swagger-进行测试"><a href="#4-使用-Swagger-进行测试" class="headerlink" title="4.使用 Swagger 进行测试"></a>4.使用 Swagger 进行测试</h3><p><code>增加</code> </p><p>第一种方式：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210508.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210508.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908210503256"></p><p>第二种方式：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210645.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210645.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908210645484"></p><p>第三种方式：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210805.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210805.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908210804954"></p><p>看一下数据库是否有三条数据：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210847.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908210847.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908210846969"></p><p><code>修改</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908211258.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908211258.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908211258932"></p><p><code>查找</code>  </p><p>查找所有：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908211934.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908211934.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908211934284"></p><p><code>删除</code>  </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908212720.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200908212720.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200908212720578"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
    <category term="SQL" scheme="http://wangba.me/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>0076.Minimum Window Substring</title>
    <link href="http://wangba.me/2020/09/04/0076-Minimum-Window-Substring/"/>
    <id>http://wangba.me/2020/09/04/0076-Minimum-Window-Substring/</id>
    <published>2020-09-04T13:56:11.000Z</published>
    <updated>2020-09-30T07:09:40.885Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="76-最小覆盖子串-Hard"><a href="#76-最小覆盖子串-Hard" class="headerlink" title="76. 最小覆盖子串  Hard"></a><a href="https://leetcode-cn.com/problems/minimum-window-substring/">76. 最小覆盖子串</a>  <font color="#e82f34" size=5>Hard</font></h2><p>给你一个字符串 S、一个字符串 T 。请你设计一种算法，可以在 O(n) 的时间复杂度内，从字符串 S 里面找出：包含 T 所有字符的最小子串。</p><p><strong>示例：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：S &#x3D; &quot;ADOBECODEBANC&quot;, T &#x3D; &quot;ABC&quot;</span><br><span class="line">输出：&quot;BANC&quot;</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li>如果 S 中不存这样的子串，则返回空字符串 <code>&quot;&quot;</code>。</li><li>如果 S 中存在这样的子串，我们保证它是唯一的答案。</li></ul><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>​        这题在 0003 题中就已经提过了的暗号，就是洒洒水的使用一下 <code>Sliding Window</code> 就可以了，思路还是比较简单的：先不断的扩张窗口右边，直到将所有的要包含的短字符串；然后开始就移动窗口的左边，直到左边压缩到不能再容纳这个短字符串了，再进行不断比较，就可以得到最终结果了。<br>​        这种时候就需要出现 <strong>但是</strong> 这个词语，果然在实现的时候就需要注意很多问题了，对于这种抽象问题，先来个🌰：给的例子实在是太普通了，应该用那种带点特殊性的例子</p><blockquote><p>S = “ABANCDB”     T = “ABC”</p></blockquote><p>对着代码捋一遍应该就懂了：<br>第一遍过后可以看见：”ABANC” 是一个滑动窗口，map 的值也变为了：</p><table><thead><tr><th align="center"></th><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">初始值</td><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">遍历到 A</td><td align="center">0</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">遍历到 B</td><td align="center">0</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">遍历到 A</td><td align="center">-1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">遍历到 N</td><td align="center">-1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">遍历到 C</td><td align="center">-1</td><td align="center">0</td><td align="center">0</td></tr></tbody></table><p>此时的 count == t 的长度了，这样扩张窗口就完成了 ======&gt;   min = 5</p><p>接下来就是收缩窗口，其根本原因就是这样左边出现重复元素，可以去掉形成最小的窗口：</p><p>如果在 map 中的值是等于 0 的，说明它是刚刚好的，如果把这个排除的话，这个窗口就不再成立了，要继续扩张</p><p>窗口了；如果 map 中的值 小于 0 的，说明它是多余的，但是要看它的位置了，可以看下🌰：</p><p>“ABANC” 这个 A 就可以去掉；”BAANC” 这个 A 就不可以去掉，此时就要扩张窗口了</p><p><del>反复横跳</del> ，完成✅</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">minWindow</span><span class="params">(String s, String t)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                <span class="comment">// 使用 hashmap 将 t 中的字符存入</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = t.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(c)) &#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = map.get(c);</span><br><span class="line">                map.put(c, tmp + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                map.put(c, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 用来判断这个窗口是否包含了 t</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// 一个窗口的左右</span></span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line">      <span class="comment">// 长度最小的窗口的左右</span></span><br><span class="line">        <span class="keyword">int</span> minLeft = <span class="number">0</span>, minRight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (; right &lt; s.length(); right++) &#123;</span><br><span class="line">            <span class="keyword">char</span> temp = s.charAt(right);</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(temp)) &#123;</span><br><span class="line">                count = map.get(temp) &gt; <span class="number">0</span> ? count + <span class="number">1</span> : count;</span><br><span class="line">                map.put(temp, map.get(temp) - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (count == t.length()) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((right - left) &lt; min) &#123;</span><br><span class="line">                    min = right - left;</span><br><span class="line">                    minLeft = left;</span><br><span class="line">                    minRight = right;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">char</span> c = s.charAt(left);</span><br><span class="line">              <span class="comment">// 左边的重复字符可以不用</span></span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(c)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (map.get(c) &gt;= <span class="number">0</span>)</span><br><span class="line">                        count--;</span><br><span class="line">                    map.put(c, map.get(c) + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min == Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : s.substring(minLeft, minRight + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="String" scheme="http://wangba.me/tags/String/"/>
    
    <category term="Sliding Window" scheme="http://wangba.me/tags/Sliding-Window/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合AOP</title>
    <link href="http://wangba.me/2020/09/03/SpringBoot%E6%95%B4%E5%90%88AOP/"/>
    <id>http://wangba.me/2020/09/03/SpringBoot%E6%95%B4%E5%90%88AOP/</id>
    <published>2020-09-03T13:52:37.000Z</published>
    <updated>2020-09-30T07:08:24.891Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>​        在公司写业务的时候，都会有保存日志的操作，方便出错的时候进行排查；一般不仅仅在数据库中保存日志，</p><p>也会在后端控制台打印一些需要的信息。在这里，一般使用 AOP 织入的方式将日志保存在数据库中，使用一些日</p><p>志包将某些 Controller 层的信息打印在控制台。</p><h2 id="二、准备"><a href="#二、准备" class="headerlink" title="二、准备"></a>二、准备</h2><h3 id="Entiy"><a href="#Entiy" class="headerlink" title="Entiy:"></a>Entiy:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;log&quot;)</span></span><br><span class="line"><span class="meta">@EntityListeners(AuditingEntityListener.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY )</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;title&quot;, columnDefinition = &quot;VARCHAR(100) COMMENT &#x27;标题&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;author&quot;, columnDefinition = &quot;VARCHAR(255) COMMENT &#x27;作者&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;content&quot;, columnDefinition = &quot;TEXT COMMENT &#x27;内容&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// get 和 set 省略</span></span><br></pre></td></tr></table></figure><blockquote><p>注: 这里是使用 Spring Data JPA 自动生成的数据库对应实体，导入相关依赖后，可以先运行一遍，看数据库</p><p>是否生成对应实体；然后自行在数据库中插入几条数据。</p></blockquote><h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository:"></a>Repository:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Log</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注: 这里只要继承 <code>JpaRepository</code> ，这个 repository 也继承了别的 repository（里面有一些常见的方法可以</p><p>调用）</p></blockquote><h3 id="Service"><a href="#Service" class="headerlink" title="Service:"></a>Service:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LogRepository logRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Log&gt; <span class="title">getAllLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Log&gt; logs = logRepository.findAll();</span><br><span class="line">        <span class="keyword">return</span> logs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注: 这里就不写接口，再去实现了</p></blockquote><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller:"></a>Controller:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LogService logService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Log&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Log&gt; logs = logService.getAllLog();</span><br><span class="line">        <span class="keyword">return</span> logs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再使用 <strong>Postman</strong> 等工具进行一次测试就行</p><h2 id="三、使用注解的方式进行-AOP"><a href="#三、使用注解的方式进行-AOP" class="headerlink" title="三、使用注解的方式进行 AOP"></a>三、使用注解的方式进行 AOP</h2><p>首先定义一个方法级别的 <code>@Log</code> 注解，用于标注需要监控的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义一个LogAspect类，使用 <code>@Aspect</code> 标注让其成为一个切面，切点为使用 <code>@Log</code> 注解标注的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspec</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger  = LoggerFactory.getLogger(LogAspec.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(org.wangba.springboot013aop.antoation.Log)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Start Time: &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;End Time: &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再在 <code>Controller</code> 层的方法上加上 <code>@Log</code> 注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LogService logService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Log(&quot;获得所有文章&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Article&gt; articles = logService.getAllLog();</span><br><span class="line">        <span class="keyword">return</span> articles;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时再在 <strong>Postman</strong> 中测试一次，你就可以看到控制台会打印如下结果：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200903214650.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200903214650.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200903214650730"></p><blockquote><p>在公司业务中，我们一般都是在  <code>@Before</code> 进行一些请求信息等， <code> @After</code> 在控制台打印一些信息，并将结</p><p>果直接存到数据库中的日志表中。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中类型转换</title>
    <link href="http://wangba.me/2020/09/02/SpringBoot%E4%B8%AD%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/"/>
    <id>http://wangba.me/2020/09/02/SpringBoot%E4%B8%AD%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/</id>
    <published>2020-09-02T12:55:09.000Z</published>
    <updated>2020-09-30T07:08:22.269Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h2><p>如果前端传来一个日期参数，是用 String 类型的，我们如何在后端进行传参呢？</p><p>也即如下这种情况：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        System.out.println(date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>浏览器输入：<a href="http://localhost:8080/hello?date=2020-01-01">http://localhost:8080/hello?date=2020-01-01</a></p><p>可以在后台看到  <code>WARN</code> ：</p><blockquote><p>Failed to convert value of type ‘java.lang.String’ to required type ‘java.util.Date’</p></blockquote><h2 id="二、解决"><a href="#二、解决" class="headerlink" title="二、解决"></a>二、解决</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTransDate</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(s)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> simpleDateFormat.parse(s);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：要将该类使用 @Component 注入</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Java" scheme="http://wangba.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>0003.Longest Substring Without Repeating Characters</title>
    <link href="http://wangba.me/2020/09/01/0003-Longest-Substring-Without-Repeating-Characters/"/>
    <id>http://wangba.me/2020/09/01/0003-Longest-Substring-Without-Repeating-Characters/</id>
    <published>2020-09-01T13:26:29.000Z</published>
    <updated>2020-09-30T07:09:37.081Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="0003-无重复字符的最长子串-Medium"><a href="#0003-无重复字符的最长子串-Medium" class="headerlink" title="0003. 无重复字符的最长子串 Medium"></a><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">0003. 无重复字符的最长子串</a> <font color="#fd9016" size=5>Medium</font></h2><p>给定一个字符串，请你找出其中不含有重复字符的 <strong>最长子串</strong> 的长度。</p><p><strong>示例 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: &quot;abcabcbb&quot;</span><br><span class="line">输出: 3 </span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;abc&quot;，所以其长度为 3。</span><br></pre></td></tr></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: &quot;bbbbb&quot;</span><br><span class="line">输出: 1</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;b&quot;，所以其长度为 1。</span><br></pre></td></tr></table></figure><p><strong>示例 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入: &quot;pwwkew&quot;</span><br><span class="line">输出: 3</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;wke&quot;，所以其长度为 3。</span><br><span class="line"></span><br><span class="line">请注意，你的答案必须是 子串 的长度，&quot;pwke&quot; 是一个子序列，不是子串。</span><br></pre></td></tr></table></figure><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p> 🐷：第一个想法就是这个是不是和 KMP 算法有那么一点点像的</p><p> 力扣：让你见识一下，值得我们官网有一个标签的思想 ———&gt;  <code>Sliding Window</code> </p><p>🐷：说人话</p><p>力扣：就是 <code>滑动窗口</code> 大法，你后面会看到很多次这种思想，想继续看这样的题，点<a href="https://leetcode-cn.com/tag/sliding-window/">这里</a>，还有一些暗号：76、</p><p>438、567</p><blockquote><p>滑动窗口思想：</p><p>滑动窗口的右边界不断的右移，只要没有重复的字符，就持续向右扩大窗口边界。一旦出现了重复字符，就需要缩小左边界，直到重复的字符移出了左边界，然后继续移动滑动窗口的右边界。以此类推，每次移动需要计算当前长度，并判断是否需要更新最大长度，最终最大的值就是题目中的所求。</p></blockquote><p>🐷：应该就是双指针的变形版了……..</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(s.charAt(i)))</span><br><span class="line">                j = Math.max(j, map.get(s.charAt(i)) + <span class="number">1</span>);</span><br><span class="line">            map.put(s.charAt(i), i);</span><br><span class="line">            max = Math.max(max, i - j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="String" scheme="http://wangba.me/tags/String/"/>
    
    <category term="Sliding Window" scheme="http://wangba.me/tags/Sliding-Window/"/>
    
    <category term="Two pointer" scheme="http://wangba.me/tags/Two-pointer/"/>
    
  </entry>
  
</feed>
