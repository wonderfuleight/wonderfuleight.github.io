<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wangba&#39;s blogs</title>
  
  
  <link href="http://wangba.me/atom.xml" rel="self"/>
  
  <link href="http://wangba.me/"/>
  <updated>2020-10-21T12:17:23.402Z</updated>
  <id>http://wangba.me/</id>
  
  <author>
    <name>wangba</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>0092. Reverse Linked List II</title>
    <link href="http://wangba.me/2020/10/21/0092-Reverse-Linked-List-II/"/>
    <id>http://wangba.me/2020/10/21/0092-Reverse-Linked-List-II/</id>
    <published>2020-10-21T12:14:42.000Z</published>
    <updated>2020-10-21T12:17:23.402Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="92-Reverse-Linked-List-II-Medium"><a href="#92-Reverse-Linked-List-II-Medium" class="headerlink" title="92. Reverse Linked List II Medium"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list-ii/">92. Reverse Linked List II</a> <font color="#fd9016" size=5>Medium</font></h2><p>难度中等551</p><p>Reverse a linked list from position <em>m</em> to <em>n</em>. Do it in one-pass.</p><p><strong>Note:</strong> 1 ≤ <em>m</em> ≤ <em>n</em> ≤ length of list.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, m &#x3D; 2, n &#x3D; 4</span><br><span class="line">Output: 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</span><br></pre></td></tr></table></figure><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：利用反转链表"><a href="#思路一：利用反转链表" class="headerlink" title="思路一：利用反转链表"></a>思路一：利用反转链表</h3><p>在 <a href="http://wangba.me/2020/10/09/0206-Reverse-Linked-List/]">206</a> 中已经解决了反转整个链表，现在这种部分的反转链表，只需要将上面的断链，丢到反转整个链表的函数中，再恢复连接就行了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">原链表：1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line"></span><br><span class="line">断链：1 2-&gt;3-&gt;4 5-&gt;NULL</span><br><span class="line">调用函数：4-&gt;3-&gt;2</span><br><span class="line"></span><br><span class="line">恢复：1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseBetween</span><span class="params">(ListNode head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    ListNode listNode = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    listNode.next = head;</span><br><span class="line">    ListNode res = listNode;</span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    ListNode cur = <span class="keyword">null</span>;</span><br><span class="line">    ListNode next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (listNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count == m) &#123;</span><br><span class="line">            next = listNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count == m - <span class="number">1</span>) &#123;</span><br><span class="line">            pre = listNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count == n) &#123;</span><br><span class="line">            cur = listNode;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        listNode = listNode.next;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode temp = cur.next;</span><br><span class="line">    cur.next = <span class="keyword">null</span>;</span><br><span class="line">    ListNode node = reverseList(pre.next);</span><br><span class="line">    pre.next = node;</span><br><span class="line">    next.next = temp;</span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 迭代法</span></span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="keyword">null</span>) &#123;</span><br><span class="line">        ListNode next = head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre = head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>写的有点复杂了……</p><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h3 id="思路二：头插法"><a href="#思路二：头插法" class="headerlink" title="思路二：头插法"></a>思路二：头插法</h3><p>还是要使用哨兵，避免重复操作，哨兵后面结点的操作：找到第一个要进行逆置结点的前一个结点，然后对后每个结点都进行<code>头插法</code>就行了</p><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseBetween</span><span class="params">(ListNode head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    ListNode dummy = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummy.next = head;</span><br><span class="line">    ListNode pre = dummy;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        pre = pre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode cur = pre.next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m; i &lt; n; i++) &#123;</span><br><span class="line">        ListNode next = cur.next;</span><br><span class="line">        cur.next = next.next;</span><br><span class="line">        next.next = pre.next;</span><br><span class="line">        pre.next = next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0086. Partition List</title>
    <link href="http://wangba.me/2020/10/20/0086-Partition-List/"/>
    <id>http://wangba.me/2020/10/20/0086-Partition-List/</id>
    <published>2020-10-20T13:35:39.000Z</published>
    <updated>2020-10-20T13:37:46.940Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="86-Partition-List-Medium"><a href="#86-Partition-List-Medium" class="headerlink" title="86. Partition List Medium"></a><a href="https://leetcode-cn.com/problems/partition-list/">86. Partition List</a> Medium</h2><p>Given a linked list and a value <em>x</em>, partition it such that all nodes less than <em>x</em> come before nodes greater than or equal to <em>x</em>.</p><p>You should preserve the original relative order of the nodes in each of the two partitions.</p><p><strong>Example:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head &#x3D; 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x &#x3D; 3</span><br><span class="line">Output: 1-&gt;2-&gt;2-&gt;4-&gt;3-&gt;5</span><br></pre></td></tr></table></figure><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：大小链表"><a href="#思路一：大小链表" class="headerlink" title="思路一：大小链表"></a>思路一：大小链表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">原链表：1 -&gt; 4 -&gt; 3 -&gt; 2 -&gt; 5 -&gt; 2</span><br><span class="line"></span><br><span class="line">大链表：4 -&gt; 3 -&gt; 5</span><br><span class="line">小链表：1 -&gt; 2 -&gt; 2</span><br><span class="line"></span><br><span class="line">合并链表：1 -&gt; 2 -&gt; 2 -&gt; 4 -&gt; 3 -&gt; 5</span><br></pre></td></tr></table></figure><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">partition</span><span class="params">(ListNode head, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Input: head = 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x = 3</span></span><br><span class="line"><span class="comment">//        Output: 1-&gt;2-&gt;2-&gt;4-&gt;3-&gt;5</span></span><br><span class="line">        <span class="comment">// 小链表</span></span><br><span class="line">        ListNode min = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">        ListNode l  = min;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 大链表</span></span><br><span class="line">        ListNode max = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">        ListNode h = max;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (head != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (head.val &lt; x) &#123;</span><br><span class="line">                l.next = head;</span><br><span class="line">                l = l.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                h.next = head;</span><br><span class="line">                h = h.next;</span><br><span class="line">            &#125;</span><br><span class="line">            head = head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        h.next = <span class="keyword">null</span>;</span><br><span class="line">        l.next = max.next;</span><br><span class="line">        <span class="keyword">return</span> min.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O()</p></blockquote>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0083. Remove Duplicates from Sorted List</title>
    <link href="http://wangba.me/2020/10/19/0083-Remove-Duplicates-from-Sorted-List/"/>
    <id>http://wangba.me/2020/10/19/0083-Remove-Duplicates-from-Sorted-List/</id>
    <published>2020-10-19T13:28:17.000Z</published>
    <updated>2020-10-20T13:34:21.281Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="83-Remove-Duplicates-from-Sorted-List-Easy"><a href="#83-Remove-Duplicates-from-Sorted-List-Easy" class="headerlink" title="83. Remove Duplicates from Sorted List Easy"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/">83. Remove Duplicates from Sorted List</a> <font color="#49b666" size=5>Easy</font></h2><p>Given a sorted linked list, delete all duplicates such that each element appear only <em>once</em>.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;1-&gt;2</span><br><span class="line">Output: 1-&gt;2</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;1-&gt;2-&gt;3-&gt;3</span><br><span class="line">Output: 1-&gt;2-&gt;3</span><br></pre></td></tr></table></figure><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：双指针"><a href="#思路一：双指针" class="headerlink" title="思路一：双指针"></a>思路一：双指针</h3><p>由于都是已经排好序的链表，相同的数都在一起，只要使用双指针：一个指向出现的第一个数，一个一直遍历到这个数结束即可</p><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">deleteDuplicates</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    ListNode slow = head;</span><br><span class="line">    ListNode fast = head.next;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (slow.val == fast.val) &#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">            slow.next = fast;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0025. Reverse Nodes in k-Group</title>
    <link href="http://wangba.me/2020/10/15/0025-Reverse-Nodes-in-k-Group/"/>
    <id>http://wangba.me/2020/10/15/0025-Reverse-Nodes-in-k-Group/</id>
    <published>2020-10-15T11:56:31.000Z</published>
    <updated>2020-10-15T12:01:22.813Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="25-Reverse-Nodes-in-k-Group-Hard"><a href="#25-Reverse-Nodes-in-k-Group-Hard" class="headerlink" title="25. Reverse Nodes in k-Group Hard"></a><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">25. Reverse Nodes in k-Group</a> <font color="#e82f34" size=5>Hard</font></h2><p>Given a linked list, reverse the nodes of a linked list <em>k</em> at a time and return its modified list.</p><p><em>k</em> is a positive integer and is less than or equal to the length of the linked list. If the number of nodes is not a multiple of <em>k</em> then left-out nodes, in the end, should remain as it is.</p><p><strong>Follow up:</strong></p><ul><li>Could you solve the problem in <code>O(1)</code> extra memory space?</li><li>You may not alter the values in the list’s nodes, only nodes itself may be changed.</li></ul><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2020/10/03/reverse_ex1.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/10/03/reverse_ex1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head &#x3D; [1,2,3,4,5], k &#x3D; 2</span><br><span class="line">Output: [2,1,4,3,5]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><p><img src="https://assets.leetcode.com/uploads/2020/10/03/reverse_ex2.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/10/03/reverse_ex2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head &#x3D; [1,2,3,4,5], k &#x3D; 3</span><br><span class="line">Output: [3,2,1,4,5]</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head &#x3D; [1,2,3,4,5], k &#x3D; 1</span><br><span class="line">Output: [1,2,3,4,5]</span><br></pre></td></tr></table></figure><p><strong>Example 4:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head &#x3D; [1], k &#x3D; 1</span><br><span class="line">Output: [1]</span><br></pre></td></tr></table></figure><p><strong>Constraints:</strong></p><ul><li>The number of nodes in the list is in the range <code>sz</code>.</li><li><code>1 &lt;= sz &lt;= 5000</code></li><li><code>0 &lt;= Node.val &lt;= 1000</code></li><li><code>1 &lt;= k &lt;= sz</code></li></ul><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：迭代"><a href="#思路一：迭代" class="headerlink" title="思路一：迭代"></a>思路一：迭代</h3><p>可以结合下面的图和代码进行查看：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201015194154.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201015194154.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201015193552764"></p><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseKGroup</span><span class="params">(ListNode head, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    ListNode ans = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">    ans.next = head;</span><br><span class="line"></span><br><span class="line">    ListNode res = ans;</span><br><span class="line">    ListNode end = ans;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (end.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k &amp;&amp; end != <span class="keyword">null</span>; i++) end = end.next;</span><br><span class="line">        <span class="keyword">if</span> (end == <span class="keyword">null</span>) <span class="keyword">break</span>;</span><br><span class="line">        ListNode start = res.next;</span><br><span class="line">        ListNode next = end.next;</span><br><span class="line">        end.next = <span class="keyword">null</span>;</span><br><span class="line">        res.next = reverseList(start);</span><br><span class="line">        start.next = next;</span><br><span class="line">        res = start;</span><br><span class="line"></span><br><span class="line">        end = res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 递归法</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode listNode = reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> listNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h3 id="思路二：递归"><a href="#思路二：递归" class="headerlink" title="思路二：递归"></a>思路二：递归</h3><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseKGroup</span><span class="params">(ListNode head, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    ListNode point = head;</span><br><span class="line">    <span class="comment">//找到子链表的尾部</span></span><br><span class="line">    <span class="keyword">int</span> i = k;</span><br><span class="line">    <span class="keyword">while</span>(i - <span class="number">1</span> &gt;<span class="number">0</span>)&#123;</span><br><span class="line">        point = point.next;</span><br><span class="line">        <span class="keyword">if</span> (point == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode temp = point.next;</span><br><span class="line">    <span class="comment">//将子链表断开</span></span><br><span class="line">    point.next = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//倒置子链表，并接受新的头结点</span></span><br><span class="line">    ListNode new_head = reverseList(head);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//head 其实是倒置链表的尾部，然后我们将后边的倒置结果接过来就可以了</span></span><br><span class="line">    <span class="comment">//temp 是链表断开后的头指针，可以参考解法一的图示</span></span><br><span class="line">    head.next = reverseKGroup(temp,k);</span><br><span class="line">    <span class="keyword">return</span> new_head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 递归法</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode listNode = reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> listNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>1002. Find Common Characters</title>
    <link href="http://wangba.me/2020/10/14/1002-Find-Common-Characters/"/>
    <id>http://wangba.me/2020/10/14/1002-Find-Common-Characters/</id>
    <published>2020-10-14T11:46:04.000Z</published>
    <updated>2020-10-14T11:51:39.832Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="1002-Find-Common-Characters-Easy"><a href="#1002-Find-Common-Characters-Easy" class="headerlink" title="1002. Find Common Characters Easy"></a><a href="https://leetcode-cn.com/problems/find-common-characters/">1002. Find Common Characters</a> <font color="#49b666" size=5>Easy</font></h4><p>Given an array <code>A</code> of strings made only from lowercase letters, return a list of all characters that show up in all strings within the list <strong>(including duplicates)</strong>. For example, if a character occurs 3 times in all strings but not 4 times, you need to include that character three times in the final answer.</p><p>You may return the answer in any order.</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [&quot;bella&quot;,&quot;label&quot;,&quot;roller&quot;]</span><br><span class="line">Output: [&quot;e&quot;,&quot;l&quot;,&quot;l&quot;]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [&quot;cool&quot;,&quot;lock&quot;,&quot;cook&quot;]</span><br><span class="line">Output: [&quot;c&quot;,&quot;o&quot;]</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol><li><code>1 &lt;= A.length &lt;= 100</code></li><li><code>1 &lt;= A[i].length &lt;= 100</code></li><li><code>A[i][j]</code> is a lowercase letter</li></ol><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：暴力破解"><a href="#思路一：暴力破解" class="headerlink" title="思路一：暴力破解"></a>思路一：暴力破解</h3><p>仅供参考：</p><ul><li>找到长度最小的字符串，由于是考虑每一个字符串中重复的元素</li><li>将这个字符串放到 map 中，map 中的值可以设为字符串数组长度</li><li>依次遍历，如果重复就 -1 ，最后看 map 中的值是否变为 0</li></ul><h3 id="思路二：哈希"><a href="#思路二：哈希" class="headerlink" title="思路二：哈希"></a>思路二：哈希</h3><p>可以结合下面的图和代码进行理解</p><ul><li>由于都是小写字母，只需要使用容量为 26 的数组表示 26 位字母；</li><li>第一个 26 位数组，将字符串数组的第一个字符串装下，重复的 + 1</li><li>后面和第一个一样操作得到新的数组，比较其中的值，取<code>最小 </code>的即可，因为最小的那个才代表着它在自己的数组中重复了多少次，在所有的字符串中，它最多的字符重复 </li><li>将结果放在第一个数组，继续比较</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201014193842.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201014193842.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201014193840865"></p><p><strong>代码：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">commonChars</span><span class="params">(String[] A)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 哈希表</span></span><br><span class="line">    <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; A[<span class="number">0</span>].length(); i++) &#123;</span><br><span class="line">        res[A[<span class="number">0</span>].charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; A.length; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] temp = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; A[i].length(); j++) &#123;</span><br><span class="line">            temp[A[i].charAt(j) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++) &#123;</span><br><span class="line">            res[j] = Math.min(res[j], temp[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; ans = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (res[i] != <span class="number">0</span>) &#123;</span><br><span class="line">            ans.add(String.valueOf((<span class="keyword">char</span>)((i) + <span class="string">&#x27;a&#x27;</span>)));</span><br><span class="line">            res[i]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0023. Merge k Sorted Lists</title>
    <link href="http://wangba.me/2020/10/14/0023-Merge-k-Sorted-Lists/"/>
    <id>http://wangba.me/2020/10/14/0023-Merge-k-Sorted-Lists/</id>
    <published>2020-10-14T06:39:51.000Z</published>
    <updated>2020-10-14T07:00:54.331Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="23-Merge-k-Sorted-Lists-Hard"><a href="#23-Merge-k-Sorted-Lists-Hard" class="headerlink" title="23. Merge k Sorted Lists Hard"></a><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">23. Merge k Sorted Lists</a> <font color="#e82f34" size=5>Hard</font></h2><p>You are given an array of <code>k</code> linked-lists <code>lists</code>, each linked-list is sorted in ascending order.</p><p><em>Merge all the linked-lists into one sorted linked-list and return it.</em></p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: lists &#x3D; [[1,4,5],[1,3,4],[2,6]]</span><br><span class="line">Output: [1,1,2,3,4,4,5,6]</span><br><span class="line">Explanation: The linked-lists are:</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">merging them into one sorted list:</span><br><span class="line">1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: lists &#x3D; []</span><br><span class="line">Output: []</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: lists &#x3D; [[]]</span><br><span class="line">Output: []</span><br></pre></td></tr></table></figure><p><strong>Constraints:</strong></p><ul><li><code>k == lists.length</code></li><li><code>0 &lt;= k &lt;= 10^4</code></li><li><code>0 &lt;= lists[i].length &lt;= 500</code></li><li><code>-10^4 &lt;= lists[i][j] &lt;= 10^4</code></li><li><code>lists[i]</code> is sorted in <strong>ascending order</strong>.</li><li>The sum of <code>lists[i].length</code> won’t exceed <code>10^4</code>.</li></ul><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：暴力解法"><a href="#思路一：暴力解法" class="headerlink" title="思路一：暴力解法"></a>思路一：暴力解法</h3><p>遍历链表数组中的每一个链表，在每一个链表中继续遍历，将所有的结果都存在数组中，再进行一次快速排序，最后再把数组中的每个结点组装成链表即可</p><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (ListNode listNode : lists) &#123;</span><br><span class="line">        <span class="keyword">while</span> (listNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">            res.add(listNode.val);</span><br><span class="line">            listNode = listNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Collections.sort(res);</span><br><span class="line">    ListNode head = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode ans = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : res) &#123;</span><br><span class="line">        ListNode listNode = <span class="keyword">new</span> ListNode(i);</span><br><span class="line">        head.next  = listNode;</span><br><span class="line">        head = head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> ans.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(nlogn)，n 为所有结点数</p><p>空间复杂度：O(n)</p></blockquote><h3 id="思路二：列比较"><a href="#思路二：列比较" class="headerlink" title="思路二：列比较"></a>思路二：列比较</h3><p>利用每个链表数组中的链表是有序的，则每次拿到最小的结点加入新的链表中，每个链表数组中的链表头的值一定是最小的</p><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 2. 列比较</span></span><br><span class="line">    <span class="comment">// 最小索引</span></span><br><span class="line">    <span class="keyword">int</span> minIndex = <span class="number">0</span>;</span><br><span class="line">    ListNode head = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode res = head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> isCompleted = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line">        <span class="comment">// 遍历一遍链表数组找到数值最小的结点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lists.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lists[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (lists[i].val &lt; min) &#123;</span><br><span class="line">                    minIndex = i;</span><br><span class="line">                    min = lists[i].val;</span><br><span class="line">                &#125;</span><br><span class="line">                isCompleted = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当所有的链表全部遍历完了，while 循环结束</span></span><br><span class="line">        <span class="keyword">if</span> (isCompleted) <span class="keyword">break</span>;</span><br><span class="line">        head.next = lists[minIndex];</span><br><span class="line">        head = head.next;</span><br><span class="line">        lists[minIndex] = lists[minIndex].next;</span><br><span class="line">    &#125;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(m * n)，m 为最长链表的长度；n 为链表数组长度</p><p>空间复杂度：O(1)</p></blockquote><h3 id="思路三：优先队列"><a href="#思路三：优先队列" class="headerlink" title="思路三：优先队列"></a>思路三：优先队列</h3><p>在上面的思路中，每次都是找到链表数组中最小的结点，再加入新链表中，在上面使用的直接遍历的方式，在这里可以采用优先队列的方式，优先队列是基于堆实现的，具体来说就是小/大根(顶)堆，只需要将每个链表的头结点放入，会自动进行大小比较，出队列是就是最小/最大</p><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 优先队列中默认就是小根堆</span></span><br><span class="line">    PriorityQueue&lt;ListNode&gt; priorityQueue = <span class="keyword">new</span> PriorityQueue&lt;ListNode&gt;(Comparator.comparing(n -&gt; n.val));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将每个结点的的头结点加入优先队列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lists.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (lists[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">            priorityQueue.add(lists[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ListNode head = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode res = head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!priorityQueue.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 出队列时就是最小值先出来的</span></span><br><span class="line">        head.next = priorityQueue.poll();</span><br><span class="line">        head = head.next;</span><br><span class="line">        <span class="comment">// 将出队列的后面那个值加入优先队列</span></span><br><span class="line">        <span class="keyword">if</span> (head.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">            priorityQueue.add(head.next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(nlogk)，n 表示所有的结点书数，logk 表示每个结点的入队、出队</p><p>空间复杂度：O(k)，k 表示链表数组的长度；在 Java 中优先队列是有默认值的</p></blockquote><h3 id="思路四：两两合并"><a href="#思路四：两两合并" class="headerlink" title="思路四：两两合并"></a>思路四：两两合并</h3><p>在<a href="http://wangba.me/2020/10/13/0021-Merge-Two-Sorted-Lists/">0021. Merge Two Sorted Lists</a>中，已经实现过两个有序链表的合并，本题也可以参考这个思路：首先将链表 0 和链表 1 合并，合并成新的链表 a，在和链表 2 进行合并 ……</p><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 4. 两两合并</span></span><br><span class="line">    ListNode temp = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lists.length; i++) &#123;</span><br><span class="line">        temp = mergeTwoLists(temp, lists[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="keyword">null</span>) <span class="keyword">return</span> l2;</span><br><span class="line">    <span class="keyword">if</span> (l2 == <span class="keyword">null</span>) <span class="keyword">return</span> l1;</span><br><span class="line">    <span class="keyword">if</span> (l1.val &gt; l2.val) &#123;</span><br><span class="line">        l2.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        l1.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="思路五：二分法两两合并"><a href="#思路五：二分法两两合并" class="headerlink" title="思路五：二分法两两合并"></a>思路五：二分法两两合并</h3><p>在上面思路五中，合并的思路是：先是合并第一个和第二个，合并为新的后，再和第三个进行合并，这样的效率有点低</p><p>这个思路也是可以优化的，使用二分法：</p><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lists.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> merge(lists, <span class="number">0</span> , lists.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">merge</span><span class="params">(ListNode[] lists, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left == right) <span class="keyword">return</span> lists[left];</span><br><span class="line">    <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">    ListNode l = merge(lists, left, mid);</span><br><span class="line">    ListNode r = merge(lists, mid + <span class="number">1</span>, right);</span><br><span class="line">    <span class="keyword">return</span> mergeTwoLists(l , r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="keyword">null</span>) <span class="keyword">return</span> l2;</span><br><span class="line">    <span class="keyword">if</span> (l2 == <span class="keyword">null</span>) <span class="keyword">return</span> l1;</span><br><span class="line">    <span class="keyword">if</span> (l1.val &gt; l2.val) &#123;</span><br><span class="line">        l2.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        l1.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0021. Merge Two Sorted Lists</title>
    <link href="http://wangba.me/2020/10/13/0021-Merge-Two-Sorted-Lists/"/>
    <id>http://wangba.me/2020/10/13/0021-Merge-Two-Sorted-Lists/</id>
    <published>2020-10-13T12:28:27.000Z</published>
    <updated>2020-10-14T07:00:19.534Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="21-Merge-Two-Sorted-Lists-Easy"><a href="#21-Merge-Two-Sorted-Lists-Easy" class="headerlink" title="21. Merge Two Sorted Lists Easy"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">21. Merge Two Sorted Lists</a> <font color="#49b666" size=5>Easy</font></h2><p>Merge two sorted linked lists and return it as a new <strong>sorted</strong> list. The new list should be made by splicing together the nodes of the first two lists.</p><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2020/10/03/merge_ex1.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/10/03/merge_ex1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: l1 &#x3D; [1,2,4], l2 &#x3D; [1,3,4]</span><br><span class="line">Output: [1,1,2,3,4,4]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: l1 &#x3D; [], l2 &#x3D; []</span><br><span class="line">Output: []</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: l1 &#x3D; [], l2 &#x3D; [0]</span><br><span class="line">Output: [0]</span><br></pre></td></tr></table></figure><p><strong>Constraints:</strong></p><ul><li>The number of nodes in both lists is in the range <code>[0, 50]</code>.</li><li><code>-100 &lt;= Node.val &lt;= 100</code></li><li>Both <code>l1</code> and <code>l2</code> are sorted in <strong>non-decreasing</strong> order.</li></ul><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><h3 id="思路一：迭代法"><a href="#思路一：迭代法" class="headerlink" title="思路一：迭代法"></a>思路一：迭代法</h3><p>设置一个头结点，随后开始比较两个链表的结点值大小，具体逻辑可以将下面的图和代码逻辑联系起来：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013173857.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013173857.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013173854931"></p><p><strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 迭代法</span></span><br><span class="line">    <span class="comment">// 1 2 4     1 3 4</span></span><br><span class="line">    <span class="comment">// 1 1 2 3 4 4</span></span><br><span class="line">    ListNode temp = <span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode res = temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (l1 != <span class="keyword">null</span> &amp;&amp; l2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1.val &gt; l2.val) &#123;</span><br><span class="line">            temp.next = l2;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            l2 = l2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            temp.next = l1;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">            l1 = l1.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="keyword">null</span>) temp.next = l2;</span><br><span class="line">    <span class="keyword">if</span> (l2 == <span class="keyword">null</span>) temp.next = l1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(m + n)</p><p>空间复杂度：O(1)</p></blockquote><h3 id="思路二：递归法"><a href="#思路二：递归法" class="headerlink" title="思路二：递归法"></a>思路二：递归法</h3><p>递归最重要的两个点：</p><ul><li>递归的出口，在本题里面就是当其中的一个链表为空，直接返回另外一个链表即可</li><li>要进行递归，传入参数后的结果应该是已经确定的了，在这里就是链表已经排好序了</li></ul><p>举个例子：如果现在是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">链表la：1 -&gt; 3 -&gt; 5</span><br><span class="line"></span><br><span class="line">链表lb：2 -&gt; 4 -&gt; 6</span><br></pre></td></tr></table></figure><p>进行第一次递归时：要比较 1 和 2 的大小，发现 1 &lt; 2，此时只需要将 1.next =  <strong>mergeTwoLists(3, 2)</strong> 就行了，不要去想 <strong>mergeTwoLists(3, 2)</strong> 怎么来的，要把它当作已经确定的值就行，而 <strong>mergeTwoLists(3, 2)</strong> 的值可以看作是下面这两个链表的进行 <strong>mergeTwoLists</strong> 的结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">链表la：3 -&gt; 5</span><br><span class="line"></span><br><span class="line">链表lb：2 -&gt; 4 -&gt; 6</span><br></pre></td></tr></table></figure><p> <strong>代码</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 递归法</span></span><br><span class="line">    <span class="comment">// 递归的出口</span></span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="keyword">null</span>) <span class="keyword">return</span> l2;</span><br><span class="line">    <span class="keyword">if</span> (l2 == <span class="keyword">null</span>) <span class="keyword">return</span> l1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l1.val &gt; l2.val) &#123;</span><br><span class="line">        l2.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        l1.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>时间复杂度：O(m + n)</p><p>空间复杂度：O(m + n)</p><ul><li>由于递归是调用栈的，每递归一次需要一个栈帧</li></ul></blockquote>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Array" scheme="http://wangba.me/tags/Array/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security(七)</title>
    <link href="http://wangba.me/2020/10/13/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%83/"/>
    <id>http://wangba.me/2020/10/13/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%83/</id>
    <published>2020-10-13T05:38:58.000Z</published>
    <updated>2020-10-13T05:40:08.522Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        这一小节整理一下前面几节的内容，主要完整的捋一遍 Spring Security 的登录过程。为了有一个 Architecture First  的印象，先将其中关键的类和接口列出，如果看到后面发现有印象，就可以跳到前面来看一下：</p><ul><li><p><strong>SecurityContextHolder</strong></p></li><li><p><strong>Authentication</strong></p></li><li><p>Token 类</p><ul><li><strong>UsernamePasswordAuthenticationToken</strong></li><li><strong>AbstractAuthenticationToken</strong></li></ul></li><li><p>Provider 和 Manger 类</p><ul><li><strong>AuthenticationManager</strong></li><li><strong>ProviderManager</strong></li><li><strong>AuthenticationProvider</strong></li><li><strong>DaoAuthenticationProvider</strong></li></ul></li><li><p><strong>UserDetails</strong> 与 <strong>UserDetailsService</strong></p></li></ul><p>主要可以参考一下这张图：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013133116.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013133116.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013133113040"></p><p>图源：<a href="https://lexburner.github.io/spring-security-1/">Spring Security(一)–Architecture Overview</a></p><h2 id="二、DeepLearning"><a href="#二、DeepLearning" class="headerlink" title="二、DeepLearning"></a>二、DeepLearning</h2><h3 id="2-1-Authentication"><a href="#2-1-Authentication" class="headerlink" title="2.1 Authentication"></a>2.1 Authentication</h3><p>先看一下 <strong>Authentication</strong> 的相关实现类</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013084521.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013084521.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013084517460"></p><p>源码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Authentication</span> <span class="keyword">extends</span> <span class="title">Principal</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">getCredentials</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">getDetails</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">getPrincipal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAuthenticated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAuthenticated</span><span class="params">(<span class="keyword">boolean</span> var1)</span> <span class="keyword">throws</span> IllegalArgumentException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>getAuthorities()：权限信息列表，默认是 GrantedAuthority 接口的一些实现类，通常是代表权限信息的一系列字符串。</li><li>getCredentials()：密码信息，用户输入的密码字符串，在认证过后通常会被移除，用于保障安全。</li><li>getDetails()：细节信息，web 应用中的实现接口通常为 WebAuthenticationDetails，它记录了访问者的 ip 地址和 sessionId 的值。</li><li>getPrincipal()：最重要的身份信息，大部分情况下返回的是 UserDetails 接口的实现类，也是框架中的常用接口之一。UserDetails 接口将会在下面的小节重点介绍。</li></ul></blockquote><p>在实现类中非常重要的就是 <strong>UsernamePasswordAuthenticationToken</strong> ，再看一下其中的属性和方法</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013090503.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013090503.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013090502537"></p><p>以及它的父类：<strong>AbstractAuthenticationToken</strong> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013092222.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013092222.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013092219226"></p><h3 id="2-2-UsernamePasswordAuthenticationFilter"><a href="#2-2-UsernamePasswordAuthenticationFilter" class="headerlink" title="2.2 UsernamePasswordAuthenticationFilter"></a>2.2 UsernamePasswordAuthenticationFilter</h3><p>在 Spring Security 中，认证与授权的相关校验都是在一系列的过滤器链中完成的，在这一系列的过滤器链中，和认证相关的过滤器就是 UsernamePasswordAuthenticationFilter：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsernamePasswordAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title">AbstractAuthenticationProcessingFilter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UsernamePasswordAuthenticationFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> AntPathRequestMatcher(<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;POST&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.postOnly &amp;&amp; !request.getMethod().equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(<span class="string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String username = <span class="keyword">this</span>.obtainUsername(request);</span><br><span class="line">            String password = <span class="keyword">this</span>.obtainPassword(request);</span><br><span class="line">            <span class="keyword">if</span> (username == <span class="keyword">null</span>) &#123;</span><br><span class="line">                username = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (password == <span class="keyword">null</span>) &#123;</span><br><span class="line">                password = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            username = username.trim();</span><br><span class="line">            UsernamePasswordAuthenticationToken authRequest = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);</span><br><span class="line">            <span class="keyword">this</span>.setDetails(request, authRequest);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">obtainPassword</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.passwordParameter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">obtainUsername</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.usernameParameter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中：<strong>UsernamePasswordAuthenticationFilter</strong> 是继承 <strong>AbstractAuthenticationProcessingFilter</strong></p><blockquote><ul><li>通过 obtainUsername 和 obtainPassword 方法提取出请求里边的用户名/密码出来，提取方式就是 request.getParameter</li><li>获取到请求里传递来的用户名/密码之后，接下来就构造一个 UsernamePasswordAuthenticationToken 对象，传入 username 和 password，username 对应了 UsernamePasswordAuthenticationToken 中的 principal 属性，而 password 则对应了它的 credentials 属性</li><li>接下来 setDetails 方法给 details 属性赋值，UsernamePasswordAuthenticationToken 本身是没有 details 属性的，这个属性在它的父类 AbstractAuthenticationToken 中。details 是一个对象，这个对象里边放的是 WebAuthenticationDetails 实例，该实例主要描述了两个信息，请求的 remoteAddress 以及请求的 sessionId</li><li>最后调用 authenticate 方法去做校验了</li></ul></blockquote><p>仔细来细说一下上面代码中的最后一个方法中的校验：<strong>authenticate</strong> </p><p>校验操作首先要获取到一个 AuthenticationManager：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013100829.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201013100829.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201013100826654"></p><p>这里拿到的是 ProviderManager ，所以接下来我们就进入到 ProviderManager 的 authenticate 方法中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">   Class&lt;? extends Authentication&gt; toTest = authentication.getClass();</span><br><span class="line">   AuthenticationException lastException = <span class="keyword">null</span>;</span><br><span class="line">   AuthenticationException parentException = <span class="keyword">null</span>;</span><br><span class="line">   Authentication result = <span class="keyword">null</span>;</span><br><span class="line">   Authentication parentResult = <span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">boolean</span> debug = logger.isDebugEnabled();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (AuthenticationProvider provider : getProviders()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!provider.supports(toTest)) &#123;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (debug) &#123;</span><br><span class="line">         logger.debug(<span class="string">&quot;Authentication attempt using &quot;</span></span><br><span class="line">               + provider.getClass().getName());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         result = provider.authenticate(authentication);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">            copyDetails(authentication, result);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (AccountStatusException | InternalAuthenticationServiceException e) &#123;</span><br><span class="line">         prepareException(e, authentication);</span><br><span class="line">         <span class="keyword">throw</span> e;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">         lastException = e;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (result == <span class="keyword">null</span> &amp;&amp; parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         result = parentResult = parent.authenticate(authentication);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (ProviderNotFoundException e) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (AuthenticationException e) &#123;</span><br><span class="line">         lastException = parentException = e;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (eraseCredentialsAfterAuthentication</span><br><span class="line">            &amp;&amp; (result <span class="keyword">instanceof</span> CredentialsContainer)) &#123;</span><br><span class="line">         ((CredentialsContainer) result).eraseCredentials();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (parentResult == <span class="keyword">null</span>) &#123;</span><br><span class="line">         eventPublisher.publishAuthenticationSuccess(result);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">      ......</span><br><span class="line"></span><br><span class="line">   <span class="keyword">throw</span> lastException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>首先获取 authentication 的 Class，判断当前 provider 是否支持该 authentication</li><li>如果支持，则调用 provider 的 authenticate 方法开始做校验，校验完成后，会返回一个新的 Authentication</li><li>这里的 provider 可能有多个，如果 provider 的 authenticate 方法没能正常返回一个 Authentication，则调用 provider 的 parent 的 authenticate 方法继续校验</li><li>copyDetails 方法则用来把旧的 Token 的 details 属性拷贝到新的 Token 中来</li><li>接下来会调用 eraseCredentials 方法擦除凭证信息，也就是你的密码，这个擦除方法比较简单，就是将 Token 中的 credentials 属性置空</li><li>最后通过 publishAuthenticationSuccess 方法将登录成功的事件广播出去</li></ul></blockquote><p>在具体说一下调用 provider 的 authenticate 方法的过程：</p><ul><li>在 for 循环中，第一次拿到的 provider 是一个 AnonymousAuthenticationProvider，这个 provider 压根就不支持 UsernamePasswordAuthenticationToken，也就是会直接在 provider.supports 方法中返回 false，结束 for 循环</li><li>然后会进入到下一个 if 中，直接调用 parent 的 authenticate 方法进行校验。而 parent 就是 ProviderManager，所以会再次回到这个 authenticate 方法中。再次回到 authenticate 方法中，provider 也变成了 DaoAuthenticationProvider，这个 provider 是支持 UsernamePasswordAuthenticationToken 的</li><li>所以会顺利进入到该类的 authenticate 方法去执行，而 DaoAuthenticationProvider 继承自 AbstractUserDetailsAuthenticationProvider 并且没有重写 authenticate 方法，所以 我们最终来到 AbstractUserDetailsAuthenticationProvider#authenticate 方法中：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">   Assert.isInstanceOf(UsernamePasswordAuthenticationToken.class, authentication,</span><br><span class="line">         () -&gt; messages.getMessage(</span><br><span class="line">               <span class="string">&quot;AbstractUserDetailsAuthenticationProvider.onlySupports&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Only UsernamePasswordAuthenticationToken is supported&quot;</span>));</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Determine username</span></span><br><span class="line">   String username = (authentication.getPrincipal() == <span class="keyword">null</span>) ? <span class="string">&quot;NONE_PROVIDED&quot;</span></span><br><span class="line">         : authentication.getName();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">boolean</span> cacheWasUsed = <span class="keyword">true</span>;</span><br><span class="line">   UserDetails user = <span class="keyword">this</span>.userCache.getUserFromCache(username);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">      cacheWasUsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         user = retrieveUser(username,</span><br><span class="line">               (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (UsernameNotFoundException notFound) &#123;</span><br><span class="line">         logger.debug(<span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (hideUserNotFoundExceptions) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(messages.getMessage(</span><br><span class="line">                  <span class="string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;Bad credentials&quot;</span>));</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> notFound;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      Assert.notNull(user,</span><br><span class="line">            <span class="string">&quot;retrieveUser returned null - a violation of the interface contract&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      preAuthenticationChecks.check(user);</span><br><span class="line">      additionalAuthenticationChecks(user,</span><br><span class="line">            (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (AuthenticationException exception) &#123;</span><br><span class="line">      <span class="keyword">if</span> (cacheWasUsed) &#123;</span><br><span class="line">         cacheWasUsed = <span class="keyword">false</span>;</span><br><span class="line">         user = retrieveUser(username,</span><br><span class="line">               (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">         preAuthenticationChecks.check(user);</span><br><span class="line">         additionalAuthenticationChecks(user,</span><br><span class="line">               (UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">throw</span> exception;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   postAuthenticationChecks.check(user);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!cacheWasUsed) &#123;</span><br><span class="line">      <span class="keyword">this</span>.userCache.putUserInCache(user);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Object principalToReturn = user;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (forcePrincipalAsString) &#123;</span><br><span class="line">      principalToReturn = user.getUsername();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> createSuccessAuthentication(principalToReturn, authentication, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>首先从 Authentication 提取出登录用户名</li><li>然后通过拿着 username 去调用 retrieveUser 方法去获取当前用户对象，这一步会调用我们自己在登录时候的写的 loadUserByUsername 方法，所以这里返回的 user 其实就是你的登录对象</li><li>接下来调用 preAuthenticationChecks.check 方法去检验 user 中的各个账户状态属性是否正常，例如账户是否被禁用、账户是否被锁定、账户是否过期等等</li><li>additionalAuthenticationChecks 方法则是做密码比对的</li><li>最后在 postAuthenticationChecks.check 方法中检查密码是否过期</li><li>接下来有一个 forcePrincipalAsString 属性，这个是是否强制将 Authentication 中的 principal 属性设置为字符串，这个属性我们一开始在 UsernamePasswordAuthenticationFilter 类中其实就是设置为字符串的（即 username），但是默认情况下，当用户登录成功之后， 这个属性的值就变成当前用户这个对象了。之所以会这样，就是因为 forcePrincipalAsString 默认为 false，不过这块其实不用改，就用 false，这样在后期获取当前用户信息的时候反而方便很多</li><li>最后，通过 createSuccessAuthentication 方法构建一个新的 UsernamePasswordAuthenticationToken</li></ul></blockquote><p>整体流程大概如下：</p><img src="http://dandandeshangni.oss-cn-beijing.aliyuncs.com/github/Spring%20Security/core-service-Sequence.png" class="lazyload" data-srcset="http://dandandeshangni.oss-cn-beijing.aliyuncs.com/github/Spring%20Security/core-service-Sequence.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img1" style="zoom:200%;" /><p>图源：<a href="https://niocoder.com/2018/01/02/Spring-Security%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B8%80-Spring-Security%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/#%E6%A6%82%E8%BF%B0">Spring Security认证过程</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>0019.Remove Nth Node From End of List</title>
    <link href="http://wangba.me/2020/10/12/0019-Remove-Nth-Node-From-End-of-List/"/>
    <id>http://wangba.me/2020/10/12/0019-Remove-Nth-Node-From-End-of-List/</id>
    <published>2020-10-12T12:06:55.000Z</published>
    <updated>2020-10-12T12:10:23.037Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="19-删除链表的倒数第N个节点-Medium"><a href="#19-删除链表的倒数第N个节点-Medium" class="headerlink" title="19. 删除链表的倒数第N个节点 Medium"></a><a href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/">19. 删除链表的倒数第N个节点</a> <font color="#fd9016" size=5>Medium</font></h2><p>给定一个链表，删除链表的倒数第 <em>n</em> 个节点，并且返回链表的头结点。</p><p><strong>示例：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给定一个链表: 1-&gt;2-&gt;3-&gt;4-&gt;5, 和 n &#x3D; 2.</span><br><span class="line"></span><br><span class="line">当删除了倒数第二个节点后，链表变为 1-&gt;2-&gt;3-&gt;5.</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><p>给定的 <em>n</em> 保证是有效的。</p><p><strong>进阶：</strong></p><p>你能尝试使用一趟扫描实现吗？</p><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>首先回忆一下如何删除一个结点，可以参考<a href="http://wangba.me/2020/10/03/LinkedList/">这个</a>，主要就是找到要删除前面的那个结点</p><h3 id="思路一：暴力法"><a href="#思路一：暴力法" class="headerlink" title="思路一：暴力法"></a>思路一：暴力法</h3><p>直接两次遍历即可，第一遍找到这个链表的长度，第二遍只需要走链表长度减去这个**<em>n**</em>就行了</p><h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">    ListNode l = head;</span><br><span class="line">    <span class="keyword">while</span> (l != <span class="keyword">null</span>) &#123;</span><br><span class="line">        length++;</span><br><span class="line">        l = l.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    l = head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> sub = length - n;</span><br><span class="line">    <span class="keyword">if</span> (sub == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (sub &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        l = l.next;</span><br><span class="line">        sub--;</span><br><span class="line">    &#125;</span><br><span class="line">    l.next = l.next.next;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>虽然遍历了两次，但是时间复杂度还是 O(n)，线性长度</p><p>空间复杂度为 O(1)</p></blockquote><h3 id="思路二：相对位移法"><a href="#思路二：相对位移法" class="headerlink" title="思路二：相对位移法"></a>思路二：相对位移法</h3><p>这个思路也很简单，对比上面的思路好处是：只需要遍历一遍就行了</p><p>双指针，让 A 指针先走 <strong><em>n</em></strong>步，随后再让 B 指针和 A 指针一起走，这样就会有长度为 n 的相对位移，直到让 A 指针走到终点，此时 B 指针也就距终点 n 的长度了</p><h3 id="代码：-1"><a href="#代码：-1" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    ListNode fast = head, slow = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)&#123;</span><br><span class="line">        fast = fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fast == <span class="keyword">null</span>) <span class="keyword">return</span> head.next;</span><br><span class="line">    <span class="keyword">while</span> (fast.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">        fast = fast.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    slow.next = slow.next.next;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Array" scheme="http://wangba.me/tags/Array/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>0160. Intersection of Two Linked Lists</title>
    <link href="http://wangba.me/2020/10/12/0160-Intersection-of-Two-Linked-Lists/"/>
    <id>http://wangba.me/2020/10/12/0160-Intersection-of-Two-Linked-Lists/</id>
    <published>2020-10-12T02:09:45.000Z</published>
    <updated>2020-10-12T02:32:26.613Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="160-相交链表-Easy"><a href="#160-相交链表-Easy" class="headerlink" title="160. 相交链表  Easy"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">160. 相交链表</a>  <font color="#49b666" size=5>Easy</font></h2><p>编写一个程序，找到两个单链表相交的起始节点。</p><p>如下面的两个链表<strong>：</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_statement.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_statement.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>在节点 c1 开始相交。</p><p><strong>示例 1：</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_1.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：intersectVal &#x3D; 8, listA &#x3D; [4,1,8,4,5], listB &#x3D; [5,0,1,8,4,5], skipA &#x3D; 2, skipB &#x3D; 3</span><br><span class="line">输出：Reference of the node with value &#x3D; 8</span><br><span class="line">输入解释：相交节点的值为 8 （注意，如果两个链表相交则不能为 0）。从各自的表头开始算起，链表 A 为 [4,1,8,4,5]，链表 B 为 [5,0,1,8,4,5]。在 A 中，相交节点前有 2 个节点；在 B 中，相交节点前有 3 个节点。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_2.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：intersectVal &#x3D; 2, listA &#x3D; [0,9,1,2,4], listB &#x3D; [3,2,4], skipA &#x3D; 3, skipB &#x3D; 1</span><br><span class="line">输出：Reference of the node with value &#x3D; 2</span><br><span class="line">输入解释：相交节点的值为 2 （注意，如果两个链表相交则不能为 0）。从各自的表头开始算起，链表 A 为 [0,9,1,2,4]，链表 B 为 [3,2,4]。在 A 中，相交节点前有 3 个节点；在 B 中，相交节点前有 1 个节点。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_3.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_example_3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入：intersectVal &#x3D; 0, listA &#x3D; [2,6,4], listB &#x3D; [1,5], skipA &#x3D; 3, skipB &#x3D; 2</span><br><span class="line">输出：null</span><br><span class="line">输入解释：从各自的表头开始算起，链表 A 为 [2,6,4]，链表 B 为 [1,5]。由于这两个链表不相交，所以 intersectVal 必须为 0，而 skipA 和 skipB 可以是任意值。</span><br><span class="line">解释：这两个链表不相交，因此返回 null。</span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><ul><li>如果两个链表没有交点，返回 <code>null</code>.</li><li>在返回结果后，两个链表仍须保持原有的结构。</li><li>可假定整个链表结构中没有循环。</li><li>程序尽量满足 O(<em>n</em>) 时间复杂度，且仅用 O(<em>1</em>) 内存。</li></ul><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><h4 id="思路一：暴力法"><a href="#思路一：暴力法" class="headerlink" title="思路一：暴力法"></a>思路一：暴力法</h4><p>遍历链表 A 的时候，每遍历一个结点都完整遍历一下链表 B，判断指向的结点是否为同一个，这样时间复杂度为 O(mn)</p><h4 id="思路二：-HashMap"><a href="#思路二：-HashMap" class="headerlink" title="思路二：+ HashMap"></a>思路二：+ HashMap</h4><p>在思路一的基础上，先将链表 A 的所有结点先放入 HashMap 中，遍历链表 B 的时候比较每个节点是否存在 HashMap 中，此时时间复杂度为 O(n)，但是空间复杂度为 O(n)</p><h4 id="思路三："><a href="#思路三：" class="headerlink" title="思路三："></a>思路三：</h4><p>在上面的图中可以看见，在有交点的情况下，无非就三种情况：由于在交点后(包括交点)的所有结点都相同</p><ul><li>链表 A 的长度 &gt; 链表 B 的长度</li><li>链表 A 的长度 = 链表 B 的长度</li><li>链表 A 的长度 &lt; 链表 B 的长度</li></ul><p>如果我们能算出这个长度差，然后让长的那个链表先走这个长度差，再让两个链表一起走，直到走到相交点</p><p>举个例子，如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201012093913.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201012093913.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201012093912222"></p><blockquote><ul><li>链表 A 长度 = 6；链表 B 长度 = 4；链表差 = 2</li><li>让长度长的链表(A)先走链表差，即 pointerA 先走 2 个结点</li><li>pointerA 与 pointerB 一起遍历，直到遍历到相同结点</li></ul></blockquote><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (headA == <span class="keyword">null</span> || headB == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode a = headA;</span><br><span class="line">    ListNode b = headB;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链表A 和 链表B 的长度</span></span><br><span class="line">    <span class="keyword">int</span> la = <span class="number">0</span>, lb = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (a.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">        la++;</span><br><span class="line">        a = a.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (b.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">        lb++;</span><br><span class="line">        b = b.next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 此时说明直到 链表A 和 链表B 的最后一个结点都还没相交</span></span><br><span class="line">    <span class="keyword">if</span> (a != b) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链表A 的长度大于 链表B</span></span><br><span class="line">    <span class="keyword">if</span> (la &gt; lb) &#123;</span><br><span class="line">        <span class="keyword">int</span> sub = la - lb;</span><br><span class="line">        <span class="keyword">while</span> (sub &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            headA = headA.next;</span><br><span class="line">            sub--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 链表A 的长度小于 链表B</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> sub = lb - la;</span><br><span class="line">        <span class="keyword">while</span> (sub &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            headB = headB.next;</span><br><span class="line">            sub--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (headA != headB) &#123;</span><br><span class="line">        headA = headA.next;</span><br><span class="line">        headB = headB.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> headA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外一种简洁的写法，思路一样</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(headA == <span class="keyword">null</span> || headB == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    ListNode a = headA;</span><br><span class="line">    ListNode b = headB;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( a != b)&#123;</span><br><span class="line">        a = a == <span class="keyword">null</span>? headB : a.next;</span><br><span class="line">        b = b == <span class="keyword">null</span>? headA : b.next;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果没有重合部分，那么 <code>a</code> 和 <code>b</code> 在某一时间点 一定会同时走到 <code>null</code>，从而结束循环；</li><li>如果有重合部分，分两种情况：<ul><li>长度相同的话， <code>a</code> 和 <code>b</code> 一定是同时到达相遇点，然后返回；</li><li>长度不同的话，较短的链表先到达结尾，然后指针转向较长的链表。此刻，较长的链表继续向末尾走，多走的距离刚好就是最开始介绍的解法，链表的长度差，走完之后指针转向较短的链表。然后继续走的话，相遇的位置就刚好是相遇点了。</li></ul></li></ul>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Array" scheme="http://wangba.me/tags/Array/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security(六)</title>
    <link href="http://wangba.me/2020/10/10/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%85%AD/"/>
    <id>http://wangba.me/2020/10/10/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%85%AD/</id>
    <published>2020-10-10T09:32:56.000Z</published>
    <updated>2020-10-10T09:34:50.900Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在上一节中，使用了第一种方式：JDBC 连接数据库。这一节中将使用 Spring Data JPA 进行数据库操作。如果对 JPA 的环境和操作没了解过的，可以适当参考<a href="http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B8%80/">这个</a>。</p><p>在上一节也提到 Spring Security 支持多种数据源，这些不同来源的数据被共同封装成了一个 UserDetailService 接口</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010091947.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010091947.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010091945655"></p><p>​        在这一节中，还是这个思路，这一次不用 Spring Security 提供的类, 可以自定义一个类去实现 UserDetailService </p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p><code>思路清晰，先看依赖</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010133402.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010133402.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010133400947"></p><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string"></span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/security?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.jpa.database</span>=<span class="string">mysql</span></span><br><span class="line"><span class="meta">spring.jpa.database-platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="meta">spring.jpa.hibernate.ddl-auto</span>=<span class="string">update</span></span><br><span class="line"><span class="meta">spring.jpa.show-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.jpa.properties.hibernate.dialect</span>=<span class="string">org.hibernate.dialect.MySQL8Dialect</span></span><br></pre></td></tr></table></figure><p><strong>实体类</strong></p><p><code>User</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity(name = &quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> accountNonExpired;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> accountNonLocked;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> credentialsNonExpired;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enabled;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// User 和 Role 是多对多关系</span></span><br><span class="line">    <span class="meta">@ManyToMany(fetch = FetchType.EAGER,cascade = CascadeType.PERSIST)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回用户权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : getRoles()) &#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(role.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户是否过期</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户是否被锁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountNonLocked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密码是否过期</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> credentialsNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 账户是否可用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// set get 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：这里为什么 User 要实现 UserDetails ? 主要是由于在自定义类实现 UserDetailService，其中只有唯一的抽象方法<code>loadUserByUsername</code>，而该方法就是返回的 UserDetails</p></blockquote><p><code>Role</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity(name = &quot;t_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserDao</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过用户名找到用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> User&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">User <span class="title">findAllByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不懂为啥这么写的可以参考一下 <a href="http://wangba.me/2020/09/10/SpringBoot%E6%95%B4%E5%90%88Spring-Data-JPA-%E4%B8%80/">JPA 的 CRUD 操作</a></p><p><code>UserService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userDao.findAllByUsername(s);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(user)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> User&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">User <span class="title">save</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li>实现了 UserDetailsService，重写其中的 <code>loadUserByUsername</code> 方法：通过传入的用户名查找用户信息</li><li><code>save</code> 方法是为了后面写入不同角色用户</li></ul></blockquote><p><code>UserController</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将 <code>SecurityConfig</code> 中 configure 方法改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userService = userService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth.userDetailsService(userService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、Test"><a href="#三、Test" class="headerlink" title="三、Test"></a>三、Test</h2><p><code>Postman</code></p><p>由于在未登录的情况下，直接调用 localhost:8080/save 接口会失败，所以先在数据库中手动添加一个数据：</p><p><strong>user 表：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155708.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155708.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010155707544"></p><p><strong>role 表：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155728.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155728.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010155725922"></p><p><strong>user_role 关系表：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155743.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010155743.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010155742141"></p><p><strong>使用上述增加的用户登录：</strong></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160125.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160125.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160123372"></p><p><strong>增加不同角色用户：</strong></p><p><code>user 用户</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160317.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160317.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160316590"></p><p><code>admin用户</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160436.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160436.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160434975"></p><p><strong>看下数据库：</strong></p><p><code>user表</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160556.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160556.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160555645"></p><p><code>role表</code></p><p>![image-20201010160613255](/Users/wangdechao/Library/Application Support/typora-user-images/image-20201010160613255.png)</p><p><code>user_role 关系表</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160630.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160630.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160628692"></p><p>此时在分别使用 user 用户和 admin 用户登录，看一下不同用户的权限：</p><p><code>user用户</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160850.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160850.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160849245"></p><p><code>user权限接口</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160933.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010160933.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010160932135"></p><p><code>admin权限接口</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010161013.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010161013.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010161012247"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security(五)</title>
    <link href="http://wangba.me/2020/10/10/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%94/"/>
    <id>http://wangba.me/2020/10/10/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%94/</id>
    <published>2020-10-10T08:35:48.000Z</published>
    <updated>2020-10-10T09:37:21.525Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在<a href="http://wangba.me/tags/Spring-Security/">前面几节</a>中都使用的是内存数据，并没有连接数据库，这一章将介绍 Spring Security 整合 JDBC </p><p>​        在上一节中先是使用下面这种方式将信息放在内存中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">            .withUser(<span class="string">&quot;wangba&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;guigui&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .withUser(<span class="string">&quot;wangyi&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> UserDetailsService <span class="title">userDetailsService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    InMemoryUserDetailsManager manager = <span class="keyword">new</span> InMemoryUserDetailsManager();</span><br><span class="line">  manager.createUser(User.withUsername(<span class="string">&quot;wangba&quot;</span>).password(<span class="string">&quot;guigui&quot;</span>).roles(<span class="string">&quot;admin&quot;</span>).build());</span><br><span class="line">    manager.createUser(User.withUsername(<span class="string">&quot;wangyi&quot;</span>).password(<span class="string">&quot;1111&quot;</span>).roles(<span class="string">&quot;user&quot;</span>).build());</span><br><span class="line">    <span class="keyword">return</span> manager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于 Spring Security 支持多种数据源，例如内存、数据库、LDAP 等，这些不同来源的数据被共同封装成了一个 UserDetailService 接口，任何实现了该接口的对象都可以作为认证数据源。</p><p>首先看一下类继承和实现情况：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010091947.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010091947.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010091945655"></p><p>这时候就能看出来为什么上面第二种方式中，使用的是 InMemoryUserDetailsManager 实例了，这个就是基于内存的。还可以发现 JdbcUserDetailsManager 应该就是基于数据库的实例了。</p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><h3 id="2-1-准备数据库"><a href="#2-1-准备数据库" class="headerlink" title="2.1 准备数据库"></a>2.1 准备数据库</h3><p>在 org/springframework/security/core/userdetails/jdbc 中应该存储着 JdbcUserDetailsManager 自己提供的数据库脚本，内容如下：</p><p><code>users.ddl</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(username varchar_ignorecase(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>,<span class="keyword">password</span> varchar_ignorecase(<span class="number">500</span>) <span class="keyword">not</span> <span class="literal">null</span>,enabled <span class="built_in">boolean</span> <span class="keyword">not</span> <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> authorities (username varchar_ignorecase(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,authority varchar_ignorecase(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,<span class="keyword">constraint</span> fk_authorities_users <span class="keyword">foreign</span> <span class="keyword">key</span>(username) <span class="keyword">references</span> <span class="keyword">users</span>(username));</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> ix_auth_username <span class="keyword">on</span> authorities (username,authority);</span><br></pre></td></tr></table></figure><p>这个数据库脚本适用于 <code>HSQLDB</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010093026.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010093026.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010093022924"></p><p>为了让他适用于 Mysql ，将其改为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(username <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>,<span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">not</span> <span class="literal">null</span>,enabled <span class="built_in">boolean</span> <span class="keyword">not</span> <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> authorities (username <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,authority <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,<span class="keyword">constraint</span> fk_authorities_users <span class="keyword">foreign</span> <span class="keyword">key</span>(username) <span class="keyword">references</span> <span class="keyword">users</span>(username));</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> ix_auth_username <span class="keyword">on</span> authorities (username,authority);</span><br></pre></td></tr></table></figure><p>执行完脚本可以看见：users 表和 authorities 表</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094259.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094259.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010094258373"></p><p><code>user表</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094606.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094606.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010094605554"></p><p><code>authorities表</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094633.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010094633.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010094632304"></p><p>两张表是通过 <code>username</code> 关联起来</p><h3 id="2-2-增加不同角色用户"><a href="#2-2-增加不同角色用户" class="headerlink" title="2.2 增加不同角色用户"></a>2.2 增加不同角色用户</h3><p>将上述的第二种基于内存的方式修改为基于数据库方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dataSource = dataSource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> UserDetailsService <span class="title">userDetailsService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    JdbcUserDetailsManager manager = <span class="keyword">new</span> JdbcUserDetailsManager();</span><br><span class="line">    manager.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">if</span> (!manager.userExists(<span class="string">&quot;wangba&quot;</span>)) &#123;</span><br><span class="line">        manager.createUser(User.withUsername(<span class="string">&quot;wangba&quot;</span>).password(<span class="string">&quot;guigui&quot;</span>).roles(<span class="string">&quot;admin&quot;</span>).build());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!manager.userExists(<span class="string">&quot;wangyi&quot;</span>)) &#123;</span><br><span class="line">        manager.createUser(User.withUsername(<span class="string">&quot;wangyi&quot;</span>).password(<span class="string">&quot;1111&quot;</span>).roles(<span class="string">&quot;user&quot;</span>).build());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> manager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行项目可以看见已经将用户写入数据库了</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010101049.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010101049.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010101048293"></p><p>进入 JdbcUserDetailsManager 的 createUser 方法中看看</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010101931.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010101931.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010101928042"></p><p>可以看到 createUserSql 属性，具体看一下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102103.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102103.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010102101750"></p><p>可以看到实际上就是一条 Sql 语句，然后把我们的用户数据写到数据库中</p><h2 id="三、Test"><a href="#三、Test" class="headerlink" title="三、Test"></a>三、Test</h2><p><code>登录 user</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102755.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102755.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010102752531"></p><p><code>访问 user</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102911.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102911.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010102909970"></p><p><code>访问 admin</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102851.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201010102851.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201010102850231"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (四)</title>
    <link href="http://wangba.me/2020/10/09/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%9B%9B/"/>
    <id>http://wangba.me/2020/10/09/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E5%9B%9B/</id>
    <published>2020-10-09T10:33:41.000Z</published>
    <updated>2020-10-09T10:36:07.175Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>在本节中主要实现一下授权功能，即需求时：</p><blockquote><p>admin: 能访问所有的页面，不仅仅是 /admin/ 下的页面，也可以访问 /user/ 下的页面</p><p>user: 只能访问 /user/ 下所有页面</p><p>hello: /hello 所有用户都可以访问</p></blockquote><p>可以理解为：admin 权限比 user 高</p><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p>环境参考<a href="http://wangba.me/tags/Spring-Security/">前面几节</a>，由于目前并没有连接数据库，所以就基于内存进行测试</p><p><code>SecurityConfig</code></p><p>在重写的 configure 方法中增加一个 user 用户：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">            .withUser(<span class="string">&quot;wangba&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;guigui&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .withUser(<span class="string">&quot;wangyi&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;1111&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在重写的 configure 方法中增加拦截规则：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 省略</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：规则是有顺序的，即链式操作</p><p>如果把 anyRequest() 放在前面，首先就会让所有请求通过，然后再进行拦截，这样拦截规则就没有什么用了</p></blockquote><p><code>SecurityController</code> </p><p>在视图层增加一些请求方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/admin/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><p>/hello 请求：允许登录后的任何人访问</p><p>/user/hello 请求：允许拥有 user 角色的用户登录；允许拥有 admin 角色的用户登录</p><p>/admin/hello 请求：只允许拥有 admin 角色的用户登录</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 省略</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><p><code>Postman</code></p><p>首先登录 user 用户：wangyi</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150448.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150448.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150447961"></p><p>按照上面的理论来说：user 可以访问 <code>/hello</code> 和 <code>/user/hello</code> ，不能访问 <code>/admin/hello</code></p><p> <code>/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150703.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150703.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150702237"></p><p> <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150746.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150746.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150745738"></p><p> <code>/admin/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150851.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009150851.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009150850902"></p><p>可以看见，访问该接口被静止了</p><p>同样，登录 admin 用户：wangba</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151043.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151043.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151042154"></p><p> <code>/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151239.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151239.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151238430"></p><p> <code>/admin/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151145.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151145.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151144433"></p><p> <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151212.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009151212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009151210955"></p><p>但是，我们前面要求实现的是 admin 可以访问所有页面，所以进行改进，即进行<code>角色继承</code></p><p><code>SecurityConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">RoleHierarchy <span class="title">roleHierarchy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RoleHierarchyImpl roleHierarchy = <span class="keyword">new</span> RoleHierarchyImpl();</span><br><span class="line">    roleHierarchy.setHierarchy(<span class="string">&quot;ROLE_admin &gt; ROLE_user&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> roleHierarchy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：上述配置表达<code>ROLE_admin</code> 自动具备 <code>ROLE_user</code> 的权限。</p></blockquote><p>此时重启项目，再次登录 wangba，并访问 <code>/user/hello</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009152023.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201009152023.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201009152022118"></p><p>可以看见此时 admin 角色可以访问任何页面了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>0206. Reverse Linked List</title>
    <link href="http://wangba.me/2020/10/09/0206-Reverse-Linked-List/"/>
    <id>http://wangba.me/2020/10/09/0206-Reverse-Linked-List/</id>
    <published>2020-10-09T01:58:41.000Z</published>
    <updated>2020-10-09T02:00:28.470Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="206-反转链表-Easy"><a href="#206-反转链表-Easy" class="headerlink" title="206. 反转链表 Easy"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list/">206. 反转链表</a> <font color="#49b666" size=5>Easy</font></h2><p>反转一个单链表。</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">输出: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>进阶:</strong><br>你可以迭代或递归地反转链表。你能否用两种方法解决这道题？</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>写链表的代码题，一定要考虑周全，可以从以下几个方面考虑：</p><ul><li><p>是否为空链表</p></li><li><p>是否只剩一个结点</p></li><li><p>剩余两个结点怎么样</p></li><li><p>在处理头结点和尾结点时，逻辑上是否可以通过</p></li></ul><h3 id="迭代解法："><a href="#迭代解法：" class="headerlink" title="迭代解法："></a>迭代解法：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 迭代法</span></span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="keyword">null</span>) &#123;</span><br><span class="line">        ListNode next = head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre = head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这就是在<a href="http://wangba.me/2020/10/03/LinkedList/">链表</a>中说到的哨兵，这样最大的目的就是为了让对整个链表的操作进行统一化</p><h3 id="递归解法："><a href="#递归解法：" class="headerlink" title="递归解法："></a>递归解法：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 递归法</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    ListNode listNode = reverseList(head.next);</span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> listNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在进行递归操作中，一定要注意的点：<code>出口</code> </p><p>也就是说一定要有最小条件，而这个条件是可以跳出最后一个递归调用的，然后将结果放到倒数第二个递归调用中</p><p>在这里面出口就是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一旦满足这个条件，就可以触发所有递归调用的结束</p>]]></content>
    
    
    <summary type="html">一天一道力扣题，嗤之以鼻，半信半疑，百感交集，关门大吉，skr skr ! ! !</summary>
    
    
    
    <category term="LeetCode真的难系列" scheme="http://wangba.me/categories/LeetCode%E7%9C%9F%E7%9A%84%E9%9A%BE%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Array" scheme="http://wangba.me/tags/Array/"/>
    
    <category term="LinkedList" scheme="http://wangba.me/tags/LinkedList/"/>
    
  </entry>
  
  <entry>
    <title>LinkedList</title>
    <link href="http://wangba.me/2020/10/03/LinkedList/"/>
    <id>http://wangba.me/2020/10/03/LinkedList/</id>
    <published>2020-10-03T14:04:52.000Z</published>
    <updated>2020-10-12T02:10:28.109Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003182532.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003182532.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003182530832"></p><p>快速预览：</p><ul><li>首先要和<a href="http://wangba.me/2020/10/02/Array/">上一节</a>的数组进行横向对比，来看一下链表独有的特性</li><li>第二小节会介绍一下常见的几种链表，以及为什么要衍生出这些链表</li><li>第三小节主要关注于链表的基操，<del>(勿6)</del> 以及在链表中的一些注意事项，如何保持链表不断链，为什么要引入哨兵</li><li>最后一个小节主要结合 Java 中的链表 LinkedList 来加深对链表的理解</li></ul><h2 id="二、特性"><a href="#二、特性" class="headerlink" title="二、特性"></a>二、特性</h2><p>在<a href="http://wangba.me/2020/10/02/Array/">上一节</a>中已经介绍过数组了，可以将数组和链表在结构上进行对比：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003201159.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003201159.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003201157816"></p><ul><li>在数组中，是需要一块<code>连续且足够存储所有数据</code>的内存空间。如果你的数据大小是 1MB，但是你的内存空间中可能只有两个大内存块，且大小分别为 512 KB，还有若干小内存块，那么这块数据是不能存储在内存中的</li><li>在链表中，是通过 next 指针将<code>离散的内存空间</code>全部利用起来，例如上面的情况中，就可以将这 1MB 大小的数据全部装入内存中</li></ul><blockquote><p>注：在实际的应用层开发中，是不用在乎那一点的空间换时间；但是在底层开发中，这种对空间要求非常高的开发中，就要考虑到多方面了</p></blockquote><p><code>对比：</code></p><table><thead><tr><th>时间复杂度</th><th>数组</th><th>链表</th></tr></thead><tbody><tr><td>查询</td><td>O(1)</td><td>O(n)</td></tr><tr><td>插入、删除</td><td>O(n)</td><td>O(1)</td></tr></tbody></table><h2 id="三、几种常规链表"><a href="#三、几种常规链表" class="headerlink" title="三、几种常规链表"></a>三、几种常规链表</h2><h3 id="3-1-单链表"><a href="#3-1-单链表" class="headerlink" title="3.1 单链表"></a>3.1 单链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214902.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214902.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214901489"></p><ul><li>指向 w 的结点的结点称为<code>头结点</code></li><li>指向 NULL 的结点 g 称为<code>尾结点</code></li><li>每一个结点需要额外的空间存储下一个结点的地址</li></ul><h3 id="3-2-循环链表"><a href="#3-2-循环链表" class="headerlink" title="3.2 循环链表"></a>3.2 循环链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214214.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214214.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214213008"></p><ul><li>不仅具有单链表的特点，且加上它的尾结点指向的不是 NULL，而是指向了头结点</li><li>相比单链表的优点：可以通过尾结点找到头结点</li></ul><h3 id="3-3-双向链表"><a href="#3-3-双向链表" class="headerlink" title="3.3 双向链表"></a>3.3 双向链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214232.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214232.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214231020"></p><ul><li>每一个结点除了需要额外的空间存储下一个结点的地址，还需要额外的空间指向前一个结点的地址</li><li>相比单链表的优点：可以通过任一结点可以找到上一个结点和下一个结点</li></ul><h3 id="3-4-双向循环链表"><a href="#3-4-双向循环链表" class="headerlink" title="3.4 双向循环链表"></a>3.4 双向循环链表</h3><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214248.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003214248.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003214247489"></p><ul><li>不仅具有双向链表的特点，且加上头结点的 pre 指针指向尾结点，尾结点的 next 指针指向头结点</li><li>相比双向链表的优点：可以通过头结点找到尾结点，也可以通过尾结点找到头结点</li></ul><h2 id="四、链表的基操和注意事项"><a href="#四、链表的基操和注意事项" class="headerlink" title="四、链表的基操和注意事项"></a>四、链表的基操和注意事项</h2><p>这里对于链表的操作只在单链表中进行，其余的链表同理：</p><p><code>增</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003221952.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003221952.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003221950242"></p><p>前提：在 a 结点后面增加一个 x 结点，p 指向 a 结点</p><ul><li>第一步：x –&gt; next = p –&gt; next</li><li>第二步：p –&gt; next = x</li></ul><blockquote><p>注：</p><p>此时就要注意 “链不断” 理论：在上面的例子中就是，第一步和第二步的顺序不能颠倒，不然就会出现下面这种情况：</p><ul><li>第一步：p –&gt; next = x</li><li>第二步：x –&gt; next = p –&gt; next</li></ul><p>如果 p –&gt; next 指向了 x，那么在第二步中，x –&gt; next 指向了自己</p></blockquote><p><code>删</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003223435.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201003223435.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201003223434117"></p><p>删除操作的话，就只需要：p –&gt; next = p –&gt; next –&gt; next 即可</p><blockquote><p>注：删除结点要记得释放内存，除了一些自带垃圾回收的语言外，例如 Java、python、Go等</p></blockquote><p><code>哨兵模式</code></p><p>既然在链表中出现了这个模式，那必然是有运用的场景的，看个例子：</p><p>在上面单链表中增加一个结点时</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004085305.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004085305.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004085304248"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x --&gt; next = p --&gt; next</span><br><span class="line">p --&gt; next = x</span><br></pre></td></tr></table></figure><p>如果出现下面几种情况：</p><ul><li>空链表，插入第一个结点</li><li>删除最后一个结点</li><li>又或是 p 指针指向的是两个结点的前一个结点 (在上面的例子中是 a)，但是如果出现要插入的是头结点前面 (也就是说没有前面那个结点了) 呢？</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004090747.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004090747.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004090746697"></p><p>此时就可以发现，p 指针无处可指，这时候就可以引入”哨兵”了。(虽然在双向链表中可以轻易解决这个问题)</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004113804.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004113804.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004100823076"></p><p>也就是说不管在什么情况下，都有一个哨兵的存在，其主要目的就是简化代码，不需要考虑带很多情况，可以看一下下面的例子：</p><p>首先需要的前提就是：head 指针是永远指向哨兵的</p><ul><li>空链表中插入第一个结点，就可以：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head -&gt; next == null) &#123;</span><br><span class="line">  p = head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只需要判断哨兵指针的 next 是否为空，如果为空的的话，只需要将 p = head，就可以进行和上面一样的插入代码了</p><h2 id="四、Java中的链表"><a href="#四、Java中的链表" class="headerlink" title="四、Java中的链表"></a>四、Java中的链表</h2><p>​        首先来回忆一下在 Java 中对数组的操作，直接分配一块连续的内存给数组，这种情况的不好之处就是需要连续且内存足够的空间；随后又提出了 Java 中动态数组 ArrayList ，这个类的确可以进行动态的自动扩容，但是它不能进行自动缩容 (注：ArrayList 是支持手动扩容、缩容)，而且它的扩容是将原来所有的数据复制一份到已经进行扩容到原来 1.5 倍的新数组中，当数据量过大时，这种操作可能就需要大量时间来进行了</p><p>​        而在这一小节中，可以看一下，在 Java 中链表类：<code>LinkedList</code>，它的底层是基于双向链表的，日常开发很少使用</p><p>首先看一下，继承关系：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004123939.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201004123939.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201004123937678"></p><p>可以和<a href="http://wangba.me/2020/10/02/Array/">上一节</a> ArrayList 类的继承图进行对比，可以发现：</p><ul><li>少了：LinkedList 少实现了 RandomAccess 接口，具体看参考<a href="https://juejin.im/post/6844903519066193927">RandomAccess 这个空架子有何用？</a></li><li>改了：ArrayList 是继承了 AbstractList，而 LinkedList 继承了 AbstractSequentialList (它是 AbstractList 的子类)</li><li>多了：LinkedList 还实现了 Deque 接口  ====&gt;  因为实现 Deque 即可以作为队列使用，也可以作为栈使用。当然，作为双端队列，也是可以的。</li></ul><p>由于源码过多，此内容将放在 JDK 源码分析系列中。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Array</title>
    <link href="http://wangba.me/2020/10/02/Array/"/>
    <id>http://wangba.me/2020/10/02/Array/</id>
    <published>2020-10-02T14:35:15.000Z</published>
    <updated>2020-10-02T14:29:22.797Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>思维导图：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002093205.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002093205.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002093203544">        </p><h2 id="二、特性"><a href="#二、特性" class="headerlink" title="二、特性"></a>二、特性</h2><p>数组应该是所有程序员中最熟悉的数据结构了，如果你简单的回忆一下数组的具体含义，你可以得到已经几个重要的结论：</p><ul><li>🐷 线性结构</li><li>🐢 连续内存</li><li>🐭 存储相同类型</li></ul><h3 id="2-1-线性结构"><a href="#2-1-线性结构" class="headerlink" title="2.1 线性结构"></a>2.1 线性结构</h3><p>顾名思义，线性结构就是这个结构像线性一样，而非是其它结构，这样说的确有点抽象，可以从下面几个例子来看一下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002101432.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002101432.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002101430898"></p><blockquote><p>注：</p><ul><li>这里的 <strong>Array</strong> 是使用 <strong>Java</strong> 中的内存模型，即 <strong>char</strong> 为 2 个字节</li><li>链表没有使用哨兵模式 (后面会提到)</li></ul></blockquote><h3 id="2-2-连续内存和相同数据类型"><a href="#2-2-连续内存和相同数据类型" class="headerlink" title="2.2 连续内存和相同数据类型"></a>2.2 连续内存和相同数据类型</h3><p>正如上面例子中的数组一样，在这个数组中，它们的地址是连续的，且数组中每一个元素都是 char 类型，正是由于这两个特性，让数组实现了这一生中最重要的操作：快速查询，它可以达到 <strong>O(1)</strong> 的速度，当然要对这里进行限制条件，即准确的表达应该是按照<code>下标</code>进行查询，它的时间复杂度可以达到 <strong>O(1)</strong> ，而不是我们经常说的根据某个值来确定它的位置等，这样的查询方式 (已经排好序) 最快也是 <strong>O(logn)</strong> </p><p>先来看一下是如何实现根据下标来进行时间复杂度为 <strong>O(1)</strong> 的操作：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002112308.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002112308.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002112307187"></p><p>我们很容易就发现这样的规律：</p><p>前提：char[] charList = new char[6]</p><p>结论：<code>address = baseAddress + i * charSize</code></p><p>也就是说，我们只需要知道以下条件就行：</p><ul><li>该数组的起始地址 baseAddress，也就是图中的 1000</li><li>该数组是什么类型，这里是 Java 的 char 类型，字节数为 2</li></ul><p>就这样，可以通过上面条件求出这里任意一个元素的地址。</p><h4 id="假知识："><a href="#假知识：" class="headerlink" title="假知识："></a>假知识：</h4><p>如果，起始地址从 1 开始的话，来计算一下会发生什么情况？</p><p>计算公式是不是要变为：<code>address = baseAddress + (i - 1) * charSize</code> </p><p>你想，你细想，是不是每次都要多进行一次<strong>减法</strong>操作，这样 <code>加法器</code> (在计组中是没有减法器存在的，通过转换为加法来计算)是不是就要多进行一次计算</p><p>这会不会就是当年定义数组从 0 开始的那位程序员的 idea 呢？(<del>强者如斯</del>) 当然不是，这仅仅是一种规定而已，上面的一系列猜测，仅仅是为了猜而猜</p><h3 id="2-3-插入和删除"><a href="#2-3-插入和删除" class="headerlink" title="2.3 插入和删除"></a>2.3 插入和删除</h3><p><strong>One coin has two sides</strong>，有利自然有弊。在上面已经说过了数组的查询，也是数组的最大优点；当然数组在插入和删除的时间复杂度比较高，但是也有一些优化的小 tips。</p><p><code>插入</code></p><p>为什么说数组中插入，会是时间复杂度变高呢？主要是数组是连续存储的，如果只是在最后一个元素插入一个新的元素，那么没什么大不了；但是你要是在第一个元素后面插入一个新的元素，那就要把原本的第二个元素到最后一个元素全部向后移动一个 typeSize，如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002153520.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002153520.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002153518082"></p><p>由上面的图，可以轻易看出插入新的元素在最后：前面元素的位置都未变；插入在第二个位置：第二个元素到最后一个元素的位置都 <strong>+ 1</strong> 了</p><p>平均的时间复杂度就为：<strong>O(n)</strong></p><p>当然这样做是有前提的：就是是要有序的。如果对排序没有要求的，可以如下操作：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002155752.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002155752.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002155750878"></p><p>此时只需要把原本在 1 位置的元素<strong>复制</strong>到新扩展的位置，把 1 中的元素换成新的元素，在上述的例子中对应的就是：将 n 复制到位置 5 上，然后将位置 1 的元素覆盖为新元素 a</p><p><code>删除</code></p><p>删除数组中的元素与插入操作类似：主要是为了保证内存的连续性，如果删除最后一个元素，那没什么问题；如果是删除第一个元素，那么第一个元素后面的所有元素都要向前移动一个位置。</p><p>则平均的时间复杂度就为：<strong>O(n)</strong></p><p>一些特殊情况下的删除：如果对没有立马对删除元素进行垃圾回收的操作，有什么比较好的方式？</p><p>在 JVM 进行垃圾回收时，有以下几种算法：</p><ul><li>标记 - 清除算法</li><li>复制算法</li><li>标记 - 整理算法</li><li>分代收集算法</li></ul><p>在这里主要介绍一下 <strong>标记 - 清除算法</strong>，简单来说：</p><p>在 JVM 进行垃圾回收时，不立马进行回收，只是对要进行回收的元素进行标记，等到积累到一定量再进行一次批处理，例子如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163730.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163730.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002163729145"></p><p>可以看见，只需要对要删除的元素进行标记，随后到最后一次性进行回收</p><p>但是这样也会带来很多问题，如效率问题和空间问题，如下：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163919.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002163919.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002163917519"></p><p>如果是删除的元素是一段一段的，那么就会产生大量的空间碎片，所以 JVM 后面还有很多其余的回收算法</p><h3 id="2-4-关于数组越界的问题"><a href="#2-4-关于数组越界的问题" class="headerlink" title="2.4 关于数组越界的问题"></a>2.4 关于数组越界的问题</h3><p>我们尝试在 Ubuntu 18.04 64bit 中运行下面这段 C 代码：</p><p><code>OverFlow.c</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(; i&lt;=<span class="number">3</span>; i++)&#123;</span><br><span class="line">        arr[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照正常想法走下去：会打印三行 hello world，就会运行完毕</p><p>让我们进行测试吧：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002172344.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002172344.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002172343083"></p><p>你就会看到控制台开始无限打印 hello world 了：</p><p>![image-20201002172557103](/Users/wangdechao/Library/Application Support/typora-user-images/image-20201002172557103.png)</p><p>只要在内存足够的情况下，这个程序就会一直运行下去，这就是典型的 StackOverFlow 问题</p><p>简单的就可以理解成如下结构：</p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002184829.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002184829.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002184827040" style="zoom:50%;" /><p>这个栈的结构具体可以参考《深入理解计算机系统》，这里出现上述情况的主要原因：</p><ul><li>C 语言中是所有的内存都是可以访问 (除了受限内存以外)</li><li>在上述代码中 i &lt;=3，说明 a[3] = 0 在内存的某个地址上</li><li>而这个地址本身是 <code>原来的 i 的地址</code> ，所以就相当于 i = 3 又被赋值为 i = 0，然后继续不断循环</li></ul><p>如果想知道这个栈溢出是如何具体实现的话，可以是用 objdump 命令进行反编译，再进行分析，其中主要的汇编代码如下：其中关键行应该为 65f、67e、682、661</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">000000000000063a &lt;main&gt;:</span><br><span class="line"> 63a:    55                       push   %rbp</span><br><span class="line"> 63b:    48 89 e5                 mov    %rsp,%rbp</span><br><span class="line"> 63e:    48 83 ec 20              sub    $0x20,%rsp</span><br><span class="line"> 642:    89 7d ec                 mov    %edi,-0x14(%rbp)</span><br><span class="line"> 645:    48 89 75 e0              mov    %rsi,-0x20(%rbp)</span><br><span class="line"> 649:    c7 45 fc 00 00 00 00     movl   $0x0,-0x4(%rbp)</span><br><span class="line"> 650:    48 c7 45 f0 00 00 00     movq   $0x0,-0x10(%rbp)</span><br><span class="line"> 657:    00 </span><br><span class="line"> 658:    c7 45 f8 00 00 00 00     movl   $0x0,-0x8(%rbp)</span><br><span class="line"> 65f:    eb 1d                    jmp    67e &lt;main+0x44&gt;</span><br><span class="line"> 661:    8b 45 fc                 mov    -0x4(%rbp),%eax</span><br><span class="line"> 664:    48 98                    cltq   </span><br><span class="line"> 666:    c7 44 85 f0 00 00 00     movl   $0x0,-0x10(%rbp,%rax,4)</span><br><span class="line"> 66d:    00 </span><br><span class="line"> 66e:    48 8d 3d 9f 00 00 00     lea    0x9f(%rip),%rdi        # 714 &lt;_IO_stdin_used+0x4&gt;</span><br><span class="line"> 675:    e8 96 fe ff ff           callq  510 &lt;puts@plt&gt;</span><br><span class="line"> 67a:    83 45 fc 01              addl   $0x1,-0x4(%rbp)</span><br><span class="line"> 67e:    83 7d fc 03              cmpl   $0x3,-0x4(%rbp)</span><br><span class="line"> 682:    7e dd                    jle    661 &lt;main+0x27&gt;</span><br><span class="line"> 684:    b8 00 00 00 00           mov    $0x0,%eax</span><br><span class="line"> 689:    c9                       leaveq </span><br><span class="line"> 68a:    c3                       retq   </span><br><span class="line"> 68b:    0f 1f 44 00 00           nopl   0x0(%rax,%rax,1)</span><br></pre></td></tr></table></figure><p>其实，在这个巨大漏洞出来后，现在的内存已经加了金丝雀保护 (canary) 了，为了让这个漏洞复现，在上面编译的过程中，已经使用 <strong>-fno-stack-protector</strong> 将保护关闭了</p><p>而如果该程序在 Java 中复现，在编译时就会抛出 <strong>ArrayIndexOutOfBoundsException</strong> 的异常了</p><h2 id="三、Java-中的数组"><a href="#三、Java-中的数组" class="headerlink" title="三、Java 中的数组"></a>三、Java 中的数组</h2><p>在 Java 中，对于数组没有什么好了解的，顶多就一个基本语法；但是在 Java 中有一个集合类，是每个 Java 程序员应该每天都会用到的，它就是 <code>ArrayList</code> </p><p>先看一下它的继承和实现关系</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002213613.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20201002213613.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20201002213610816"></p><ul><li>它继承了 <strong>AbstractList</strong> ，实现了 <strong>List</strong>    ====&gt;    它是一个数组队列，提供了相关的添加、删除、修改、遍历等功能</li><li>它实现了<strong>RandomAccess 接口</strong>    ====&gt;    实现这个这个接口的 List 集合是支持<strong>快速随机访问</strong></li><li>它实现 <strong>java.io.Serializable 接口</strong>    ====&gt;    ArrayList <strong>支持序列化</strong>，<strong>能通过序列化去传输</strong></li><li>并且要注意，在单线程中使用它，在多线程使用 <strong>Vector(少)</strong> 或者 <strong>CopyOnWriteArrayList(多)**，尽量还是使用后者较多，前者主要是基于 **synchronized</strong> 关键字，后者是基于 <strong>ReentrantLock</strong> 操作的</li></ul><p>它与 Java 自带的普通数组最大的区别就是：它是<code>动态</code>的</p><p>这里主要基于源码分析一下动态扩容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; <span class="keyword">this</span>.elementData.length &amp;&amp; (<span class="keyword">this</span>.elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA || minCapacity &gt; <span class="number">10</span>)) &#123;</span><br><span class="line">        ++<span class="keyword">this</span>.modCount;</span><br><span class="line">        <span class="keyword">this</span>.grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object[] grow(<span class="keyword">int</span> minCapacity) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.elementData = Arrays.copyOf(<span class="keyword">this</span>.elementData, <span class="keyword">this</span>.newCapacity(minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object[] grow() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.grow(<span class="keyword">this</span>.size + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">newCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = <span class="keyword">this</span>.elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(<span class="number">10</span>, minCapacity);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> minCapacity;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> newCapacity - <span class="number">2147483639</span> &lt;= <span class="number">0</span> ? newCapacity : hugeCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><ul><li>对于变长数据结构，当结构中没有空余空间可供使用时，就需要进行扩容。在 ArrayList 中，当空间用完，其会按照原数组空间的1.5倍进行扩容。</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Algorithm</title>
    <link href="http://wangba.me/2020/10/01/Algorithm/"/>
    <id>http://wangba.me/2020/10/01/Algorithm/</id>
    <published>2020-10-01T14:42:29.000Z</published>
    <updated>2020-10-01T14:52:58.430Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​            最近实习后发现自己的算法能力急剧下降，<del>CRUD 只是下限，算法才是上限</del>，决定重新开一个系列，将数据结构与算法重新学一遍。这次主要参考的课程是《数据结构与算法之美》和《算法面试通关40讲》。这里就不像《算法导论》那样比较理论化，应该会更偏向于《算法》这本书的类型。</p><p>可以看到下面这些有趣的点：</p><ul><li>🐷 尽量利用图 + 文字，清晰的表达意思</li><li>🐢 一定要结合 Leetcode 上的题目</li><li>🐭 尽量介绍一些<del>没用</del>有趣的小 Tips</li><li>🐦 使用 Java 来实现所有的算法</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="重学算法系列" scheme="http://wangba.me/categories/%E9%87%8D%E5%AD%A6%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Leetcode" scheme="http://wangba.me/tags/Leetcode/"/>
    
    <category term="Algorithm" scheme="http://wangba.me/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (三)</title>
    <link href="http://wangba.me/2020/09/30/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%89/"/>
    <id>http://wangba.me/2020/09/30/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%89/</id>
    <published>2020-09-30T06:47:27.000Z</published>
    <updated>2020-09-30T08:49:43.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>​        在前后端不分离时代，可能使用的就是<a href="http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/">上一节</a>中这种方法；在现在这种前后端分离遍地走的情况下，已经不再推荐使用传统的 session ，而是使用现在比较流行的 JWT 这种 token 的方式解决</p><p>​        对比分析一下：</p><table><thead><tr><th></th><th>有状态登录</th><th>无状态登录</th></tr></thead><tbody><tr><td>定义</td><td>服务端需要记录每次会话的客户端信息，从而识别客户端身份，根据用户身份进行请求的处理</td><td>服务端不保存任何客户端请求者信息；客户端的每次请求必须具备自描述信息，通过这些信息识别客户端身份</td></tr><tr><td>优点</td><td>比较方便，不需要做多余的处理</td><td>使用 token 很灵活；服务端不需要存数据；客户端也可以发送给多个服务器</td></tr><tr><td>缺点</td><td>只能是网页端，在 IOS、Android不行；服务端保存大量数据；集群化不太行</td><td>配置稍微复杂(其实在框架的加成下，不复杂)</td></tr></tbody></table><p><code>有状态登录</code></p><ul><li>🌰：在 Tomcat 中，用户登录后，需要把用户的信息保存在服务器的 session 中，然后发送给用户一个 Cookie 值，记录对应的 session 值，等用户下一次再次访问该服务器时，浏览器会自动带上这个 Cookie 值，服务端再识别其中的 session 值，进行判断</li></ul><p><code>无状态登录</code></p><ul><li>🌰：客户端发送账户密码到服务端进行验证；认证后服务端发送一个 token 给客户端；以后客户端每次发送请求都将 token 携带上进行认证，进行判断</li></ul><h2 id="二、Test"><a href="#二、Test" class="headerlink" title="二、Test"></a>二、Test</h2><p>​        在前后端分离的基础上，现在前端和后端只是通过 JSON 进行交互，所以现在的页面跳转全部由前端进行控制，后端只是返回不同的 JSON 罢了</p><p>重写<code>SecurityConfig</code>中的 configure 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 登出页面 + 登出成功后页面</span></span><br><span class="line">            .logout()</span><br><span class="line">            .logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .logoutSuccessHandler((httpServletRequest, httpServletResponse, authentication) -&gt; &#123;</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// 登录页面 + 登录接口</span></span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/securityLogin&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            <span class="comment">// 登录失败处理器</span></span><br><span class="line">            .failureHandler((httpServletRequest, httpServletResponse, e) -&gt; &#123;</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(e.getMessage());</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 登录成功处理器</span></span><br><span class="line">            .successHandler((httpServletRequest, httpServletResponse, authentication) -&gt; &#123;</span><br><span class="line">                Object principal = authentication.getPrincipal();</span><br><span class="line">                httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                out.write(<span class="keyword">new</span> ObjectMapper().writeValueAsString(principal));</span><br><span class="line">                out.flush();</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>登录接口</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200929172425.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200929172425.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200929172423472"></p><blockquote><p>注：</p><ul><li>可以看到使用前后端分离，就不需要后端来控制跳转页面等，只需要将 JSON 发给前端就行</li><li>这里面的 password 为空，是框架做的，具体可以看这里</li></ul></blockquote><p><code>登录失败</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930092635.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930092635.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930092629637"></p><blockquote><p>注：</p><ul><li>无论是用户名和密码其中一个错误，就会返回 Bad credentials 提示，主要也是为了安全着想，具体流程可以看下面的 3.1 小节</li></ul></blockquote><p><code>注销登录</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930093600.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930093600.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930093559635"></p><h2 id="三、Deep-Learning"><a href="#三、Deep-Learning" class="headerlink" title="三、Deep Learning"></a>三、Deep Learning</h2><h3 id="3-1-深入了解登录失败"><a href="#3-1-深入了解登录失败" class="headerlink" title="3.1 深入了解登录失败"></a>3.1 深入了解登录失败</h3><p>​        在上面我们提到了无论是用户名和密码其中一个错误，就会返回 Bad credentials，实则在其中还有很多种错误，而且用户名是有用户名错误，只是最终被 Bad credentials 覆盖了，稍微分析一下：</p><p><code>AbstractUserDetailsAuthenticationProvider</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    Assert.isInstanceOf(UsernamePasswordAuthenticationToken.class, authentication, () -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.messages.getMessage(<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.onlySupports&quot;</span>, <span class="string">&quot;Only UsernamePasswordAuthenticationToken is supported&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    String username = authentication.getPrincipal() == <span class="keyword">null</span> ? <span class="string">&quot;NONE_PROVIDED&quot;</span> : authentication.getName();</span><br><span class="line">    <span class="keyword">boolean</span> cacheWasUsed = <span class="keyword">true</span>;</span><br><span class="line">    UserDetails user = <span class="keyword">this</span>.userCache.getUserFromCache(username);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cacheWasUsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = <span class="keyword">this</span>.retrieveUser(username, (UsernamePasswordAuthenticationToken)authentication);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UsernameNotFoundException var6) &#123;</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.hideUserNotFoundExceptions) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="keyword">this</span>.messages.getMessage(<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>, <span class="string">&quot;Bad credentials&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面这段代码中，进行调试可以看见：</p><ul><li>会先在缓存中查询一下是否有过</li><li>再调用 retrieveUser 来进行判断</li><li>一旦抛出 UsernameNotFoundException ，就看 hideUserNotFoundExceptions 的值了，如果为 true，就会抛出 Bad credentials</li></ul><p>进行断点调试：输错用户名，并打上断点：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930135354.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930135354.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930135352906"></p><p>通过上图就能看出，hideUserNotFoundExceptions 默认值是 true 的</p><h3 id="3-2-未认证处理"><a href="#3-2-未认证处理" class="headerlink" title="3.2 未认证处理"></a>3.2 未认证处理</h3><p>在前后端分离，如果出现未认证的状态，不可能控制前端来跳转页面等，只能给前端返回相应的信息即可：</p><p>在 <code>AuthenticationEntryPoint</code> 接口中有一个方法：<code>commence</code></p><p>在 <code>LoginUrlAuthenticationEntryPoint</code> 中实现方式为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">    String redirectUrl = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.useForward) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.forceHttps &amp;&amp; <span class="string">&quot;http&quot;</span>.equals(request.getScheme())) &#123;</span><br><span class="line">            redirectUrl = <span class="keyword">this</span>.buildHttpsRedirectUrlForRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redirectUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">            String loginForm = <span class="keyword">this</span>.determineUrlToUseForThisRequest(request, response, authException);</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Server side forward to: &quot;</span> + loginForm);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            RequestDispatcher dispatcher = request.getRequestDispatcher(loginForm);</span><br><span class="line">            dispatcher.forward(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        redirectUrl = <span class="keyword">this</span>.buildRedirectUrlToLoginPage(request, response, authException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.redirectStrategy.sendRedirect(request, response, redirectUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码中最主要的是看一下 <strong>useForward</strong> 的默认值，如果是 <strong>true</strong>，那么默认就是走转发；如果是 <strong>false</strong>，那么默认走的就是重定向</p><p>使出断点调试大法：</p><ul><li>在 <strong>Postman</strong> 中直接使用 <strong>GET</strong> 方式请求：localhost:8080/security</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141616.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141616.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930141614962"></p><p>此方法在第一节中已经写过了，就是输出一个 <strong>Spring Security</strong></p><ul><li>在方法内打上断点</li></ul><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141514.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930141514.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930141512452"></p><p>从上面的图就可以看见，<strong>useForward</strong> 的默认值是 <strong>false</strong>，那么就可以确定是走的重定向</p><p>只需要重写该方法覆盖它就行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.exceptionHandling()</span><br><span class="line">.authenticationEntryPoint((req, resp, authException) -&gt; &#123;</span><br><span class="line">    resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    PrintWriter out = resp.getWriter();</span><br><span class="line">    out.write(<span class="string">&quot;尚未登录，请先登录&quot;</span>);</span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930164934.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200930164934.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200930143626120"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (二)</title>
    <link href="http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/"/>
    <id>http://wangba.me/2020/09/28/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%BA%8C/</id>
    <published>2020-09-28T10:13:07.000Z</published>
    <updated>2020-09-30T07:09:26.232Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、Test"><a href="#一、Test" class="headerlink" title="一、Test"></a>一、Test</h2><p>环境与<a href="http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/">上一节</a>的环境一致，这一节主要来进行自定义操作</p><p>在 <code>SecurityConfig</code>  中重写这两个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    web.ignoring().antMatchers(<span class="string">&quot;/js/**&quot;</span>, <span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自行写一个登录页面：</p><p><code>login.html</code> 中的核心代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;pass&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pass&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button login&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-check&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>主要注意以下几个方面：</p><p>form 的请求地址是 /login.html，方法是 post</p><p>用户名和密码的属性值分别是 username 和 password</p></blockquote><h2 id="二、Deep-Learning"><a href="#二、Deep-Learning" class="headerlink" title="二、Deep Learning"></a>二、Deep Learning</h2><p> 🐢之疑问一：为啥默认的登录页面和登录接口是一样的？自定义页面又是如何覆盖默认页面的呢？</p><p><code>默认登录页面</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928133405.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928133405.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200928133357601"></p><p>关于页面的登录的配置都在：<code>FormLoginConfigurer</code> </p><p>其中这个类又是继承 <code>AbstractAuthenticationFilterConfigurer</code> 类的</p><p>则在 <code>FormLoginConfigurer</code> 初始化的时候，<code>AbstractAuthenticationFilterConfigurer</code> 的构造方法中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractAuthenticationFilterConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   setLoginPage(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时如果没有自定义登录页面，就会是 <code>项目地址/login</code> 这个地址</p><p>再看一下 <code>FormLoginConfigurer</code> 中的 init 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(H http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.init(http);</span><br><span class="line">   initDefaultLoginFilter(http);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法是调用了父类的 init 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(B http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   updateAuthenticationDefaults();</span><br><span class="line">   updateAccessDefaults(http);</span><br><span class="line">   registerDefaultAuthenticationEntryPoint(http);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在父类的 init 方法中调用了 <code>updateAuthenticationDefaults()</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">updateAuthenticationDefaults</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 未自定义页面，就会和 loginPage 地址一样</span></span><br><span class="line">   <span class="keyword">if</span> (loginProcessingUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">      loginProcessingUrl(loginPage);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (failureHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">      failureUrl(loginPage + <span class="string">&quot;?error&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">final</span> LogoutConfigurer&lt;B&gt; logoutConfigurer = getBuilder().getConfigurer(</span><br><span class="line">         LogoutConfigurer.class);</span><br><span class="line">   <span class="keyword">if</span> (logoutConfigurer != <span class="keyword">null</span> &amp;&amp; !logoutConfigurer.isCustomLogoutSuccess()) &#123;</span><br><span class="line">      logoutConfigurer.logoutSuccessUrl(loginPage + <span class="string">&quot;?logout&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时就能看到：如果我们没有自定义登录接口，那么登录接口的地址就会被设置为和登录页面一致</p><p><code>自定义登录页面</code></p><p>如果自定义了页面地址，首先会到 <code>FormLoginConfigurer</code> 中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">loginPage</span><span class="params">(String loginPage)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">super</span>.loginPage(loginPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里面调用了父类的 <code>loginPage</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">loginPage</span><span class="params">(String loginPage)</span> </span>&#123;</span><br><span class="line">   setLoginPage(loginPage);</span><br><span class="line">   updateAuthenticationDefaults();</span><br><span class="line">   <span class="keyword">this</span>.customLoginPage = <span class="keyword">true</span>;</span><br><span class="line">   <span class="keyword">return</span> getSelf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，在这里面 set 完 <code>loginPage</code> 后，又双调用了 <code>updateAuthenticationDefaults()</code> 方法，这个方法在 ☝️ 有</p><p>如果自定义了登录接口 <code>loginProcessingUrl</code> ，那么就会进入这个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">loginProcessingUrl</span><span class="params">(String loginProcessingUrl)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.loginProcessingUrl = loginProcessingUrl;</span><br><span class="line">   authFilter</span><br><span class="line">         .setRequiresAuthenticationRequestMatcher(createLoginProcessingUrlMatcher(loginProcessingUrl));</span><br><span class="line">   <span class="keyword">return</span> getSelf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>🐢之疑问二：在提交的表单中，参数分别为 username 和 password，可不可以自定义呢？</p><p>首先还是去 <code>FormLoginConfigurer</code> 类中看看构造方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FormLoginConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>(<span class="keyword">new</span> UsernamePasswordAuthenticationFilter(), <span class="keyword">null</span>);</span><br><span class="line">   usernameParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">   passwordParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的 super 根据 👆 的继承关系，就可以知道是 <code>AbstractAuthenticationFilterConfigurer</code> 中的构造：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractAuthenticationFilterConfigurer</span><span class="params">(F authenticationFilter,</span></span></span><br><span class="line"><span class="function"><span class="params">      String defaultLoginProcessingUrl)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>();</span><br><span class="line">   <span class="comment">// 将传进来的参数赋值给这个类的 authFilter</span></span><br><span class="line">   <span class="keyword">this</span>.authFilter = authenticationFilter;</span><br><span class="line">   <span class="keyword">if</span> (defaultLoginProcessingUrl != <span class="keyword">null</span>) &#123;</span><br><span class="line">      loginProcessingUrl(defaultLoginProcessingUrl);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：这里为什么能传参，是由于 </p><p>UsernamePasswordAuthenticationFilter 继承 AbstractAuthenticationProcessingFilter</p><p>且 F extends AbstractAuthenticationProcessingFilter</p></blockquote><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928160656.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200928160656.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200928160655402"></p><p>此时已经有了 <code>UsernamePasswordAuthenticationFilter</code> 的实例了，接着执行 <code>usernameParameter</code> 和 <code>passwordParameter</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">usernameParameter</span><span class="params">(String usernameParameter)</span> </span>&#123;</span><br><span class="line">   getAuthenticationFilter().setUsernameParameter(usernameParameter);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> FormLoginConfigurer&lt;H&gt; <span class="title">passwordParameter</span><span class="params">(String passwordParameter)</span> </span>&#123;</span><br><span class="line">   getAuthenticationFilter().setPasswordParameter(passwordParameter);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的 <code>getAuthenticationFilter</code> 是父类的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> F <span class="title">getAuthenticationFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> authFilter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里就很明确了，就是将刚才的 new UsernamePasswordAuthenticationFilter() 放到这里面分别调用 <code>setUsernameParameter</code> 和 <code>setPasswordParameter</code> 方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsernameParameter</span><span class="params">(String usernameParameter)</span> </span>&#123;</span><br><span class="line">    Assert.hasText(usernameParameter, <span class="string">&quot;Username parameter must not be empty or null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.usernameParameter = usernameParameter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPasswordParameter</span><span class="params">(String passwordParameter)</span> </span>&#123;</span><br><span class="line">    Assert.hasText(passwordParameter, <span class="string">&quot;Password parameter must not be empty or null&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.passwordParameter = passwordParameter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里，usernameParameter 和 passwordParameter 就已经被赋好值了</p><p>再通过这个类 (<code>UsernamePasswordAuthenticationFilter</code>) 中的这两个方法从登录请求中拿到这两个值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">obtainPassword</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.passwordParameter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">obtainUsername</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request.getParameter(<span class="keyword">this</span>.usernameParameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么自定义就很简单了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">                  <span class="comment">// 只需要设置以下两项就行</span></span><br><span class="line">            .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>🐢之疑问三：登录成功 or 失败后的重定向的地址，注销登录的地址如何自定义？</p><table><thead><tr><th>登录成功</th><th>登录失败</th></tr></thead><tbody><tr><td>defaultSuccessUrl</td><td>failureForwardUrl</td></tr><tr><td>successForwardUrl</td><td>failureUrl</td></tr></tbody></table><p>区别简单来说就是：</p><p><code>defaultSuccessUrl </code> 可能你访问的地址是 <a href="http://localhost:8080/security">http://localhost:8080/security</a> 但是你没登录，所以你就跳转到 <a href="http://localhost:8080/login">http://localhost:8080/login</a> 页面下，如果你登录成功，那么就会回到 /security 页面</p><p><code>successForwardUrl</code> 不管是什么页面，登录成功一律是你设置的页面</p><p>登录失败同理</p><p><code>注销登录</code> </p><p>看下面的代码</p><p>logoutUrl：用来注销的地址，默认为 “/logout”</p><p>logoutRequestMatcher：改变注销地址，还有请求方式</p><p>logoutSuccessUrl：注销登录成功后，要跳转的地址</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 注销登录设置</span></span><br><span class="line">            .logout()</span><br><span class="line">            .logoutUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .logoutRequestMatcher(<span class="keyword">new</span> AntPathRequestMatcher(<span class="string">&quot;/logout&quot;</span>,<span class="string">&quot;POST&quot;</span>))</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                 <span class="comment">// 登录设置</span></span><br><span class="line">            .and()</span><br><span class="line">            .formLogin().loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">            .usernameParameter(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .passwordParameter(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 下面两个只需要一个</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .successForwardUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// 下面两个只需要一个</span></span><br><span class="line">            .failureForwardUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">            .failureUrl(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      </span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot整合Spring Security (一)</title>
    <link href="http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/"/>
    <id>http://wangba.me/2020/09/27/SpringBoot%E6%95%B4%E5%90%88Spring-Security-%E4%B8%80/</id>
    <published>2020-09-27T10:52:23.000Z</published>
    <updated>2020-09-30T07:09:23.777Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、OverView"><a href="#一、OverView" class="headerlink" title="一、OverView"></a>一、OverView</h2><p>Java 中权限管理最常用的技术应该就是：Spring Security 和 Shiro。</p><p>虽然 Shiro 用它轻量、简单、易于集成占据一席之地，但随着 SpringBoot 的流行，Spring Security 也跟着鸡犬升天，就目前的趋势来看，Spring Security 结合 Oauth2、JWT 等更加方便。</p><p>这次先小试牛刀一下，快速入门……</p><h2 id="二、Environment"><a href="#二、Environment" class="headerlink" title="二、Environment"></a>二、Environment</h2><p><code>不想 error ，先看依赖</code></p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927100536.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927100536.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927100528688"></p><blockquote><p>没看错，就只需要这两个依赖就行</p></blockquote><p><code>pom.xml</code> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--security--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>SecurityController</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/security&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;spring security&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、Test"><a href="#三、Test" class="headerlink" title="三、Test"></a>三、Test</h2><p>启动项目可以看见，在控制台多了一行：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101458.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101458.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101455744"></p><p><code>Postman</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101707.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101707.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101705136"></p><blockquote><p>可以看见报错：401，没有进行认证</p></blockquote><p><code>加上认证</code> </p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101924.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927101924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927101922872"></p><blockquote><p>可以看见，加上 Basic Auth：</p><p>其中用户名为 user，密码为刚才控制台显示的即可</p></blockquote><h2 id="四、Deep-Learning"><a href="#四、Deep-Learning" class="headerlink" title="四、Deep Learning"></a>四、Deep Learning</h2><p>🐢之疑问：为啥用户名是 user，密码就是控制台显示的那个？</p><p>分析思路：</p><p>用户名和密码肯定在一起，这个密码又是 UUID 形式，某个地方肯定用了 UUID.randomUUID().toString()</p><p>按照我们对 SpringBoot 的特性，肯定在 XXXAutoConfiguration 和 XXXProperties 中存在，果然在 SecurityProperties 中看到了：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104212.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927104210784"></p><p>接下来，我们要去找一找，在哪里有调用 getPassword 的这个方法的类：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104415.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927104415.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927104411301"></p><p>看名字应该就是：<code>UserDetailsServiceAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getOrDeducePassword</span><span class="params">(SecurityProperties.User user, PasswordEncoder encoder)</span> </span>&#123;</span><br><span class="line">   String password = user.getPassword();</span><br><span class="line">   <span class="keyword">if</span> (user.isPasswordGenerated()) &#123;</span><br><span class="line">      logger.info(String.format(<span class="string">&quot;%n%nUsing generated security password: %s%n&quot;</span>, user.getPassword()));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (encoder != <span class="keyword">null</span> || PASSWORD_ALGORITHM_PATTERN.matcher(password).matches()) &#123;</span><br><span class="line">      <span class="keyword">return</span> password;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> NOOP_PASSWORD_PREFIX + password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><p>user.isPasswordGenerated() 如果为 true，则打印该信息</p></blockquote><p>再去 ==user.isPasswordGenerated()== 方法中探究一下，回到了==SecurityProperties== 类中了：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> passwordGenerated = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">      .......</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPasswordGenerated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.passwordGenerated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>默认情况下：passwordGenerated 就是为 true</p></blockquote><p>🐢之疑问：每次启动都要输入新的的密码，太麻烦了，我需要自定义</p><p><code>第一种方法：</code></p><p>按照 SpringBoot 的特性，必然已经给你安排好了，肯定有一种方法是在 properties 文件中直接进行：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927110312.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927110312.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927110311399"></p><p><code>idea</code> 已经通过提示显示出来了, <strong>idea yyds !</strong></p><p>直接点进去看一下，回跳到哪个类中，不出🐢🐢的所料，应该就是 ==SecurityProperties== 类中：</p><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112809.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112809.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927112805908"></p><p>果不其然，分别跳到了</p><p><code>setName</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>setPassword</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!StringUtils.hasLength(password)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">this</span>.passwordGenerated = <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：如果在这里自定义了密码，就会将 ==passwordGenerated== 设置为 false，那么在 ==isPasswordGenerated== 就是 false 了，在 ==UserDetailsServiceAutoConfiguration== 中就不会自动生成密码了</p></blockquote><p><code>application.properties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.security.user.name</span>=<span class="string">wangba</span></span><br><span class="line"><span class="meta">spring.security.user.password</span>=<span class="string">8888</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112305.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927112305.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927112303555"></p><p><code>第二种方法：</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 不对密码进行任何编码方式</span></span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">&quot;wangba&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;guigui&quot;</span>)</span><br><span class="line">                .roles(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927160833.png" class="lazyload" data-srcset="https://gitee.com/wonderfuleight/blogImg/raw/master//20200927160833.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200927160832690"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Spring Boot真的香系列" scheme="http://wangba.me/categories/Spring-Boot%E7%9C%9F%E7%9A%84%E9%A6%99%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Spring Boot" scheme="http://wangba.me/tags/Spring-Boot/"/>
    
    <category term="Spring Security" scheme="http://wangba.me/tags/Spring-Security/"/>
    
  </entry>
  
</feed>
